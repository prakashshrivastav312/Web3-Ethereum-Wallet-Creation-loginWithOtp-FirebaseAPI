{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Server = exports.SUBMIT_TRANSACTION_TIMEOUT = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar bignumber_js_1 = tslib_1.__importDefault(require(\"bignumber.js\"));\n\nvar isEmpty_1 = tslib_1.__importDefault(require(\"lodash/isEmpty\"));\n\nvar merge_1 = tslib_1.__importDefault(require(\"lodash/merge\"));\n\nvar stellar_base_1 = require(\"stellar-base\");\n\nvar urijs_1 = tslib_1.__importDefault(require(\"urijs\"));\n\nvar call_builder_1 = require(\"./call_builder\");\n\nvar config_1 = require(\"./config\");\n\nvar errors_1 = require(\"./errors\");\n\nvar account_call_builder_1 = require(\"./account_call_builder\");\n\nvar account_response_1 = require(\"./account_response\");\n\nvar assets_call_builder_1 = require(\"./assets_call_builder\");\n\nvar claimable_balances_call_builder_1 = require(\"./claimable_balances_call_builder\");\n\nvar effect_call_builder_1 = require(\"./effect_call_builder\");\n\nvar friendbot_builder_1 = require(\"./friendbot_builder\");\n\nvar ledger_call_builder_1 = require(\"./ledger_call_builder\");\n\nvar offer_call_builder_1 = require(\"./offer_call_builder\");\n\nvar operation_call_builder_1 = require(\"./operation_call_builder\");\n\nvar orderbook_call_builder_1 = require(\"./orderbook_call_builder\");\n\nvar payment_call_builder_1 = require(\"./payment_call_builder\");\n\nvar strict_receive_path_call_builder_1 = require(\"./strict_receive_path_call_builder\");\n\nvar strict_send_path_call_builder_1 = require(\"./strict_send_path_call_builder\");\n\nvar trade_aggregation_call_builder_1 = require(\"./trade_aggregation_call_builder\");\n\nvar trades_call_builder_1 = require(\"./trades_call_builder\");\n\nvar transaction_call_builder_1 = require(\"./transaction_call_builder\");\n\nvar horizon_axios_client_1 = tslib_1.__importStar(require(\"./horizon_axios_client\"));\n\nexports.SUBMIT_TRANSACTION_TIMEOUT = 60 * 1000;\nvar STROOPS_IN_LUMEN = 10000000;\nvar ACCOUNT_REQUIRES_MEMO = \"MQ==\";\n\nfunction _getAmountInLumens(amt) {\n  return new bignumber_js_1.default(amt).div(STROOPS_IN_LUMEN).toString();\n}\n\nvar Server = function () {\n  function Server(serverURL, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n\n    this.serverURL = urijs_1.default(serverURL);\n    var allowHttp = typeof opts.allowHttp === \"undefined\" ? config_1.Config.isAllowHttp() : opts.allowHttp;\n    var customHeaders = {};\n\n    if (opts.appName) {\n      customHeaders[\"X-App-Name\"] = opts.appName;\n    }\n\n    if (opts.appVersion) {\n      customHeaders[\"X-App-Version\"] = opts.appVersion;\n    }\n\n    if (!isEmpty_1.default(customHeaders)) {\n      horizon_axios_client_1.default.interceptors.request.use(function (config) {\n        config.headers = merge_1.default(customHeaders, config.headers);\n        return config;\n      });\n    }\n\n    if (this.serverURL.protocol() !== \"https\" && !allowHttp) {\n      throw new Error(\"Cannot connect to insecure horizon server\");\n    }\n  }\n\n  Server.prototype.fetchTimebounds = function (seconds, _isRetry) {\n    if (_isRetry === void 0) {\n      _isRetry = false;\n    }\n\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var currentTime;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            currentTime = horizon_axios_client_1.getCurrentServerTime(this.serverURL.hostname());\n\n            if (currentTime) {\n              return [2, {\n                minTime: 0,\n                maxTime: currentTime + seconds\n              }];\n            }\n\n            if (_isRetry) {\n              return [2, {\n                minTime: 0,\n                maxTime: Math.floor(new Date().getTime() / 1000) + seconds\n              }];\n            }\n\n            return [4, horizon_axios_client_1.default.get(urijs_1.default(this.serverURL).toString())];\n\n          case 1:\n            _a.sent();\n\n            return [4, this.fetchTimebounds(seconds, true)];\n\n          case 2:\n            return [2, _a.sent()];\n        }\n      });\n    });\n  };\n\n  Server.prototype.fetchBaseFee = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var response;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4, this.feeStats()];\n\n          case 1:\n            response = _a.sent();\n            return [2, parseInt(response.last_ledger_base_fee, 10) || 100];\n        }\n      });\n    });\n  };\n\n  Server.prototype.feeStats = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var cb;\n      return tslib_1.__generator(this, function (_a) {\n        cb = new call_builder_1.CallBuilder(urijs_1.default(this.serverURL));\n        cb.filter.push([\"fee_stats\"]);\n        return [2, cb.call()];\n      });\n    });\n  };\n\n  Server.prototype.submitTransaction = function (transaction, opts) {\n    if (opts === void 0) {\n      opts = {\n        skipMemoRequiredCheck: false\n      };\n    }\n\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var tx;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!opts.skipMemoRequiredCheck) return [3, 2];\n            return [4, this.checkMemoRequired(transaction)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            tx = encodeURIComponent(transaction.toEnvelope().toXDR().toString(\"base64\"));\n            return [2, horizon_axios_client_1.default.post(urijs_1.default(this.serverURL).segment(\"transactions\").toString(), \"tx=\" + tx, {\n              timeout: exports.SUBMIT_TRANSACTION_TIMEOUT\n            }).then(function (response) {\n              if (!response.data.result_xdr) {\n                return response.data;\n              }\n\n              var responseXDR = stellar_base_1.xdr.TransactionResult.fromXDR(response.data.result_xdr, \"base64\");\n              var results = responseXDR.result().value();\n              var offerResults;\n              var hasManageOffer;\n\n              if (results.length) {\n                offerResults = results.map(function (result, i) {\n                  if (result.value().switch().name !== \"manageBuyOffer\" && result.value().switch().name !== \"manageSellOffer\") {\n                    return null;\n                  }\n\n                  hasManageOffer = true;\n                  var amountBought = new bignumber_js_1.default(0);\n                  var amountSold = new bignumber_js_1.default(0);\n                  var offerSuccess = result.value().value().success();\n                  var offersClaimed = offerSuccess.offersClaimed().map(function (offerClaimedAtom) {\n                    var offerClaimed = offerClaimedAtom.value();\n                    var sellerId = \"\";\n\n                    switch (offerClaimedAtom.switch()) {\n                      case stellar_base_1.xdr.ClaimAtomType.claimAtomTypeV0():\n                        sellerId = stellar_base_1.StrKey.encodeEd25519PublicKey(offerClaimed.sellerEd25519());\n                        break;\n\n                      case stellar_base_1.xdr.ClaimAtomType.claimAtomTypeOrderBook():\n                        sellerId = stellar_base_1.StrKey.encodeEd25519PublicKey(offerClaimed.sellerId().ed25519());\n                        break;\n\n                      default:\n                        throw new Error(\"Invalid offer result type: \" + offerClaimedAtom.switch());\n                    }\n\n                    var claimedOfferAmountBought = new bignumber_js_1.default(offerClaimed.amountBought().toString());\n                    var claimedOfferAmountSold = new bignumber_js_1.default(offerClaimed.amountSold().toString());\n                    amountBought = amountBought.add(claimedOfferAmountSold);\n                    amountSold = amountSold.add(claimedOfferAmountBought);\n                    var sold = stellar_base_1.Asset.fromOperation(offerClaimed.assetSold());\n                    var bought = stellar_base_1.Asset.fromOperation(offerClaimed.assetBought());\n                    var assetSold = {\n                      type: sold.getAssetType(),\n                      assetCode: sold.getCode(),\n                      issuer: sold.getIssuer()\n                    };\n                    var assetBought = {\n                      type: bought.getAssetType(),\n                      assetCode: bought.getCode(),\n                      issuer: bought.getIssuer()\n                    };\n                    return {\n                      sellerId: sellerId,\n                      offerId: offerClaimed.offerId().toString(),\n                      assetSold: assetSold,\n                      amountSold: _getAmountInLumens(claimedOfferAmountSold),\n                      assetBought: assetBought,\n                      amountBought: _getAmountInLumens(claimedOfferAmountBought)\n                    };\n                  });\n                  var effect = offerSuccess.offer().switch().name;\n                  var currentOffer;\n\n                  if (typeof offerSuccess.offer().value === \"function\" && offerSuccess.offer().value()) {\n                    var offerXDR = offerSuccess.offer().value();\n                    currentOffer = {\n                      offerId: offerXDR.offerId().toString(),\n                      selling: {},\n                      buying: {},\n                      amount: _getAmountInLumens(offerXDR.amount().toString()),\n                      price: {\n                        n: offerXDR.price().n(),\n                        d: offerXDR.price().d()\n                      }\n                    };\n                    var selling = stellar_base_1.Asset.fromOperation(offerXDR.selling());\n                    currentOffer.selling = {\n                      type: selling.getAssetType(),\n                      assetCode: selling.getCode(),\n                      issuer: selling.getIssuer()\n                    };\n                    var buying = stellar_base_1.Asset.fromOperation(offerXDR.buying());\n                    currentOffer.buying = {\n                      type: buying.getAssetType(),\n                      assetCode: buying.getCode(),\n                      issuer: buying.getIssuer()\n                    };\n                  }\n\n                  return {\n                    offersClaimed: offersClaimed,\n                    effect: effect,\n                    operationIndex: i,\n                    currentOffer: currentOffer,\n                    amountBought: _getAmountInLumens(amountBought),\n                    amountSold: _getAmountInLumens(amountSold),\n                    isFullyOpen: !offersClaimed.length && effect !== \"manageOfferDeleted\",\n                    wasPartiallyFilled: !!offersClaimed.length && effect !== \"manageOfferDeleted\",\n                    wasImmediatelyFilled: !!offersClaimed.length && effect === \"manageOfferDeleted\",\n                    wasImmediatelyDeleted: !offersClaimed.length && effect === \"manageOfferDeleted\"\n                  };\n                }).filter(function (result) {\n                  return !!result;\n                });\n              }\n\n              return Object.assign({}, response.data, {\n                offerResults: hasManageOffer ? offerResults : undefined\n              });\n            }).catch(function (response) {\n              if (response instanceof Error) {\n                return Promise.reject(response);\n              }\n\n              return Promise.reject(new errors_1.BadResponseError(\"Transaction submission failed. Server responded: \" + response.status + \" \" + response.statusText, response.data));\n            })];\n        }\n      });\n    });\n  };\n\n  Server.prototype.accounts = function () {\n    return new account_call_builder_1.AccountCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.claimableBalances = function () {\n    return new claimable_balances_call_builder_1.ClaimableBalanceCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.ledgers = function () {\n    return new ledger_call_builder_1.LedgerCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.transactions = function () {\n    return new transaction_call_builder_1.TransactionCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.offers = function () {\n    return new offer_call_builder_1.OfferCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.orderbook = function (selling, buying) {\n    return new orderbook_call_builder_1.OrderbookCallBuilder(urijs_1.default(this.serverURL), selling, buying);\n  };\n\n  Server.prototype.trades = function () {\n    return new trades_call_builder_1.TradesCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.operations = function () {\n    return new operation_call_builder_1.OperationCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.strictReceivePaths = function (source, destinationAsset, destinationAmount) {\n    return new strict_receive_path_call_builder_1.StrictReceivePathCallBuilder(urijs_1.default(this.serverURL), source, destinationAsset, destinationAmount);\n  };\n\n  Server.prototype.strictSendPaths = function (sourceAsset, sourceAmount, destination) {\n    return new strict_send_path_call_builder_1.StrictSendPathCallBuilder(urijs_1.default(this.serverURL), sourceAsset, sourceAmount, destination);\n  };\n\n  Server.prototype.payments = function () {\n    return new payment_call_builder_1.PaymentCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.effects = function () {\n    return new effect_call_builder_1.EffectCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.friendbot = function (address) {\n    return new friendbot_builder_1.FriendbotBuilder(urijs_1.default(this.serverURL), address);\n  };\n\n  Server.prototype.assets = function () {\n    return new assets_call_builder_1.AssetsCallBuilder(urijs_1.default(this.serverURL));\n  };\n\n  Server.prototype.loadAccount = function (accountId) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var res;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4, this.accounts().accountId(accountId).call()];\n\n          case 1:\n            res = _a.sent();\n            return [2, new account_response_1.AccountResponse(res)];\n        }\n      });\n    });\n  };\n\n  Server.prototype.tradeAggregation = function (base, counter, start_time, end_time, resolution, offset) {\n    return new trade_aggregation_call_builder_1.TradeAggregationCallBuilder(urijs_1.default(this.serverURL), base, counter, start_time, end_time, resolution, offset);\n  };\n\n  Server.prototype.checkMemoRequired = function (transaction) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var destinations, i, operation, destination, account, e_1;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (transaction instanceof stellar_base_1.FeeBumpTransaction) {\n              transaction = transaction.innerTransaction;\n            }\n\n            if (transaction.memo.type !== \"none\") {\n              return [2];\n            }\n\n            destinations = new Set();\n            i = 0;\n            _a.label = 1;\n\n          case 1:\n            if (!(i < transaction.operations.length)) return [3, 6];\n            operation = transaction.operations[i];\n\n            switch (operation.type) {\n              case \"payment\":\n              case \"pathPaymentStrictReceive\":\n              case \"pathPaymentStrictSend\":\n              case \"accountMerge\":\n                break;\n\n              default:\n                return [3, 5];\n            }\n\n            destination = operation.destination;\n\n            if (destinations.has(destination)) {\n              return [3, 5];\n            }\n\n            destinations.add(destination);\n\n            if (destination.startsWith(\"M\")) {\n              return [3, 5];\n            }\n\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 4,, 5]);\n\n            return [4, this.loadAccount(destination)];\n\n          case 3:\n            account = _a.sent();\n\n            if (account.data_attr[\"config.memo_required\"] === ACCOUNT_REQUIRES_MEMO) {\n              throw new errors_1.AccountRequiresMemoError(\"account requires memo\", destination, i);\n            }\n\n            return [3, 5];\n\n          case 4:\n            e_1 = _a.sent();\n\n            if (e_1 instanceof errors_1.AccountRequiresMemoError) {\n              throw e_1;\n            }\n\n            if (!(e_1 instanceof errors_1.NotFoundError)) {\n              throw e_1;\n            }\n\n            return [3, 5];\n\n          case 5:\n            i++;\n            return [3, 1];\n\n          case 6:\n            return [2];\n        }\n      });\n    });\n  };\n\n  return Server;\n}();\n\nexports.Server = Server;","map":{"version":3,"mappings":"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","names":["exports","STROOPS_IN_LUMEN","ACCOUNT_REQUIRES_MEMO","_getAmountInLumens","amt","bignumber_js_1","div","toString","serverURL","opts","urijs_1","allowHttp","config_1","isAllowHttp","customHeaders","appName","appVersion","isEmpty_1","horizon_axios_client_1","interceptors","request","use","config","headers","merge_1","protocol","Error","Server","seconds","_isRetry","currentTime","hostname","minTime","maxTime","Math","floor","Date","getTime","get","_a","fetchTimebounds","feeStats","response","parseInt","last_ledger_base_fee","cb","call_builder_1","filter","push","call","transaction","skipMemoRequiredCheck","checkMemoRequired","tx","encodeURIComponent","toEnvelope","toXDR","post","segment","timeout","then","data","result_xdr","responseXDR","stellar_base_1","TransactionResult","fromXDR","results","result","value","offerResults","hasManageOffer","length","map","i","switch","name","amountBought","amountSold","offerSuccess","success","offersClaimed","offerClaimedAtom","offerClaimed","sellerId","ClaimAtomType","claimAtomTypeV0","encodeEd25519PublicKey","sellerEd25519","claimAtomTypeOrderBook","ed25519","claimedOfferAmountBought","claimedOfferAmountSold","add","sold","fromOperation","assetSold","bought","assetBought","type","getAssetType","assetCode","getCode","issuer","getIssuer","offerId","effect","offer","currentOffer","offerXDR","selling","buying","amount","price","n","d","operationIndex","isFullyOpen","wasPartiallyFilled","wasImmediatelyFilled","wasImmediatelyDeleted","Object","assign","undefined","catch","Promise","reject","errors_1","status","statusText","account_call_builder_1","claimable_balances_call_builder_1","ledger_call_builder_1","transaction_call_builder_1","offer_call_builder_1","orderbook_call_builder_1","trades_call_builder_1","operation_call_builder_1","source","destinationAsset","destinationAmount","strict_receive_path_call_builder_1","sourceAsset","sourceAmount","destination","strict_send_path_call_builder_1","payment_call_builder_1","effect_call_builder_1","address","friendbot_builder_1","assets_call_builder_1","accountId","accounts","res","account_response_1","base","counter","start_time","end_time","resolution","offset","trade_aggregation_call_builder_1","innerTransaction","memo","destinations","Set","operations","operation","has","startsWith","loadAccount","account","data_attr","e_1"],"sourceRoot":"","sources":["../src/server.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}