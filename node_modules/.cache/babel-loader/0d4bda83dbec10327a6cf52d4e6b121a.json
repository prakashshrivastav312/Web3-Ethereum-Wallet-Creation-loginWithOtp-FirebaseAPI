{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nconst bcrypto = require('../crypto');\n\nconst networks_1 = require('../networks');\n\nconst bscript = require('../script');\n\nconst lazy = require('./lazy');\n\nconst typef = require('typeforce');\n\nconst OPS = bscript.OPS;\n\nconst ecc = require('tiny-secp256k1');\n\nconst bs58check = require('bs58check'); // input: {signature} {pubkey}\n// output: OP_DUP OP_HASH160 {hash160(pubkey)} OP_EQUALVERIFY OP_CHECKSIG\n\n\nfunction p2pkh(a, opts) {\n  if (!a.address && !a.hash && !a.output && !a.pubkey && !a.input) throw new TypeError('Not enough data');\n  opts = Object.assign({\n    validate: true\n  }, opts || {});\n  typef({\n    network: typef.maybe(typef.Object),\n    address: typef.maybe(typef.String),\n    hash: typef.maybe(typef.BufferN(20)),\n    output: typef.maybe(typef.BufferN(25)),\n    pubkey: typef.maybe(ecc.isPoint),\n    signature: typef.maybe(bscript.isCanonicalScriptSignature),\n    input: typef.maybe(typef.Buffer)\n  }, a);\n\n  const _address = lazy.value(() => {\n    const payload = bs58check.decode(a.address);\n    const version = payload.readUInt8(0);\n    const hash = payload.slice(1);\n    return {\n      version,\n      hash\n    };\n  });\n\n  const _chunks = lazy.value(() => {\n    return bscript.decompile(a.input);\n  });\n\n  const network = a.network || networks_1.bitcoin;\n  const o = {\n    name: 'p2pkh',\n    network\n  };\n  lazy.prop(o, 'address', () => {\n    if (!o.hash) return;\n    const payload = Buffer.allocUnsafe(21);\n    payload.writeUInt8(network.pubKeyHash, 0);\n    o.hash.copy(payload, 1);\n    return bs58check.encode(payload);\n  });\n  lazy.prop(o, 'hash', () => {\n    if (a.output) return a.output.slice(3, 23);\n    if (a.address) return _address().hash;\n    if (a.pubkey || o.pubkey) return bcrypto.hash160(a.pubkey || o.pubkey);\n  });\n  lazy.prop(o, 'output', () => {\n    if (!o.hash) return;\n    return bscript.compile([OPS.OP_DUP, OPS.OP_HASH160, o.hash, OPS.OP_EQUALVERIFY, OPS.OP_CHECKSIG]);\n  });\n  lazy.prop(o, 'pubkey', () => {\n    if (!a.input) return;\n    return _chunks()[1];\n  });\n  lazy.prop(o, 'signature', () => {\n    if (!a.input) return;\n    return _chunks()[0];\n  });\n  lazy.prop(o, 'input', () => {\n    if (!a.pubkey) return;\n    if (!a.signature) return;\n    return bscript.compile([a.signature, a.pubkey]);\n  });\n  lazy.prop(o, 'witness', () => {\n    if (!o.input) return;\n    return [];\n  }); // extended validation\n\n  if (opts.validate) {\n    let hash = Buffer.from([]);\n\n    if (a.address) {\n      if (_address().version !== network.pubKeyHash) throw new TypeError('Invalid version or Network mismatch');\n      if (_address().hash.length !== 20) throw new TypeError('Invalid address');\n      hash = _address().hash;\n    }\n\n    if (a.hash) {\n      if (hash.length > 0 && !hash.equals(a.hash)) throw new TypeError('Hash mismatch');else hash = a.hash;\n    }\n\n    if (a.output) {\n      if (a.output.length !== 25 || a.output[0] !== OPS.OP_DUP || a.output[1] !== OPS.OP_HASH160 || a.output[2] !== 0x14 || a.output[23] !== OPS.OP_EQUALVERIFY || a.output[24] !== OPS.OP_CHECKSIG) throw new TypeError('Output is invalid');\n      const hash2 = a.output.slice(3, 23);\n      if (hash.length > 0 && !hash.equals(hash2)) throw new TypeError('Hash mismatch');else hash = hash2;\n    }\n\n    if (a.pubkey) {\n      const pkh = bcrypto.hash160(a.pubkey);\n      if (hash.length > 0 && !hash.equals(pkh)) throw new TypeError('Hash mismatch');else hash = pkh;\n    }\n\n    if (a.input) {\n      const chunks = _chunks();\n\n      if (chunks.length !== 2) throw new TypeError('Input is invalid');\n      if (!bscript.isCanonicalScriptSignature(chunks[0])) throw new TypeError('Input has invalid signature');\n      if (!ecc.isPoint(chunks[1])) throw new TypeError('Input has invalid pubkey');\n      if (a.signature && !a.signature.equals(chunks[0])) throw new TypeError('Signature mismatch');\n      if (a.pubkey && !a.pubkey.equals(chunks[1])) throw new TypeError('Pubkey mismatch');\n      const pkh = bcrypto.hash160(chunks[1]);\n      if (hash.length > 0 && !hash.equals(pkh)) throw new TypeError('Hash mismatch');\n    }\n  }\n\n  return Object.assign(o, a);\n}\n\nexports.p2pkh = p2pkh;","map":{"version":3,"names":["Object","defineProperty","exports","value","bcrypto","require","networks_1","bscript","lazy","typef","OPS","ecc","bs58check","p2pkh","a","opts","address","hash","output","pubkey","input","TypeError","assign","validate","network","maybe","String","BufferN","isPoint","signature","isCanonicalScriptSignature","Buffer","_address","payload","decode","version","readUInt8","slice","_chunks","decompile","bitcoin","o","name","prop","allocUnsafe","writeUInt8","pubKeyHash","copy","encode","hash160","compile","OP_DUP","OP_HASH160","OP_EQUALVERIFY","OP_CHECKSIG","from","length","equals","hash2","pkh","chunks"],"sources":["C:/Users/acer/node_modules/bitcoinjs-lib/src/payments/p2pkh.js"],"sourcesContent":["'use strict';\nObject.defineProperty(exports, '__esModule', { value: true });\nconst bcrypto = require('../crypto');\nconst networks_1 = require('../networks');\nconst bscript = require('../script');\nconst lazy = require('./lazy');\nconst typef = require('typeforce');\nconst OPS = bscript.OPS;\nconst ecc = require('tiny-secp256k1');\nconst bs58check = require('bs58check');\n// input: {signature} {pubkey}\n// output: OP_DUP OP_HASH160 {hash160(pubkey)} OP_EQUALVERIFY OP_CHECKSIG\nfunction p2pkh(a, opts) {\n  if (!a.address && !a.hash && !a.output && !a.pubkey && !a.input)\n    throw new TypeError('Not enough data');\n  opts = Object.assign({ validate: true }, opts || {});\n  typef(\n    {\n      network: typef.maybe(typef.Object),\n      address: typef.maybe(typef.String),\n      hash: typef.maybe(typef.BufferN(20)),\n      output: typef.maybe(typef.BufferN(25)),\n      pubkey: typef.maybe(ecc.isPoint),\n      signature: typef.maybe(bscript.isCanonicalScriptSignature),\n      input: typef.maybe(typef.Buffer),\n    },\n    a,\n  );\n  const _address = lazy.value(() => {\n    const payload = bs58check.decode(a.address);\n    const version = payload.readUInt8(0);\n    const hash = payload.slice(1);\n    return { version, hash };\n  });\n  const _chunks = lazy.value(() => {\n    return bscript.decompile(a.input);\n  });\n  const network = a.network || networks_1.bitcoin;\n  const o = { name: 'p2pkh', network };\n  lazy.prop(o, 'address', () => {\n    if (!o.hash) return;\n    const payload = Buffer.allocUnsafe(21);\n    payload.writeUInt8(network.pubKeyHash, 0);\n    o.hash.copy(payload, 1);\n    return bs58check.encode(payload);\n  });\n  lazy.prop(o, 'hash', () => {\n    if (a.output) return a.output.slice(3, 23);\n    if (a.address) return _address().hash;\n    if (a.pubkey || o.pubkey) return bcrypto.hash160(a.pubkey || o.pubkey);\n  });\n  lazy.prop(o, 'output', () => {\n    if (!o.hash) return;\n    return bscript.compile([\n      OPS.OP_DUP,\n      OPS.OP_HASH160,\n      o.hash,\n      OPS.OP_EQUALVERIFY,\n      OPS.OP_CHECKSIG,\n    ]);\n  });\n  lazy.prop(o, 'pubkey', () => {\n    if (!a.input) return;\n    return _chunks()[1];\n  });\n  lazy.prop(o, 'signature', () => {\n    if (!a.input) return;\n    return _chunks()[0];\n  });\n  lazy.prop(o, 'input', () => {\n    if (!a.pubkey) return;\n    if (!a.signature) return;\n    return bscript.compile([a.signature, a.pubkey]);\n  });\n  lazy.prop(o, 'witness', () => {\n    if (!o.input) return;\n    return [];\n  });\n  // extended validation\n  if (opts.validate) {\n    let hash = Buffer.from([]);\n    if (a.address) {\n      if (_address().version !== network.pubKeyHash)\n        throw new TypeError('Invalid version or Network mismatch');\n      if (_address().hash.length !== 20) throw new TypeError('Invalid address');\n      hash = _address().hash;\n    }\n    if (a.hash) {\n      if (hash.length > 0 && !hash.equals(a.hash))\n        throw new TypeError('Hash mismatch');\n      else hash = a.hash;\n    }\n    if (a.output) {\n      if (\n        a.output.length !== 25 ||\n        a.output[0] !== OPS.OP_DUP ||\n        a.output[1] !== OPS.OP_HASH160 ||\n        a.output[2] !== 0x14 ||\n        a.output[23] !== OPS.OP_EQUALVERIFY ||\n        a.output[24] !== OPS.OP_CHECKSIG\n      )\n        throw new TypeError('Output is invalid');\n      const hash2 = a.output.slice(3, 23);\n      if (hash.length > 0 && !hash.equals(hash2))\n        throw new TypeError('Hash mismatch');\n      else hash = hash2;\n    }\n    if (a.pubkey) {\n      const pkh = bcrypto.hash160(a.pubkey);\n      if (hash.length > 0 && !hash.equals(pkh))\n        throw new TypeError('Hash mismatch');\n      else hash = pkh;\n    }\n    if (a.input) {\n      const chunks = _chunks();\n      if (chunks.length !== 2) throw new TypeError('Input is invalid');\n      if (!bscript.isCanonicalScriptSignature(chunks[0]))\n        throw new TypeError('Input has invalid signature');\n      if (!ecc.isPoint(chunks[1]))\n        throw new TypeError('Input has invalid pubkey');\n      if (a.signature && !a.signature.equals(chunks[0]))\n        throw new TypeError('Signature mismatch');\n      if (a.pubkey && !a.pubkey.equals(chunks[1]))\n        throw new TypeError('Pubkey mismatch');\n      const pkh = bcrypto.hash160(chunks[1]);\n      if (hash.length > 0 && !hash.equals(pkh))\n        throw new TypeError('Hash mismatch');\n    }\n  }\n  return Object.assign(o, a);\n}\nexports.p2pkh = p2pkh;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}