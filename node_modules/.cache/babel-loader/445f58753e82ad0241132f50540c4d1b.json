{"ast":null,"code":"import { ConstraintMetadata } from './metadata/ConstraintMetadata';\nimport { ValidationMetadata } from './metadata/ValidationMetadata';\nimport { ValidationTypes } from './validation/ValidationTypes';\nimport { getFromContainer } from './container';\nimport { MetadataStorage, getMetadataStorage } from './metadata/MetadataStorage';\n/**\n * Registers a custom validation decorator.\n */\n\nexport function registerDecorator(options) {\n  var constraintCls;\n\n  if (options.validator instanceof Function) {\n    constraintCls = options.validator;\n    var constraintClasses = getFromContainer(MetadataStorage).getTargetValidatorConstraints(options.validator);\n\n    if (constraintClasses.length > 1) {\n      throw \"More than one implementation of ValidatorConstraintInterface found for validator on: \" + options.target.name + \":\" + options.propertyName;\n    }\n  } else {\n    var validator_1 = options.validator;\n\n    constraintCls =\n    /** @class */\n    function () {\n      function CustomConstraint() {}\n\n      CustomConstraint.prototype.validate = function (value, validationArguments) {\n        return validator_1.validate(value, validationArguments);\n      };\n\n      CustomConstraint.prototype.defaultMessage = function (validationArguments) {\n        if (validator_1.defaultMessage) {\n          return validator_1.defaultMessage(validationArguments);\n        }\n\n        return '';\n      };\n\n      return CustomConstraint;\n    }();\n\n    getMetadataStorage().addConstraintMetadata(new ConstraintMetadata(constraintCls, options.name, options.async));\n  }\n\n  var validationMetadataArgs = {\n    type: options.name && ValidationTypes.isValid(options.name) ? options.name : ValidationTypes.CUSTOM_VALIDATION,\n    target: options.target,\n    propertyName: options.propertyName,\n    validationOptions: options.options,\n    constraintCls: constraintCls,\n    constraints: options.constraints\n  };\n  getMetadataStorage().addValidationMetadata(new ValidationMetadata(validationMetadataArgs));\n}","map":{"version":3,"mappings":"AAAA,SAASA,kBAAT,QAAmC,+BAAnC;AAEA,SAASC,kBAAT,QAAmC,+BAAnC;AAEA,SAASC,eAAT,QAAgC,8BAAhC;AAEA,SAASC,gBAAT,QAAiC,aAAjC;AACA,SAASC,eAAT,EAA0BC,kBAA1B,QAAoD,4BAApD;AAwCA;;;;AAGA,OAAM,SAAUC,iBAAV,CAA4BC,OAA5B,EAA+D;EACnE,IAAIC,aAAJ;;EACA,IAAID,OAAO,CAACE,SAAR,YAA6BC,QAAjC,EAA2C;IACzCF,aAAa,GAAGD,OAAO,CAACE,SAAxB;IACA,IAAME,iBAAiB,GAAGR,gBAAgB,CAACC,eAAD,CAAhB,CAAkCQ,6BAAlC,CAAgEL,OAAO,CAACE,SAAxE,CAA1B;;IACA,IAAIE,iBAAiB,CAACE,MAAlB,GAA2B,CAA/B,EAAkC;MAChC,MAAM,0FAAwFN,OAAO,CAACO,MAAR,CAAeC,IAAvG,GAA2G,GAA3G,GAA+GR,OAAO,CAACS,YAA7H;IACD;EACF,CAND,MAMO;IACL,IAAMC,WAAS,GAAGV,OAAO,CAACE,SAA1B;;IACAD,aAAa;IAAA;IAAA;MAAG,6BAYf;;MAXCU,gDAASC,KAAT,EAAqBC,mBAArB,EAA8D;QAC5D,OAAOH,WAAS,CAACI,QAAV,CAAmBF,KAAnB,EAA0BC,mBAA1B,CAAP;MACD,CAFD;;MAIAF,sDAAeE,mBAAf,EAAwD;QACtD,IAAIH,WAAS,CAACK,cAAd,EAA8B;UAC5B,OAAOL,WAAS,CAACK,cAAV,CAAyBF,mBAAzB,CAAP;QACD;;QAED,OAAO,EAAP;MACD,CAND;;MAOF;IAAC,CAZY,EAAb;;IAaAf,kBAAkB,GAAGkB,qBAArB,CAA2C,IAAIvB,kBAAJ,CAAuBQ,aAAvB,EAAsCD,OAAO,CAACQ,IAA9C,EAAoDR,OAAO,CAACiB,KAA5D,CAA3C;EACD;;EAED,IAAMC,sBAAsB,GAA2B;IACrDC,IAAI,EAAEnB,OAAO,CAACQ,IAAR,IAAgBb,eAAe,CAACyB,OAAhB,CAAwBpB,OAAO,CAACQ,IAAhC,CAAhB,GAAwDR,OAAO,CAACQ,IAAhE,GAAuEb,eAAe,CAAC0B,iBADxC;IAErDd,MAAM,EAAEP,OAAO,CAACO,MAFqC;IAGrDE,YAAY,EAAET,OAAO,CAACS,YAH+B;IAIrDa,iBAAiB,EAAEtB,OAAO,CAACA,OAJ0B;IAKrDC,aAAa,EAAEA,aALsC;IAMrDsB,WAAW,EAAEvB,OAAO,CAACuB;EANgC,CAAvD;EAQAzB,kBAAkB,GAAG0B,qBAArB,CAA2C,IAAI9B,kBAAJ,CAAuBwB,sBAAvB,CAA3C;AACD","names":["ConstraintMetadata","ValidationMetadata","ValidationTypes","getFromContainer","MetadataStorage","getMetadataStorage","registerDecorator","options","constraintCls","validator","Function","constraintClasses","getTargetValidatorConstraints","length","target","name","propertyName","validator_1","CustomConstraint","value","validationArguments","validate","defaultMessage","addConstraintMetadata","async","validationMetadataArgs","type","isValid","CUSTOM_VALIDATION","validationOptions","constraints","addValidationMetadata"],"sourceRoot":"","sources":["../../src/register-decorator.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}