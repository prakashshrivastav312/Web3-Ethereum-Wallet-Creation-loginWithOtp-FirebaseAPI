{"ast":null,"code":"'use strict';\n/* jshint maxparams:5 */\n\nvar _ = require('lodash');\n\nvar inherits = require('inherits');\n\nvar Input = require('./input');\n\nvar Output = require('../output');\n\nvar $ = require('../../util/preconditions');\n\nvar Address = require('../../address');\n\nvar Script = require('../../script');\n\nvar Signature = require('../../crypto/signature');\n\nvar Sighash = require('../sighash');\n\nvar SighashWitness = require('../sighashwitness');\n\nvar BufferWriter = require('../../encoding/bufferwriter');\n\nvar BufferUtil = require('../../util/buffer');\n\nvar TransactionSignature = require('../signature');\n/**\n * @constructor\n */\n\n\nfunction MultiSigScriptHashInput(input, pubkeys, threshold, signatures, opts) {\n  /* jshint maxstatements:20 */\n  opts = opts || {};\n  Input.apply(this, arguments);\n  var self = this;\n  pubkeys = pubkeys || input.publicKeys;\n  threshold = threshold || input.threshold;\n  signatures = signatures || input.signatures;\n\n  if (opts.noSorting) {\n    this.publicKeys = pubkeys;\n  } else {\n    this.publicKeys = _.sortBy(pubkeys, function (publicKey) {\n      return publicKey.toString('hex');\n    });\n  }\n\n  this.redeemScript = Script.buildMultisigOut(this.publicKeys, threshold, opts);\n  var nested = Script.buildWitnessMultisigOutFromScript(this.redeemScript);\n\n  if (nested.equals(this.output.script)) {\n    this.nestedWitness = false;\n    this.type = Address.PayToWitnessScriptHash;\n  } else if (Script.buildScriptHashOut(nested).equals(this.output.script)) {\n    this.nestedWitness = true;\n    this.type = Address.PayToScriptHash;\n  } else if (Script.buildScriptHashOut(this.redeemScript).equals(this.output.script)) {\n    this.nestedWitness = false;\n    this.type = Address.PayToScriptHash;\n  } else {\n    throw new Error('Provided public keys don\\'t hash to the provided output');\n  }\n\n  if (this.nestedWitness) {\n    var scriptSig = new Script();\n    scriptSig.add(nested.toBuffer());\n    this.setScript(scriptSig);\n  }\n\n  this.publicKeyIndex = {};\n\n  _.each(this.publicKeys, function (publicKey, index) {\n    self.publicKeyIndex[publicKey.toString()] = index;\n  });\n\n  this.threshold = threshold; // Empty array of signatures\n\n  this.signatures = signatures ? this._deserializeSignatures(signatures) : new Array(this.publicKeys.length);\n}\n\ninherits(MultiSigScriptHashInput, Input);\n\nMultiSigScriptHashInput.prototype.toObject = function () {\n  var obj = Input.prototype.toObject.apply(this, arguments);\n  obj.threshold = this.threshold;\n  obj.publicKeys = _.map(this.publicKeys, function (publicKey) {\n    return publicKey.toString();\n  });\n  obj.signatures = this._serializeSignatures();\n  return obj;\n};\n\nMultiSigScriptHashInput.prototype._deserializeSignatures = function (signatures) {\n  return _.map(signatures, function (signature) {\n    if (!signature) {\n      return undefined;\n    }\n\n    return new TransactionSignature(signature);\n  });\n};\n\nMultiSigScriptHashInput.prototype._serializeSignatures = function () {\n  return _.map(this.signatures, function (signature) {\n    if (!signature) {\n      return undefined;\n    }\n\n    return signature.toObject();\n  });\n};\n\nMultiSigScriptHashInput.prototype.getScriptCode = function () {\n  var writer = new BufferWriter();\n\n  if (!this.redeemScript.hasCodeseparators()) {\n    var redeemScriptBuffer = this.redeemScript.toBuffer();\n    writer.writeVarintNum(redeemScriptBuffer.length);\n    writer.write(redeemScriptBuffer);\n  } else {\n    throw new Error('@TODO');\n  }\n\n  return writer.toBuffer();\n};\n\nMultiSigScriptHashInput.prototype.getSighash = function (transaction, privateKey, index, sigtype) {\n  var self = this;\n  var hash;\n\n  if (self.nestedWitness || self.type === Address.PayToWitnessScriptHash) {\n    var scriptCode = self.getScriptCode();\n    var satoshisBuffer = self.getSatoshisBuffer();\n    hash = SighashWitness.sighash(transaction, sigtype, index, scriptCode, satoshisBuffer);\n  } else {\n    hash = Sighash.sighash(transaction, sigtype, index, self.redeemScript);\n  }\n\n  return hash;\n};\n\nMultiSigScriptHashInput.prototype.getSignatures = function (transaction, privateKey, index, sigtype, hashData, signingMethod) {\n  $.checkState(this.output instanceof Output);\n  sigtype = sigtype || Signature.SIGHASH_ALL;\n  signingMethod = signingMethod || 'ecdsa';\n  var self = this;\n  var results = [];\n\n  _.each(this.publicKeys, function (publicKey) {\n    if (publicKey.toString() === privateKey.publicKey.toString()) {\n      var signature;\n\n      if (self.nestedWitness || self.type === Address.PayToWitnessScriptHash) {\n        var scriptCode = self.getScriptCode();\n        var satoshisBuffer = self.getSatoshisBuffer();\n        signature = SighashWitness.sign(transaction, privateKey, sigtype, index, scriptCode, satoshisBuffer, signingMethod);\n      } else {\n        signature = Sighash.sign(transaction, privateKey, sigtype, index, self.redeemScript, signingMethod);\n      }\n\n      results.push(new TransactionSignature({\n        publicKey: privateKey.publicKey,\n        prevTxId: self.prevTxId,\n        outputIndex: self.outputIndex,\n        inputIndex: index,\n        signature: signature,\n        sigtype: sigtype\n      }));\n    }\n  });\n\n  return results;\n};\n\nMultiSigScriptHashInput.prototype.addSignature = function (transaction, signature, signingMethod) {\n  $.checkState(!this.isFullySigned(), 'All needed signatures have already been added');\n  $.checkArgument(!_.isUndefined(this.publicKeyIndex[signature.publicKey.toString()]), 'Signature has no matching public key');\n  $.checkState(this.isValidSignature(transaction, signature, signingMethod), \"Invalid Signature!\");\n  this.signatures[this.publicKeyIndex[signature.publicKey.toString()]] = signature;\n\n  this._updateScript();\n\n  return this;\n};\n\nMultiSigScriptHashInput.prototype._updateScript = function () {\n  if (this.nestedWitness || this.type === Address.PayToWitnessScriptHash) {\n    var stack = [Buffer.alloc(0)];\n\n    var signatures = this._createSignatures();\n\n    for (var i = 0; i < signatures.length; i++) {\n      stack.push(signatures[i]);\n    }\n\n    stack.push(this.redeemScript.toBuffer());\n    this.setWitnesses(stack);\n  } else {\n    var scriptSig = Script.buildP2SHMultisigIn(this.publicKeys, this.threshold, this._createSignatures(), {\n      cachedMultisig: this.redeemScript\n    });\n    this.setScript(scriptSig);\n  }\n\n  return this;\n};\n\nMultiSigScriptHashInput.prototype._createSignatures = function () {\n  return _.map(_.filter(this.signatures, function (signature) {\n    return !_.isUndefined(signature);\n  }), function (signature) {\n    return BufferUtil.concat([signature.signature.toDER(), BufferUtil.integerAsSingleByteBuffer(signature.sigtype)]);\n  });\n};\n\nMultiSigScriptHashInput.prototype.clearSignatures = function () {\n  this.signatures = new Array(this.publicKeys.length);\n\n  this._updateScript();\n};\n\nMultiSigScriptHashInput.prototype.isFullySigned = function () {\n  return this.countSignatures() === this.threshold;\n};\n\nMultiSigScriptHashInput.prototype.countMissingSignatures = function () {\n  return this.threshold - this.countSignatures();\n};\n\nMultiSigScriptHashInput.prototype.countSignatures = function () {\n  return _.reduce(this.signatures, function (sum, signature) {\n    return sum + !!signature;\n  }, 0);\n};\n\nMultiSigScriptHashInput.prototype.publicKeysWithoutSignature = function () {\n  var self = this;\n  return _.filter(this.publicKeys, function (publicKey) {\n    return !self.signatures[self.publicKeyIndex[publicKey.toString()]];\n  });\n};\n\nMultiSigScriptHashInput.prototype.isValidSignature = function (transaction, signature, signingMethod) {\n  signingMethod = signingMethod || 'ecdsa';\n\n  if (this.nestedWitness || this.type === Address.PayToWitnessScriptHash) {\n    signature.signature.nhashtype = signature.sigtype;\n    var scriptCode = this.getScriptCode();\n    var satoshisBuffer = this.getSatoshisBuffer();\n    return SighashWitness.verify(transaction, signature.signature, signature.publicKey, signature.inputIndex, scriptCode, satoshisBuffer, signingMethod);\n  } else {\n    // FIXME: Refactor signature so this is not necessary\n    signature.signature.nhashtype = signature.sigtype;\n    return Sighash.verify(transaction, signature.signature, signature.publicKey, signature.inputIndex, this.redeemScript, signingMethod);\n  }\n};\n\nMultiSigScriptHashInput.OPCODES_SIZE = 7; // serialized size (<=3) + 0 .. N .. M OP_CHECKMULTISIG\n\nMultiSigScriptHashInput.SIGNATURE_SIZE = 74; // size (1) + DER (<=72) + sighash (1)\n\nMultiSigScriptHashInput.PUBKEY_SIZE = 34; // size (1) + DER (<=33)\n\nMultiSigScriptHashInput.REDEEM_SCRIPT_SIZE = 34; // OP_0 (1) + scriptHash (1 + 32)\n\nMultiSigScriptHashInput.prototype._estimateSize = function () {\n  var WITNESS_DISCOUNT = 4;\n  var witnessSize = MultiSigScriptHashInput.OPCODES_SIZE + this.threshold * MultiSigScriptHashInput.SIGNATURE_SIZE + this.publicKeys.length * MultiSigScriptHashInput.PUBKEY_SIZE;\n\n  if (this.type === Address.PayToWitnessScriptHash) {\n    return witnessSize / WITNESS_DISCOUNT;\n  } else if (this.nestedWitness) {\n    return witnessSize / WITNESS_DISCOUNT + MultiSigScriptHashInput.REDEEM_SCRIPT_SIZE;\n  } else {\n    return witnessSize;\n  }\n};\n\nmodule.exports = MultiSigScriptHashInput;","map":{"version":3,"names":["_","require","inherits","Input","Output","$","Address","Script","Signature","Sighash","SighashWitness","BufferWriter","BufferUtil","TransactionSignature","MultiSigScriptHashInput","input","pubkeys","threshold","signatures","opts","apply","arguments","self","publicKeys","noSorting","sortBy","publicKey","toString","redeemScript","buildMultisigOut","nested","buildWitnessMultisigOutFromScript","equals","output","script","nestedWitness","type","PayToWitnessScriptHash","buildScriptHashOut","PayToScriptHash","Error","scriptSig","add","toBuffer","setScript","publicKeyIndex","each","index","_deserializeSignatures","Array","length","prototype","toObject","obj","map","_serializeSignatures","signature","undefined","getScriptCode","writer","hasCodeseparators","redeemScriptBuffer","writeVarintNum","write","getSighash","transaction","privateKey","sigtype","hash","scriptCode","satoshisBuffer","getSatoshisBuffer","sighash","getSignatures","hashData","signingMethod","checkState","SIGHASH_ALL","results","sign","push","prevTxId","outputIndex","inputIndex","addSignature","isFullySigned","checkArgument","isUndefined","isValidSignature","_updateScript","stack","Buffer","alloc","_createSignatures","i","setWitnesses","buildP2SHMultisigIn","cachedMultisig","filter","concat","toDER","integerAsSingleByteBuffer","clearSignatures","countSignatures","countMissingSignatures","reduce","sum","publicKeysWithoutSignature","nhashtype","verify","OPCODES_SIZE","SIGNATURE_SIZE","PUBKEY_SIZE","REDEEM_SCRIPT_SIZE","_estimateSize","WITNESS_DISCOUNT","witnessSize","module","exports"],"sources":["C:/Users/acer/node_modules/bitcore-lib-ltc/lib/transaction/input/multisigscripthash.js"],"sourcesContent":["'use strict';\n\n/* jshint maxparams:5 */\n\nvar _ = require('lodash');\nvar inherits = require('inherits');\nvar Input = require('./input');\nvar Output = require('../output');\nvar $ = require('../../util/preconditions');\n\nvar Address = require('../../address');\nvar Script = require('../../script');\nvar Signature = require('../../crypto/signature');\nvar Sighash = require('../sighash');\nvar SighashWitness = require('../sighashwitness');\nvar BufferWriter = require('../../encoding/bufferwriter');\nvar BufferUtil = require('../../util/buffer');\nvar TransactionSignature = require('../signature');\n\n/**\n * @constructor\n */\nfunction MultiSigScriptHashInput(input, pubkeys, threshold, signatures, opts) {\n  /* jshint maxstatements:20 */\n  opts = opts || {};\n  Input.apply(this, arguments);\n  var self = this;\n  pubkeys = pubkeys || input.publicKeys;\n  threshold = threshold || input.threshold;\n  signatures = signatures || input.signatures;\n  if (opts.noSorting) {\n    this.publicKeys = pubkeys;\n  } else  {\n    this.publicKeys = _.sortBy(pubkeys, function(publicKey) { return publicKey.toString('hex'); });\n  }\n  this.redeemScript = Script.buildMultisigOut(this.publicKeys, threshold, opts);\n  var nested = Script.buildWitnessMultisigOutFromScript(this.redeemScript);\n  if (nested.equals(this.output.script)) {\n    this.nestedWitness = false;\n    this.type = Address.PayToWitnessScriptHash;\n  } else if (Script.buildScriptHashOut(nested).equals(this.output.script)) {\n    this.nestedWitness = true;\n    this.type = Address.PayToScriptHash;\n  } else if (Script.buildScriptHashOut(this.redeemScript).equals(this.output.script)) {\n    this.nestedWitness = false;\n    this.type = Address.PayToScriptHash;\n  } else {\n    throw new Error('Provided public keys don\\'t hash to the provided output');\n  }\n\n  if (this.nestedWitness) {\n    var scriptSig = new Script();\n    scriptSig.add(nested.toBuffer());\n    this.setScript(scriptSig);\n  }\n\n  this.publicKeyIndex = {};\n  _.each(this.publicKeys, function(publicKey, index) {\n    self.publicKeyIndex[publicKey.toString()] = index;\n  });\n  this.threshold = threshold;\n  // Empty array of signatures\n  this.signatures = signatures ? this._deserializeSignatures(signatures) : new Array(this.publicKeys.length);\n}\ninherits(MultiSigScriptHashInput, Input);\n\nMultiSigScriptHashInput.prototype.toObject = function() {\n  var obj = Input.prototype.toObject.apply(this, arguments);\n  obj.threshold = this.threshold;\n  obj.publicKeys = _.map(this.publicKeys, function(publicKey) { return publicKey.toString(); });\n  obj.signatures = this._serializeSignatures();\n  return obj;\n};\n\nMultiSigScriptHashInput.prototype._deserializeSignatures = function(signatures) {\n  return _.map(signatures, function(signature) {\n    if (!signature) {\n      return undefined;\n    }\n    return new TransactionSignature(signature);\n  });\n};\n\nMultiSigScriptHashInput.prototype._serializeSignatures = function() {\n  return _.map(this.signatures, function(signature) {\n    if (!signature) {\n      return undefined;\n    }\n    return signature.toObject();\n  });\n};\n\nMultiSigScriptHashInput.prototype.getScriptCode = function() {\n  var writer = new BufferWriter();\n  if (!this.redeemScript.hasCodeseparators()) {\n    var redeemScriptBuffer = this.redeemScript.toBuffer();\n    writer.writeVarintNum(redeemScriptBuffer.length);\n    writer.write(redeemScriptBuffer);\n  } else {\n    throw new Error('@TODO');\n  }\n  return writer.toBuffer();\n};\n\nMultiSigScriptHashInput.prototype.getSighash = function(transaction, privateKey, index, sigtype) {\n  var self = this;\n  var hash;\n  if (self.nestedWitness || self.type === Address.PayToWitnessScriptHash) {\n    var scriptCode = self.getScriptCode();\n    var satoshisBuffer = self.getSatoshisBuffer();\n    hash = SighashWitness.sighash(transaction, sigtype, index, scriptCode, satoshisBuffer);\n  } else  {\n    hash = Sighash.sighash(transaction, sigtype, index, self.redeemScript);\n  }\n  return hash;\n};\n\nMultiSigScriptHashInput.prototype.getSignatures = function(transaction, privateKey, index, sigtype, hashData, signingMethod) {\n  $.checkState(this.output instanceof Output);\n  sigtype = sigtype || Signature.SIGHASH_ALL;\n  signingMethod = signingMethod || 'ecdsa';\n\n  var self = this;\n  var results = [];\n  _.each(this.publicKeys, function(publicKey) {\n    if (publicKey.toString() === privateKey.publicKey.toString()) {\n      var signature;\n      if (self.nestedWitness || self.type === Address.PayToWitnessScriptHash) {\n        var scriptCode = self.getScriptCode();\n        var satoshisBuffer = self.getSatoshisBuffer();\n        signature = SighashWitness.sign(transaction, privateKey, sigtype, index, scriptCode, satoshisBuffer, signingMethod);\n      } else  {\n        signature = Sighash.sign(transaction, privateKey, sigtype, index, self.redeemScript, signingMethod);\n      }\n      results.push(new TransactionSignature({\n        publicKey: privateKey.publicKey,\n        prevTxId: self.prevTxId,\n        outputIndex: self.outputIndex,\n        inputIndex: index,\n        signature: signature,\n        sigtype: sigtype\n      }));\n    }\n  });\n  return results;\n};\n\nMultiSigScriptHashInput.prototype.addSignature = function(transaction, signature, signingMethod) {\n  $.checkState(!this.isFullySigned(), 'All needed signatures have already been added');\n  $.checkArgument(!_.isUndefined(this.publicKeyIndex[signature.publicKey.toString()]),\n                  'Signature has no matching public key');\n  $.checkState(this.isValidSignature(transaction, signature, signingMethod), \"Invalid Signature!\");\n  this.signatures[this.publicKeyIndex[signature.publicKey.toString()]] = signature;\n  this._updateScript();\n  return this;\n};\n\nMultiSigScriptHashInput.prototype._updateScript = function() {\n  if (this.nestedWitness || this.type === Address.PayToWitnessScriptHash) {\n    var stack = [\n      Buffer.alloc(0),\n    ];\n    var signatures = this._createSignatures();\n    for (var i = 0; i < signatures.length; i++) {\n      stack.push(signatures[i]);\n    }\n    stack.push(this.redeemScript.toBuffer());\n    this.setWitnesses(stack);\n  } else {\n    var scriptSig = Script.buildP2SHMultisigIn(\n      this.publicKeys,\n      this.threshold,\n      this._createSignatures(),\n      { cachedMultisig: this.redeemScript }\n    );\n    this.setScript(scriptSig);\n  }\n  return this;\n};\n\nMultiSigScriptHashInput.prototype._createSignatures = function() {\n  return _.map(\n    _.filter(this.signatures, function(signature) { return !_.isUndefined(signature); }),\n    function(signature) {\n      return BufferUtil.concat([\n        signature.signature.toDER(),\n        BufferUtil.integerAsSingleByteBuffer(signature.sigtype)\n      ]);\n    }\n  );\n};\n\nMultiSigScriptHashInput.prototype.clearSignatures = function() {\n  this.signatures = new Array(this.publicKeys.length);\n  this._updateScript();\n};\n\nMultiSigScriptHashInput.prototype.isFullySigned = function() {\n  return this.countSignatures() === this.threshold;\n};\n\nMultiSigScriptHashInput.prototype.countMissingSignatures = function() {\n  return this.threshold - this.countSignatures();\n};\n\nMultiSigScriptHashInput.prototype.countSignatures = function() {\n  return _.reduce(this.signatures, function(sum, signature) {\n    return sum + (!!signature);\n  }, 0);\n};\n\nMultiSigScriptHashInput.prototype.publicKeysWithoutSignature = function() {\n  var self = this;\n  return _.filter(this.publicKeys, function(publicKey) {\n    return !(self.signatures[self.publicKeyIndex[publicKey.toString()]]);\n  });\n};\n\nMultiSigScriptHashInput.prototype.isValidSignature = function(transaction, signature, signingMethod) {\n  signingMethod = signingMethod || 'ecdsa';\n  if (this.nestedWitness || this.type === Address.PayToWitnessScriptHash) {\n    signature.signature.nhashtype = signature.sigtype;\n    var scriptCode = this.getScriptCode();\n    var satoshisBuffer = this.getSatoshisBuffer();\n    return SighashWitness.verify(\n      transaction,\n      signature.signature,\n      signature.publicKey,\n      signature.inputIndex,\n      scriptCode,\n      satoshisBuffer,\n      signingMethod\n    );\n  } else {\n    // FIXME: Refactor signature so this is not necessary\n    signature.signature.nhashtype = signature.sigtype;\n    return Sighash.verify(\n      transaction,\n      signature.signature,\n      signature.publicKey,\n      signature.inputIndex,\n      this.redeemScript, \n      signingMethod\n    );\n  }\n};\n\nMultiSigScriptHashInput.OPCODES_SIZE = 7; // serialized size (<=3) + 0 .. N .. M OP_CHECKMULTISIG\nMultiSigScriptHashInput.SIGNATURE_SIZE = 74; // size (1) + DER (<=72) + sighash (1)\nMultiSigScriptHashInput.PUBKEY_SIZE = 34; // size (1) + DER (<=33)\nMultiSigScriptHashInput.REDEEM_SCRIPT_SIZE = 34; // OP_0 (1) + scriptHash (1 + 32)\n\nMultiSigScriptHashInput.prototype._estimateSize = function() {\n  var WITNESS_DISCOUNT = 4;\n  var witnessSize = MultiSigScriptHashInput.OPCODES_SIZE +\n    this.threshold * MultiSigScriptHashInput.SIGNATURE_SIZE +\n    this.publicKeys.length * MultiSigScriptHashInput.PUBKEY_SIZE;\n  if (this.type === Address.PayToWitnessScriptHash) {\n    return witnessSize / WITNESS_DISCOUNT;\n  } else if (this.nestedWitness) {\n    return witnessSize / WITNESS_DISCOUNT + MultiSigScriptHashInput.REDEEM_SCRIPT_SIZE;\n  } else {\n    return witnessSize;\n  }\n};\n\nmodule.exports = MultiSigScriptHashInput;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}