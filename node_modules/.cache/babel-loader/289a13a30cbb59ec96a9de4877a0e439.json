{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nconst typeFields_1 = require('../../typeFields');\n\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.InputTypes.TAP_LEAF_SCRIPT) {\n    throw new Error('Decode Error: could not decode tapLeafScript with key 0x' + keyVal.key.toString('hex'));\n  }\n\n  if ((keyVal.key.length - 2) % 32 !== 0) {\n    throw new Error('Decode Error: tapLeafScript has invalid control block in key 0x' + keyVal.key.toString('hex'));\n  }\n\n  const leafVersion = keyVal.value[keyVal.value.length - 1];\n\n  if ((keyVal.key[1] & 0xfe) !== leafVersion) {\n    throw new Error('Decode Error: tapLeafScript bad leaf version in key 0x' + keyVal.key.toString('hex'));\n  }\n\n  const script = keyVal.value.slice(0, -1);\n  const controlBlock = keyVal.key.slice(1);\n  return {\n    controlBlock,\n    script,\n    leafVersion\n  };\n}\n\nexports.decode = decode;\n\nfunction encode(tScript) {\n  const head = Buffer.from([typeFields_1.InputTypes.TAP_LEAF_SCRIPT]);\n  const verBuf = Buffer.from([tScript.leafVersion]);\n  return {\n    key: Buffer.concat([head, tScript.controlBlock]),\n    value: Buffer.concat([tScript.script, verBuf])\n  };\n}\n\nexports.encode = encode;\nexports.expected = '{ controlBlock: Buffer; leafVersion: number, script: Buffer; }';\n\nfunction check(data) {\n  return Buffer.isBuffer(data.controlBlock) && (data.controlBlock.length - 1) % 32 === 0 && (data.controlBlock[0] & 0xfe) === data.leafVersion && Buffer.isBuffer(data.script);\n}\n\nexports.check = check;\n\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString = item.controlBlock.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return array.filter(v => v.controlBlock.equals(item.controlBlock)).length === 0;\n}\n\nexports.canAddToArray = canAddToArray;","map":{"version":3,"names":["Object","defineProperty","exports","value","typeFields_1","require","decode","keyVal","key","InputTypes","TAP_LEAF_SCRIPT","Error","toString","length","leafVersion","script","slice","controlBlock","encode","tScript","head","Buffer","from","verBuf","concat","expected","check","data","isBuffer","canAddToArray","array","item","dupeSet","dupeString","has","add","filter","v","equals"],"sources":["C:/Users/acer/node_modules/bip174/src/lib/converter/input/tapLeafScript.js"],"sourcesContent":["'use strict';\nObject.defineProperty(exports, '__esModule', { value: true });\nconst typeFields_1 = require('../../typeFields');\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.InputTypes.TAP_LEAF_SCRIPT) {\n    throw new Error(\n      'Decode Error: could not decode tapLeafScript with key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  if ((keyVal.key.length - 2) % 32 !== 0) {\n    throw new Error(\n      'Decode Error: tapLeafScript has invalid control block in key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  const leafVersion = keyVal.value[keyVal.value.length - 1];\n  if ((keyVal.key[1] & 0xfe) !== leafVersion) {\n    throw new Error(\n      'Decode Error: tapLeafScript bad leaf version in key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  const script = keyVal.value.slice(0, -1);\n  const controlBlock = keyVal.key.slice(1);\n  return { controlBlock, script, leafVersion };\n}\nexports.decode = decode;\nfunction encode(tScript) {\n  const head = Buffer.from([typeFields_1.InputTypes.TAP_LEAF_SCRIPT]);\n  const verBuf = Buffer.from([tScript.leafVersion]);\n  return {\n    key: Buffer.concat([head, tScript.controlBlock]),\n    value: Buffer.concat([tScript.script, verBuf]),\n  };\n}\nexports.encode = encode;\nexports.expected =\n  '{ controlBlock: Buffer; leafVersion: number, script: Buffer; }';\nfunction check(data) {\n  return (\n    Buffer.isBuffer(data.controlBlock) &&\n    (data.controlBlock.length - 1) % 32 === 0 &&\n    (data.controlBlock[0] & 0xfe) === data.leafVersion &&\n    Buffer.isBuffer(data.script)\n  );\n}\nexports.check = check;\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString = item.controlBlock.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return (\n    array.filter(v => v.controlBlock.equals(item.controlBlock)).length === 0\n  );\n}\nexports.canAddToArray = canAddToArray;\n"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;;AACA,MAAMC,YAAY,GAAGC,OAAO,CAAC,kBAAD,CAA5B;;AACA,SAASC,MAAT,CAAgBC,MAAhB,EAAwB;EACtB,IAAIA,MAAM,CAACC,GAAP,CAAW,CAAX,MAAkBJ,YAAY,CAACK,UAAb,CAAwBC,eAA9C,EAA+D;IAC7D,MAAM,IAAIC,KAAJ,CACJ,6DACEJ,MAAM,CAACC,GAAP,CAAWI,QAAX,CAAoB,KAApB,CAFE,CAAN;EAID;;EACD,IAAI,CAACL,MAAM,CAACC,GAAP,CAAWK,MAAX,GAAoB,CAArB,IAA0B,EAA1B,KAAiC,CAArC,EAAwC;IACtC,MAAM,IAAIF,KAAJ,CACJ,oEACEJ,MAAM,CAACC,GAAP,CAAWI,QAAX,CAAoB,KAApB,CAFE,CAAN;EAID;;EACD,MAAME,WAAW,GAAGP,MAAM,CAACJ,KAAP,CAAaI,MAAM,CAACJ,KAAP,CAAaU,MAAb,GAAsB,CAAnC,CAApB;;EACA,IAAI,CAACN,MAAM,CAACC,GAAP,CAAW,CAAX,IAAgB,IAAjB,MAA2BM,WAA/B,EAA4C;IAC1C,MAAM,IAAIH,KAAJ,CACJ,2DACEJ,MAAM,CAACC,GAAP,CAAWI,QAAX,CAAoB,KAApB,CAFE,CAAN;EAID;;EACD,MAAMG,MAAM,GAAGR,MAAM,CAACJ,KAAP,CAAaa,KAAb,CAAmB,CAAnB,EAAsB,CAAC,CAAvB,CAAf;EACA,MAAMC,YAAY,GAAGV,MAAM,CAACC,GAAP,CAAWQ,KAAX,CAAiB,CAAjB,CAArB;EACA,OAAO;IAAEC,YAAF;IAAgBF,MAAhB;IAAwBD;EAAxB,CAAP;AACD;;AACDZ,OAAO,CAACI,MAAR,GAAiBA,MAAjB;;AACA,SAASY,MAAT,CAAgBC,OAAhB,EAAyB;EACvB,MAAMC,IAAI,GAAGC,MAAM,CAACC,IAAP,CAAY,CAAClB,YAAY,CAACK,UAAb,CAAwBC,eAAzB,CAAZ,CAAb;EACA,MAAMa,MAAM,GAAGF,MAAM,CAACC,IAAP,CAAY,CAACH,OAAO,CAACL,WAAT,CAAZ,CAAf;EACA,OAAO;IACLN,GAAG,EAAEa,MAAM,CAACG,MAAP,CAAc,CAACJ,IAAD,EAAOD,OAAO,CAACF,YAAf,CAAd,CADA;IAELd,KAAK,EAAEkB,MAAM,CAACG,MAAP,CAAc,CAACL,OAAO,CAACJ,MAAT,EAAiBQ,MAAjB,CAAd;EAFF,CAAP;AAID;;AACDrB,OAAO,CAACgB,MAAR,GAAiBA,MAAjB;AACAhB,OAAO,CAACuB,QAAR,GACE,gEADF;;AAEA,SAASC,KAAT,CAAeC,IAAf,EAAqB;EACnB,OACEN,MAAM,CAACO,QAAP,CAAgBD,IAAI,CAACV,YAArB,KACA,CAACU,IAAI,CAACV,YAAL,CAAkBJ,MAAlB,GAA2B,CAA5B,IAAiC,EAAjC,KAAwC,CADxC,IAEA,CAACc,IAAI,CAACV,YAAL,CAAkB,CAAlB,IAAuB,IAAxB,MAAkCU,IAAI,CAACb,WAFvC,IAGAO,MAAM,CAACO,QAAP,CAAgBD,IAAI,CAACZ,MAArB,CAJF;AAMD;;AACDb,OAAO,CAACwB,KAAR,GAAgBA,KAAhB;;AACA,SAASG,aAAT,CAAuBC,KAAvB,EAA8BC,IAA9B,EAAoCC,OAApC,EAA6C;EAC3C,MAAMC,UAAU,GAAGF,IAAI,CAACd,YAAL,CAAkBL,QAAlB,CAA2B,KAA3B,CAAnB;EACA,IAAIoB,OAAO,CAACE,GAAR,CAAYD,UAAZ,CAAJ,EAA6B,OAAO,KAAP;EAC7BD,OAAO,CAACG,GAAR,CAAYF,UAAZ;EACA,OACEH,KAAK,CAACM,MAAN,CAAaC,CAAC,IAAIA,CAAC,CAACpB,YAAF,CAAeqB,MAAf,CAAsBP,IAAI,CAACd,YAA3B,CAAlB,EAA4DJ,MAA5D,KAAuE,CADzE;AAGD;;AACDX,OAAO,CAAC2B,aAAR,GAAwBA,aAAxB"},"metadata":{},"sourceType":"script"}