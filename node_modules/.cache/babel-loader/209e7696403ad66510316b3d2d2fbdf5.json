{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nconst typeFields_1 = require('../../typeFields');\n\nconst range = n => [...Array(n).keys()];\n\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.GlobalTypes.GLOBAL_XPUB) {\n    throw new Error('Decode Error: could not decode globalXpub with key 0x' + keyVal.key.toString('hex'));\n  }\n\n  if (keyVal.key.length !== 79 || ![2, 3].includes(keyVal.key[46])) {\n    throw new Error('Decode Error: globalXpub has invalid extended pubkey in key 0x' + keyVal.key.toString('hex'));\n  }\n\n  if (keyVal.value.length / 4 % 1 !== 0) {\n    throw new Error('Decode Error: Global GLOBAL_XPUB value length should be multiple of 4');\n  }\n\n  const extendedPubkey = keyVal.key.slice(1);\n  const data = {\n    masterFingerprint: keyVal.value.slice(0, 4),\n    extendedPubkey,\n    path: 'm'\n  };\n\n  for (const i of range(keyVal.value.length / 4 - 1)) {\n    const val = keyVal.value.readUInt32LE(i * 4 + 4);\n    const isHard = !!(val & 0x80000000);\n    const idx = val & 0x7fffffff;\n    data.path += '/' + idx.toString(10) + (isHard ? \"'\" : '');\n  }\n\n  return data;\n}\n\nexports.decode = decode;\n\nfunction encode(data) {\n  const head = Buffer.from([typeFields_1.GlobalTypes.GLOBAL_XPUB]);\n  const key = Buffer.concat([head, data.extendedPubkey]);\n  const splitPath = data.path.split('/');\n  const value = Buffer.allocUnsafe(splitPath.length * 4);\n  data.masterFingerprint.copy(value, 0);\n  let offset = 4;\n  splitPath.slice(1).forEach(level => {\n    const isHard = level.slice(-1) === \"'\";\n    let num = 0x7fffffff & parseInt(isHard ? level.slice(0, -1) : level, 10);\n    if (isHard) num += 0x80000000;\n    value.writeUInt32LE(num, offset);\n    offset += 4;\n  });\n  return {\n    key,\n    value\n  };\n}\n\nexports.encode = encode;\nexports.expected = '{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }';\n\nfunction check(data) {\n  const epk = data.extendedPubkey;\n  const mfp = data.masterFingerprint;\n  const p = data.path;\n  return Buffer.isBuffer(epk) && epk.length === 78 && [2, 3].indexOf(epk[45]) > -1 && Buffer.isBuffer(mfp) && mfp.length === 4 && typeof p === 'string' && !!p.match(/^m(\\/\\d+'?)*$/);\n}\n\nexports.check = check;\n\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString = item.extendedPubkey.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return array.filter(v => v.extendedPubkey.equals(item.extendedPubkey)).length === 0;\n}\n\nexports.canAddToArray = canAddToArray;","map":{"version":3,"names":["Object","defineProperty","exports","value","typeFields_1","require","range","n","Array","keys","decode","keyVal","key","GlobalTypes","GLOBAL_XPUB","Error","toString","length","includes","extendedPubkey","slice","data","masterFingerprint","path","i","val","readUInt32LE","isHard","idx","encode","head","Buffer","from","concat","splitPath","split","allocUnsafe","copy","offset","forEach","level","num","parseInt","writeUInt32LE","expected","check","epk","mfp","p","isBuffer","indexOf","match","canAddToArray","array","item","dupeSet","dupeString","has","add","filter","v","equals"],"sources":["C:/Users/acer/node_modules/bip174/src/lib/converter/global/globalXpub.js"],"sourcesContent":["'use strict';\nObject.defineProperty(exports, '__esModule', { value: true });\nconst typeFields_1 = require('../../typeFields');\nconst range = n => [...Array(n).keys()];\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.GlobalTypes.GLOBAL_XPUB) {\n    throw new Error(\n      'Decode Error: could not decode globalXpub with key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  if (keyVal.key.length !== 79 || ![2, 3].includes(keyVal.key[46])) {\n    throw new Error(\n      'Decode Error: globalXpub has invalid extended pubkey in key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  if ((keyVal.value.length / 4) % 1 !== 0) {\n    throw new Error(\n      'Decode Error: Global GLOBAL_XPUB value length should be multiple of 4',\n    );\n  }\n  const extendedPubkey = keyVal.key.slice(1);\n  const data = {\n    masterFingerprint: keyVal.value.slice(0, 4),\n    extendedPubkey,\n    path: 'm',\n  };\n  for (const i of range(keyVal.value.length / 4 - 1)) {\n    const val = keyVal.value.readUInt32LE(i * 4 + 4);\n    const isHard = !!(val & 0x80000000);\n    const idx = val & 0x7fffffff;\n    data.path += '/' + idx.toString(10) + (isHard ? \"'\" : '');\n  }\n  return data;\n}\nexports.decode = decode;\nfunction encode(data) {\n  const head = Buffer.from([typeFields_1.GlobalTypes.GLOBAL_XPUB]);\n  const key = Buffer.concat([head, data.extendedPubkey]);\n  const splitPath = data.path.split('/');\n  const value = Buffer.allocUnsafe(splitPath.length * 4);\n  data.masterFingerprint.copy(value, 0);\n  let offset = 4;\n  splitPath.slice(1).forEach(level => {\n    const isHard = level.slice(-1) === \"'\";\n    let num = 0x7fffffff & parseInt(isHard ? level.slice(0, -1) : level, 10);\n    if (isHard) num += 0x80000000;\n    value.writeUInt32LE(num, offset);\n    offset += 4;\n  });\n  return {\n    key,\n    value,\n  };\n}\nexports.encode = encode;\nexports.expected =\n  '{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }';\nfunction check(data) {\n  const epk = data.extendedPubkey;\n  const mfp = data.masterFingerprint;\n  const p = data.path;\n  return (\n    Buffer.isBuffer(epk) &&\n    epk.length === 78 &&\n    [2, 3].indexOf(epk[45]) > -1 &&\n    Buffer.isBuffer(mfp) &&\n    mfp.length === 4 &&\n    typeof p === 'string' &&\n    !!p.match(/^m(\\/\\d+'?)*$/)\n  );\n}\nexports.check = check;\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString = item.extendedPubkey.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return (\n    array.filter(v => v.extendedPubkey.equals(item.extendedPubkey)).length === 0\n  );\n}\nexports.canAddToArray = canAddToArray;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}