{"ast":null,"code":"'use strict';\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar aes_js_1 = __importDefault(require(\"aes-js\"));\n\nvar scrypt_js_1 = __importDefault(require(\"scrypt-js\"));\n\nvar uuid_1 = __importDefault(require(\"uuid\"));\n\nvar signing_key_1 = require(\"./signing-key\");\n\nvar HDNode = __importStar(require(\"./hdnode\"));\n\nvar address_1 = require(\"./address\");\n\nvar bytes_1 = require(\"./bytes\");\n\nvar pbkdf2_1 = require(\"./pbkdf2\");\n\nvar keccak256_1 = require(\"./keccak256\");\n\nvar utf8_1 = require(\"./utf8\");\n\nvar random_bytes_1 = require(\"./random-bytes\");\n\nfunction looseArrayify(hexString) {\n  if (typeof hexString === 'string' && hexString.substring(0, 2) !== '0x') {\n    hexString = '0x' + hexString;\n  }\n\n  return bytes_1.arrayify(hexString);\n}\n\nfunction zpad(value, length) {\n  value = String(value);\n\n  while (value.length < length) {\n    value = '0' + value;\n  }\n\n  return value;\n}\n\nfunction getPassword(password) {\n  if (typeof password === 'string') {\n    return utf8_1.toUtf8Bytes(password, utf8_1.UnicodeNormalizationForm.NFKC);\n  }\n\n  return bytes_1.arrayify(password);\n} // Search an Object and its children recursively, caselessly.\n\n\nfunction searchPath(object, path) {\n  var currentChild = object;\n  var comps = path.toLowerCase().split('/');\n\n  for (var i = 0; i < comps.length; i++) {\n    // Search for a child object with a case-insensitive matching key\n    var matchingChild = null;\n\n    for (var key in currentChild) {\n      if (key.toLowerCase() === comps[i]) {\n        matchingChild = currentChild[key];\n        break;\n      }\n    } // Didn't find one. :'(\n\n\n    if (matchingChild === null) {\n      return null;\n    } // Now check this child...\n\n\n    currentChild = matchingChild;\n  }\n\n  return currentChild;\n} // @TODO: Make a type for string or arrayish\n// See: https://github.com/ethereum/pyethsaletool\n\n\nfunction decryptCrowdsale(json, password) {\n  var data = JSON.parse(json);\n  password = getPassword(password); // Ethereum Address\n\n  var ethaddr = address_1.getAddress(searchPath(data, 'ethaddr')); // Encrypted Seed\n\n  var encseed = looseArrayify(searchPath(data, 'encseed'));\n\n  if (!encseed || encseed.length % 16 !== 0) {\n    throw new Error('invalid encseed');\n  }\n\n  var key = pbkdf2_1.pbkdf2(password, password, 2000, 32, 'sha256').slice(0, 16);\n  var iv = encseed.slice(0, 16);\n  var encryptedSeed = encseed.slice(16); // Decrypt the seed\n\n  var aesCbc = new aes_js_1.default.ModeOfOperation.cbc(key, iv);\n  var seed = bytes_1.arrayify(aesCbc.decrypt(encryptedSeed));\n  seed = aes_js_1.default.padding.pkcs7.strip(seed); // This wallet format is weird... Convert the binary encoded hex to a string.\n\n  var seedHex = '';\n\n  for (var i = 0; i < seed.length; i++) {\n    seedHex += String.fromCharCode(seed[i]);\n  }\n\n  var seedHexBytes = utf8_1.toUtf8Bytes(seedHex);\n  var signingKey = new signing_key_1.SigningKey(keccak256_1.keccak256(seedHexBytes));\n\n  if (signingKey.address !== ethaddr) {\n    throw new Error('corrupt crowdsale wallet');\n  }\n\n  return signingKey;\n}\n\nexports.decryptCrowdsale = decryptCrowdsale; //@TODO: string or arrayish\n\nfunction decrypt(json, password, progressCallback) {\n  var data = JSON.parse(json);\n  var passwordBytes = getPassword(password);\n\n  var decrypt = function (key, ciphertext) {\n    var cipher = searchPath(data, 'crypto/cipher');\n\n    if (cipher === 'aes-128-ctr') {\n      var iv = looseArrayify(searchPath(data, 'crypto/cipherparams/iv'));\n      var counter = new aes_js_1.default.Counter(iv);\n      var aesCtr = new aes_js_1.default.ModeOfOperation.ctr(key, counter);\n      return bytes_1.arrayify(aesCtr.decrypt(ciphertext));\n    }\n\n    return null;\n  };\n\n  var computeMAC = function (derivedHalf, ciphertext) {\n    return keccak256_1.keccak256(bytes_1.concat([derivedHalf, ciphertext]));\n  };\n\n  var getSigningKey = function (key, reject) {\n    var ciphertext = looseArrayify(searchPath(data, 'crypto/ciphertext'));\n    var computedMAC = bytes_1.hexlify(computeMAC(key.slice(16, 32), ciphertext)).substring(2);\n\n    if (computedMAC !== searchPath(data, 'crypto/mac').toLowerCase()) {\n      reject(new Error('invalid password'));\n      return null;\n    }\n\n    var privateKey = decrypt(key.slice(0, 16), ciphertext);\n    var mnemonicKey = key.slice(32, 64);\n\n    if (!privateKey) {\n      reject(new Error('unsupported cipher'));\n      return null;\n    }\n\n    var signingKey = new signing_key_1.SigningKey(privateKey);\n\n    if (signingKey.address !== address_1.getAddress(data.address)) {\n      reject(new Error('address mismatch'));\n      return null;\n    } // Version 0.1 x-ethers metadata must contain an encrypted mnemonic phrase\n\n\n    if (searchPath(data, 'x-ethers/version') === '0.1') {\n      var mnemonicCiphertext = looseArrayify(searchPath(data, 'x-ethers/mnemonicCiphertext'));\n      var mnemonicIv = looseArrayify(searchPath(data, 'x-ethers/mnemonicCounter'));\n      var mnemonicCounter = new aes_js_1.default.Counter(mnemonicIv);\n      var mnemonicAesCtr = new aes_js_1.default.ModeOfOperation.ctr(mnemonicKey, mnemonicCounter);\n      var path = searchPath(data, 'x-ethers/path') || HDNode.defaultPath;\n      var entropy = bytes_1.arrayify(mnemonicAesCtr.decrypt(mnemonicCiphertext));\n      var mnemonic = HDNode.entropyToMnemonic(entropy);\n      var node = HDNode.fromMnemonic(mnemonic).derivePath(path);\n\n      if (node.privateKey != bytes_1.hexlify(privateKey)) {\n        reject(new Error('mnemonic mismatch'));\n        return null;\n      }\n\n      signingKey = new signing_key_1.SigningKey(node);\n    }\n\n    return signingKey;\n  };\n\n  return new Promise(function (resolve, reject) {\n    var kdf = searchPath(data, 'crypto/kdf');\n\n    if (kdf && typeof kdf === 'string') {\n      if (kdf.toLowerCase() === 'scrypt') {\n        var salt = looseArrayify(searchPath(data, 'crypto/kdfparams/salt'));\n        var N = parseInt(searchPath(data, 'crypto/kdfparams/n'));\n        var r = parseInt(searchPath(data, 'crypto/kdfparams/r'));\n        var p = parseInt(searchPath(data, 'crypto/kdfparams/p'));\n\n        if (!N || !r || !p) {\n          reject(new Error('unsupported key-derivation function parameters'));\n          return;\n        } // Make sure N is a power of 2\n\n\n        if ((N & N - 1) !== 0) {\n          reject(new Error('unsupported key-derivation function parameter value for N'));\n          return;\n        }\n\n        var dkLen = parseInt(searchPath(data, 'crypto/kdfparams/dklen'));\n\n        if (dkLen !== 32) {\n          reject(new Error('unsupported key-derivation derived-key length'));\n          return;\n        }\n\n        if (progressCallback) {\n          progressCallback(0);\n        }\n\n        scrypt_js_1.default(passwordBytes, salt, N, r, p, 64, function (error, progress, key) {\n          if (error) {\n            error.progress = progress;\n            reject(error);\n          } else if (key) {\n            key = bytes_1.arrayify(key);\n            var signingKey = getSigningKey(key, reject);\n\n            if (!signingKey) {\n              return;\n            }\n\n            if (progressCallback) {\n              progressCallback(1);\n            }\n\n            resolve(signingKey);\n          } else if (progressCallback) {\n            return progressCallback(progress);\n          }\n        });\n      } else if (kdf.toLowerCase() === 'pbkdf2') {\n        var salt = looseArrayify(searchPath(data, 'crypto/kdfparams/salt'));\n        var prfFunc = null;\n        var prf = searchPath(data, 'crypto/kdfparams/prf');\n\n        if (prf === 'hmac-sha256') {\n          prfFunc = 'sha256';\n        } else if (prf === 'hmac-sha512') {\n          prfFunc = 'sha512';\n        } else {\n          reject(new Error('unsupported prf'));\n          return;\n        }\n\n        var c = parseInt(searchPath(data, 'crypto/kdfparams/c'));\n        var dkLen = parseInt(searchPath(data, 'crypto/kdfparams/dklen'));\n\n        if (dkLen !== 32) {\n          reject(new Error('unsupported key-derivation derived-key length'));\n          return;\n        }\n\n        var key = pbkdf2_1.pbkdf2(passwordBytes, salt, c, dkLen, prfFunc);\n        var signingKey = getSigningKey(key, reject);\n\n        if (!signingKey) {\n          return;\n        }\n\n        resolve(signingKey);\n      } else {\n        reject(new Error('unsupported key-derivation function'));\n      }\n    } else {\n      reject(new Error('unsupported key-derivation function'));\n    }\n  });\n}\n\nexports.decrypt = decrypt;\n\nfunction encrypt(privateKey, password, options, progressCallback) {\n  // the options are optional, so adjust the call as needed\n  if (typeof options === 'function' && !progressCallback) {\n    progressCallback = options;\n    options = {};\n  }\n\n  if (!options) {\n    options = {};\n  } // Check the private key\n\n\n  var privateKeyBytes = null;\n\n  if (signing_key_1.SigningKey.isSigningKey(privateKey)) {\n    privateKeyBytes = bytes_1.arrayify(privateKey.privateKey);\n  } else {\n    privateKeyBytes = bytes_1.arrayify(privateKey);\n  }\n\n  if (privateKeyBytes.length !== 32) {\n    throw new Error('invalid private key');\n  }\n\n  var passwordBytes = getPassword(password);\n  var entropy = null;\n\n  if (options.entropy) {\n    entropy = bytes_1.arrayify(options.entropy);\n  }\n\n  if (options.mnemonic) {\n    if (entropy) {\n      if (HDNode.entropyToMnemonic(entropy) !== options.mnemonic) {\n        throw new Error('entropy and mnemonic mismatch');\n      }\n    } else {\n      entropy = bytes_1.arrayify(HDNode.mnemonicToEntropy(options.mnemonic));\n    }\n  }\n\n  var path = options.path;\n\n  if (entropy && !path) {\n    path = HDNode.defaultPath;\n  }\n\n  var client = options.client;\n\n  if (!client) {\n    client = \"ethers.js\";\n  } // Check/generate the salt\n\n\n  var salt = null;\n\n  if (options.salt) {\n    salt = bytes_1.arrayify(options.salt);\n  } else {\n    salt = random_bytes_1.randomBytes(32);\n    ;\n  } // Override initialization vector\n\n\n  var iv = null;\n\n  if (options.iv) {\n    iv = bytes_1.arrayify(options.iv);\n\n    if (iv.length !== 16) {\n      throw new Error('invalid iv');\n    }\n  } else {\n    iv = random_bytes_1.randomBytes(16);\n  } // Override the uuid\n\n\n  var uuidRandom = null;\n\n  if (options.uuid) {\n    uuidRandom = bytes_1.arrayify(options.uuid);\n\n    if (uuidRandom.length !== 16) {\n      throw new Error('invalid uuid');\n    }\n  } else {\n    uuidRandom = random_bytes_1.randomBytes(16);\n  } // Override the scrypt password-based key derivation function parameters\n\n\n  var N = 1 << 17,\n      r = 8,\n      p = 1;\n\n  if (options.scrypt) {\n    if (options.scrypt.N) {\n      N = options.scrypt.N;\n    }\n\n    if (options.scrypt.r) {\n      r = options.scrypt.r;\n    }\n\n    if (options.scrypt.p) {\n      p = options.scrypt.p;\n    }\n  }\n\n  return new Promise(function (resolve, reject) {\n    if (progressCallback) {\n      progressCallback(0);\n    } // We take 64 bytes:\n    //   - 32 bytes   As normal for the Web3 secret storage (derivedKey, macPrefix)\n    //   - 32 bytes   AES key to encrypt mnemonic with (required here to be Ethers Wallet)\n\n\n    scrypt_js_1.default(passwordBytes, salt, N, r, p, 64, function (error, progress, key) {\n      if (error) {\n        error.progress = progress;\n        reject(error);\n      } else if (key) {\n        key = bytes_1.arrayify(key); // This will be used to encrypt the wallet (as per Web3 secret storage)\n\n        var derivedKey = key.slice(0, 16);\n        var macPrefix = key.slice(16, 32); // This will be used to encrypt the mnemonic phrase (if any)\n\n        var mnemonicKey = key.slice(32, 64); // Get the address for this private key\n\n        var address = new signing_key_1.SigningKey(privateKeyBytes).address; // Encrypt the private key\n\n        var counter = new aes_js_1.default.Counter(iv);\n        var aesCtr = new aes_js_1.default.ModeOfOperation.ctr(derivedKey, counter);\n        var ciphertext = bytes_1.arrayify(aesCtr.encrypt(privateKeyBytes)); // Compute the message authentication code, used to check the password\n\n        var mac = keccak256_1.keccak256(bytes_1.concat([macPrefix, ciphertext])); // See: https://github.com/ethereum/wiki/wiki/Web3-Secret-Storage-Definition\n\n        var data = {\n          address: address.substring(2).toLowerCase(),\n          id: uuid_1.default.v4({\n            random: uuidRandom\n          }),\n          version: 3,\n          Crypto: {\n            cipher: 'aes-128-ctr',\n            cipherparams: {\n              iv: bytes_1.hexlify(iv).substring(2)\n            },\n            ciphertext: bytes_1.hexlify(ciphertext).substring(2),\n            kdf: 'scrypt',\n            kdfparams: {\n              salt: bytes_1.hexlify(salt).substring(2),\n              n: N,\n              dklen: 32,\n              p: p,\n              r: r\n            },\n            mac: mac.substring(2)\n          }\n        }; // If we have a mnemonic, encrypt it into the JSON wallet\n\n        if (entropy) {\n          var mnemonicIv = random_bytes_1.randomBytes(16);\n          var mnemonicCounter = new aes_js_1.default.Counter(mnemonicIv);\n          var mnemonicAesCtr = new aes_js_1.default.ModeOfOperation.ctr(mnemonicKey, mnemonicCounter);\n          var mnemonicCiphertext = bytes_1.arrayify(mnemonicAesCtr.encrypt(entropy));\n          var now = new Date();\n          var timestamp = now.getUTCFullYear() + '-' + zpad(now.getUTCMonth() + 1, 2) + '-' + zpad(now.getUTCDate(), 2) + 'T' + zpad(now.getUTCHours(), 2) + '-' + zpad(now.getUTCMinutes(), 2) + '-' + zpad(now.getUTCSeconds(), 2) + '.0Z';\n          data['x-ethers'] = {\n            client: client,\n            gethFilename: 'UTC--' + timestamp + '--' + data.address,\n            mnemonicCounter: bytes_1.hexlify(mnemonicIv).substring(2),\n            mnemonicCiphertext: bytes_1.hexlify(mnemonicCiphertext).substring(2),\n            path: path,\n            version: \"0.1\"\n          };\n        }\n\n        if (progressCallback) {\n          progressCallback(1);\n        }\n\n        resolve(JSON.stringify(data));\n      } else if (progressCallback) {\n        return progressCallback(progress);\n      }\n    });\n  });\n}\n\nexports.encrypt = encrypt;","map":{"version":3,"names":["__importDefault","mod","__esModule","__importStar","result","k","Object","hasOwnProperty","call","defineProperty","exports","value","aes_js_1","require","scrypt_js_1","uuid_1","signing_key_1","HDNode","address_1","bytes_1","pbkdf2_1","keccak256_1","utf8_1","random_bytes_1","looseArrayify","hexString","substring","arrayify","zpad","length","String","getPassword","password","toUtf8Bytes","UnicodeNormalizationForm","NFKC","searchPath","object","path","currentChild","comps","toLowerCase","split","i","matchingChild","key","decryptCrowdsale","json","data","JSON","parse","ethaddr","getAddress","encseed","Error","pbkdf2","slice","iv","encryptedSeed","aesCbc","default","ModeOfOperation","cbc","seed","decrypt","padding","pkcs7","strip","seedHex","fromCharCode","seedHexBytes","signingKey","SigningKey","keccak256","address","progressCallback","passwordBytes","ciphertext","cipher","counter","Counter","aesCtr","ctr","computeMAC","derivedHalf","concat","getSigningKey","reject","computedMAC","hexlify","privateKey","mnemonicKey","mnemonicCiphertext","mnemonicIv","mnemonicCounter","mnemonicAesCtr","defaultPath","entropy","mnemonic","entropyToMnemonic","node","fromMnemonic","derivePath","Promise","resolve","kdf","salt","N","parseInt","r","p","dkLen","error","progress","prfFunc","prf","c","encrypt","options","privateKeyBytes","isSigningKey","mnemonicToEntropy","client","randomBytes","uuidRandom","uuid","scrypt","derivedKey","macPrefix","mac","id","v4","random","version","Crypto","cipherparams","kdfparams","n","dklen","now","Date","timestamp","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","gethFilename","stringify"],"sources":["C:/Users/acer/node_modules/@vechain/ethers/utils/secret-storage.js"],"sourcesContent":["'use strict';\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar aes_js_1 = __importDefault(require(\"aes-js\"));\nvar scrypt_js_1 = __importDefault(require(\"scrypt-js\"));\nvar uuid_1 = __importDefault(require(\"uuid\"));\nvar signing_key_1 = require(\"./signing-key\");\nvar HDNode = __importStar(require(\"./hdnode\"));\nvar address_1 = require(\"./address\");\nvar bytes_1 = require(\"./bytes\");\nvar pbkdf2_1 = require(\"./pbkdf2\");\nvar keccak256_1 = require(\"./keccak256\");\nvar utf8_1 = require(\"./utf8\");\nvar random_bytes_1 = require(\"./random-bytes\");\nfunction looseArrayify(hexString) {\n    if (typeof (hexString) === 'string' && hexString.substring(0, 2) !== '0x') {\n        hexString = '0x' + hexString;\n    }\n    return bytes_1.arrayify(hexString);\n}\nfunction zpad(value, length) {\n    value = String(value);\n    while (value.length < length) {\n        value = '0' + value;\n    }\n    return value;\n}\nfunction getPassword(password) {\n    if (typeof (password) === 'string') {\n        return utf8_1.toUtf8Bytes(password, utf8_1.UnicodeNormalizationForm.NFKC);\n    }\n    return bytes_1.arrayify(password);\n}\n// Search an Object and its children recursively, caselessly.\nfunction searchPath(object, path) {\n    var currentChild = object;\n    var comps = path.toLowerCase().split('/');\n    for (var i = 0; i < comps.length; i++) {\n        // Search for a child object with a case-insensitive matching key\n        var matchingChild = null;\n        for (var key in currentChild) {\n            if (key.toLowerCase() === comps[i]) {\n                matchingChild = currentChild[key];\n                break;\n            }\n        }\n        // Didn't find one. :'(\n        if (matchingChild === null) {\n            return null;\n        }\n        // Now check this child...\n        currentChild = matchingChild;\n    }\n    return currentChild;\n}\n// @TODO: Make a type for string or arrayish\n// See: https://github.com/ethereum/pyethsaletool\nfunction decryptCrowdsale(json, password) {\n    var data = JSON.parse(json);\n    password = getPassword(password);\n    // Ethereum Address\n    var ethaddr = address_1.getAddress(searchPath(data, 'ethaddr'));\n    // Encrypted Seed\n    var encseed = looseArrayify(searchPath(data, 'encseed'));\n    if (!encseed || (encseed.length % 16) !== 0) {\n        throw new Error('invalid encseed');\n    }\n    var key = pbkdf2_1.pbkdf2(password, password, 2000, 32, 'sha256').slice(0, 16);\n    var iv = encseed.slice(0, 16);\n    var encryptedSeed = encseed.slice(16);\n    // Decrypt the seed\n    var aesCbc = new aes_js_1.default.ModeOfOperation.cbc(key, iv);\n    var seed = bytes_1.arrayify(aesCbc.decrypt(encryptedSeed));\n    seed = aes_js_1.default.padding.pkcs7.strip(seed);\n    // This wallet format is weird... Convert the binary encoded hex to a string.\n    var seedHex = '';\n    for (var i = 0; i < seed.length; i++) {\n        seedHex += String.fromCharCode(seed[i]);\n    }\n    var seedHexBytes = utf8_1.toUtf8Bytes(seedHex);\n    var signingKey = new signing_key_1.SigningKey(keccak256_1.keccak256(seedHexBytes));\n    if (signingKey.address !== ethaddr) {\n        throw new Error('corrupt crowdsale wallet');\n    }\n    return signingKey;\n}\nexports.decryptCrowdsale = decryptCrowdsale;\n//@TODO: string or arrayish\nfunction decrypt(json, password, progressCallback) {\n    var data = JSON.parse(json);\n    var passwordBytes = getPassword(password);\n    var decrypt = function (key, ciphertext) {\n        var cipher = searchPath(data, 'crypto/cipher');\n        if (cipher === 'aes-128-ctr') {\n            var iv = looseArrayify(searchPath(data, 'crypto/cipherparams/iv'));\n            var counter = new aes_js_1.default.Counter(iv);\n            var aesCtr = new aes_js_1.default.ModeOfOperation.ctr(key, counter);\n            return bytes_1.arrayify(aesCtr.decrypt(ciphertext));\n        }\n        return null;\n    };\n    var computeMAC = function (derivedHalf, ciphertext) {\n        return keccak256_1.keccak256(bytes_1.concat([derivedHalf, ciphertext]));\n    };\n    var getSigningKey = function (key, reject) {\n        var ciphertext = looseArrayify(searchPath(data, 'crypto/ciphertext'));\n        var computedMAC = bytes_1.hexlify(computeMAC(key.slice(16, 32), ciphertext)).substring(2);\n        if (computedMAC !== searchPath(data, 'crypto/mac').toLowerCase()) {\n            reject(new Error('invalid password'));\n            return null;\n        }\n        var privateKey = decrypt(key.slice(0, 16), ciphertext);\n        var mnemonicKey = key.slice(32, 64);\n        if (!privateKey) {\n            reject(new Error('unsupported cipher'));\n            return null;\n        }\n        var signingKey = new signing_key_1.SigningKey(privateKey);\n        if (signingKey.address !== address_1.getAddress(data.address)) {\n            reject(new Error('address mismatch'));\n            return null;\n        }\n        // Version 0.1 x-ethers metadata must contain an encrypted mnemonic phrase\n        if (searchPath(data, 'x-ethers/version') === '0.1') {\n            var mnemonicCiphertext = looseArrayify(searchPath(data, 'x-ethers/mnemonicCiphertext'));\n            var mnemonicIv = looseArrayify(searchPath(data, 'x-ethers/mnemonicCounter'));\n            var mnemonicCounter = new aes_js_1.default.Counter(mnemonicIv);\n            var mnemonicAesCtr = new aes_js_1.default.ModeOfOperation.ctr(mnemonicKey, mnemonicCounter);\n            var path = searchPath(data, 'x-ethers/path') || HDNode.defaultPath;\n            var entropy = bytes_1.arrayify(mnemonicAesCtr.decrypt(mnemonicCiphertext));\n            var mnemonic = HDNode.entropyToMnemonic(entropy);\n            var node = HDNode.fromMnemonic(mnemonic).derivePath(path);\n            if (node.privateKey != bytes_1.hexlify(privateKey)) {\n                reject(new Error('mnemonic mismatch'));\n                return null;\n            }\n            signingKey = new signing_key_1.SigningKey(node);\n        }\n        return signingKey;\n    };\n    return new Promise(function (resolve, reject) {\n        var kdf = searchPath(data, 'crypto/kdf');\n        if (kdf && typeof (kdf) === 'string') {\n            if (kdf.toLowerCase() === 'scrypt') {\n                var salt = looseArrayify(searchPath(data, 'crypto/kdfparams/salt'));\n                var N = parseInt(searchPath(data, 'crypto/kdfparams/n'));\n                var r = parseInt(searchPath(data, 'crypto/kdfparams/r'));\n                var p = parseInt(searchPath(data, 'crypto/kdfparams/p'));\n                if (!N || !r || !p) {\n                    reject(new Error('unsupported key-derivation function parameters'));\n                    return;\n                }\n                // Make sure N is a power of 2\n                if ((N & (N - 1)) !== 0) {\n                    reject(new Error('unsupported key-derivation function parameter value for N'));\n                    return;\n                }\n                var dkLen = parseInt(searchPath(data, 'crypto/kdfparams/dklen'));\n                if (dkLen !== 32) {\n                    reject(new Error('unsupported key-derivation derived-key length'));\n                    return;\n                }\n                if (progressCallback) {\n                    progressCallback(0);\n                }\n                scrypt_js_1.default(passwordBytes, salt, N, r, p, 64, function (error, progress, key) {\n                    if (error) {\n                        error.progress = progress;\n                        reject(error);\n                    }\n                    else if (key) {\n                        key = bytes_1.arrayify(key);\n                        var signingKey = getSigningKey(key, reject);\n                        if (!signingKey) {\n                            return;\n                        }\n                        if (progressCallback) {\n                            progressCallback(1);\n                        }\n                        resolve(signingKey);\n                    }\n                    else if (progressCallback) {\n                        return progressCallback(progress);\n                    }\n                });\n            }\n            else if (kdf.toLowerCase() === 'pbkdf2') {\n                var salt = looseArrayify(searchPath(data, 'crypto/kdfparams/salt'));\n                var prfFunc = null;\n                var prf = searchPath(data, 'crypto/kdfparams/prf');\n                if (prf === 'hmac-sha256') {\n                    prfFunc = 'sha256';\n                }\n                else if (prf === 'hmac-sha512') {\n                    prfFunc = 'sha512';\n                }\n                else {\n                    reject(new Error('unsupported prf'));\n                    return;\n                }\n                var c = parseInt(searchPath(data, 'crypto/kdfparams/c'));\n                var dkLen = parseInt(searchPath(data, 'crypto/kdfparams/dklen'));\n                if (dkLen !== 32) {\n                    reject(new Error('unsupported key-derivation derived-key length'));\n                    return;\n                }\n                var key = pbkdf2_1.pbkdf2(passwordBytes, salt, c, dkLen, prfFunc);\n                var signingKey = getSigningKey(key, reject);\n                if (!signingKey) {\n                    return;\n                }\n                resolve(signingKey);\n            }\n            else {\n                reject(new Error('unsupported key-derivation function'));\n            }\n        }\n        else {\n            reject(new Error('unsupported key-derivation function'));\n        }\n    });\n}\nexports.decrypt = decrypt;\nfunction encrypt(privateKey, password, options, progressCallback) {\n    // the options are optional, so adjust the call as needed\n    if (typeof (options) === 'function' && !progressCallback) {\n        progressCallback = options;\n        options = {};\n    }\n    if (!options) {\n        options = {};\n    }\n    // Check the private key\n    var privateKeyBytes = null;\n    if (signing_key_1.SigningKey.isSigningKey(privateKey)) {\n        privateKeyBytes = bytes_1.arrayify(privateKey.privateKey);\n    }\n    else {\n        privateKeyBytes = bytes_1.arrayify(privateKey);\n    }\n    if (privateKeyBytes.length !== 32) {\n        throw new Error('invalid private key');\n    }\n    var passwordBytes = getPassword(password);\n    var entropy = null;\n    if (options.entropy) {\n        entropy = bytes_1.arrayify(options.entropy);\n    }\n    if (options.mnemonic) {\n        if (entropy) {\n            if (HDNode.entropyToMnemonic(entropy) !== options.mnemonic) {\n                throw new Error('entropy and mnemonic mismatch');\n            }\n        }\n        else {\n            entropy = bytes_1.arrayify(HDNode.mnemonicToEntropy(options.mnemonic));\n        }\n    }\n    var path = options.path;\n    if (entropy && !path) {\n        path = HDNode.defaultPath;\n    }\n    var client = options.client;\n    if (!client) {\n        client = \"ethers.js\";\n    }\n    // Check/generate the salt\n    var salt = null;\n    if (options.salt) {\n        salt = bytes_1.arrayify(options.salt);\n    }\n    else {\n        salt = random_bytes_1.randomBytes(32);\n        ;\n    }\n    // Override initialization vector\n    var iv = null;\n    if (options.iv) {\n        iv = bytes_1.arrayify(options.iv);\n        if (iv.length !== 16) {\n            throw new Error('invalid iv');\n        }\n    }\n    else {\n        iv = random_bytes_1.randomBytes(16);\n    }\n    // Override the uuid\n    var uuidRandom = null;\n    if (options.uuid) {\n        uuidRandom = bytes_1.arrayify(options.uuid);\n        if (uuidRandom.length !== 16) {\n            throw new Error('invalid uuid');\n        }\n    }\n    else {\n        uuidRandom = random_bytes_1.randomBytes(16);\n    }\n    // Override the scrypt password-based key derivation function parameters\n    var N = (1 << 17), r = 8, p = 1;\n    if (options.scrypt) {\n        if (options.scrypt.N) {\n            N = options.scrypt.N;\n        }\n        if (options.scrypt.r) {\n            r = options.scrypt.r;\n        }\n        if (options.scrypt.p) {\n            p = options.scrypt.p;\n        }\n    }\n    return new Promise(function (resolve, reject) {\n        if (progressCallback) {\n            progressCallback(0);\n        }\n        // We take 64 bytes:\n        //   - 32 bytes   As normal for the Web3 secret storage (derivedKey, macPrefix)\n        //   - 32 bytes   AES key to encrypt mnemonic with (required here to be Ethers Wallet)\n        scrypt_js_1.default(passwordBytes, salt, N, r, p, 64, function (error, progress, key) {\n            if (error) {\n                error.progress = progress;\n                reject(error);\n            }\n            else if (key) {\n                key = bytes_1.arrayify(key);\n                // This will be used to encrypt the wallet (as per Web3 secret storage)\n                var derivedKey = key.slice(0, 16);\n                var macPrefix = key.slice(16, 32);\n                // This will be used to encrypt the mnemonic phrase (if any)\n                var mnemonicKey = key.slice(32, 64);\n                // Get the address for this private key\n                var address = (new signing_key_1.SigningKey(privateKeyBytes)).address;\n                // Encrypt the private key\n                var counter = new aes_js_1.default.Counter(iv);\n                var aesCtr = new aes_js_1.default.ModeOfOperation.ctr(derivedKey, counter);\n                var ciphertext = bytes_1.arrayify(aesCtr.encrypt(privateKeyBytes));\n                // Compute the message authentication code, used to check the password\n                var mac = keccak256_1.keccak256(bytes_1.concat([macPrefix, ciphertext]));\n                // See: https://github.com/ethereum/wiki/wiki/Web3-Secret-Storage-Definition\n                var data = {\n                    address: address.substring(2).toLowerCase(),\n                    id: uuid_1.default.v4({ random: uuidRandom }),\n                    version: 3,\n                    Crypto: {\n                        cipher: 'aes-128-ctr',\n                        cipherparams: {\n                            iv: bytes_1.hexlify(iv).substring(2),\n                        },\n                        ciphertext: bytes_1.hexlify(ciphertext).substring(2),\n                        kdf: 'scrypt',\n                        kdfparams: {\n                            salt: bytes_1.hexlify(salt).substring(2),\n                            n: N,\n                            dklen: 32,\n                            p: p,\n                            r: r\n                        },\n                        mac: mac.substring(2)\n                    }\n                };\n                // If we have a mnemonic, encrypt it into the JSON wallet\n                if (entropy) {\n                    var mnemonicIv = random_bytes_1.randomBytes(16);\n                    var mnemonicCounter = new aes_js_1.default.Counter(mnemonicIv);\n                    var mnemonicAesCtr = new aes_js_1.default.ModeOfOperation.ctr(mnemonicKey, mnemonicCounter);\n                    var mnemonicCiphertext = bytes_1.arrayify(mnemonicAesCtr.encrypt(entropy));\n                    var now = new Date();\n                    var timestamp = (now.getUTCFullYear() + '-' +\n                        zpad(now.getUTCMonth() + 1, 2) + '-' +\n                        zpad(now.getUTCDate(), 2) + 'T' +\n                        zpad(now.getUTCHours(), 2) + '-' +\n                        zpad(now.getUTCMinutes(), 2) + '-' +\n                        zpad(now.getUTCSeconds(), 2) + '.0Z');\n                    data['x-ethers'] = {\n                        client: client,\n                        gethFilename: ('UTC--' + timestamp + '--' + data.address),\n                        mnemonicCounter: bytes_1.hexlify(mnemonicIv).substring(2),\n                        mnemonicCiphertext: bytes_1.hexlify(mnemonicCiphertext).substring(2),\n                        path: path,\n                        version: \"0.1\"\n                    };\n                }\n                if (progressCallback) {\n                    progressCallback(1);\n                }\n                resolve(JSON.stringify(data));\n            }\n            else if (progressCallback) {\n                return progressCallback(progress);\n            }\n        });\n    });\n}\nexports.encrypt = encrypt;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}