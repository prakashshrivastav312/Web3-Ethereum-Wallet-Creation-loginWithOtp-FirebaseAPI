{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.inputTransferFilterFormatter = exports.inputBlockFilterFormatter = exports.inputLogFilterFormatter = exports.extendFormatters = void 0;\n\nconst debug = require('debug')('thor:injector');\n\nconst utils = require(\"../utils\");\n\nconst extendFormatters = function (web3) {\n  const web3Utils = web3.utils;\n  const outputTransactionFormatter = web3.extend.formatters.outputTransactionFormatter;\n\n  web3.extend.formatters.outputTransactionFormatter = function (tx) {\n    if (tx && tx.isThorified) {\n      debug('outputTransactionFormatter');\n      tx.chainTag = web3Utils.numberToHex(tx.chainTag);\n\n      if (tx.clauses) {\n        for (const clause of tx.clauses) {\n          clause.value = web3.extend.formatters.outputBigNumberFormatter(clause.value);\n        }\n      }\n\n      return tx;\n    } else {\n      return outputTransactionFormatter(tx);\n    }\n  };\n\n  const outputTransactionReceiptFormatter = web3.extend.formatters.outputTransactionReceiptFormatter;\n\n  web3.extend.formatters.outputTransactionReceiptFormatter = function (receipt) {\n    if (receipt && receipt.isThorified) {\n      debug('outputTransactionReceiptFormatter');\n\n      if (receipt.hasOwnProperty('transactionIndex')) {\n        delete receipt.transactionIndex;\n      }\n\n      if (receipt.hasOwnProperty('cumulativeGasUsed')) {\n        delete receipt.cumulativeGasUsed;\n      }\n\n      receipt.gasUsed = web3Utils.hexToNumber(receipt.gasUsed);\n\n      for (const output of receipt.outputs) {\n        if (output.events) {\n          output.events = output.events.map(event => {\n            if (!event.isThorified) {\n              Object.defineProperty(event, 'isThorified', {\n                get: () => true\n              });\n            }\n\n            return web3.extend.formatters.outputLogFormatter(event);\n          });\n        }\n      }\n\n      return receipt;\n    } else {\n      return outputTransactionReceiptFormatter(receipt);\n    }\n  };\n\n  const outputLogFormatter = web3.extend.formatters.outputLogFormatter;\n\n  web3.extend.formatters.outputLogFormatter = function (log) {\n    if (log && log.isThorified) {\n      debug('outputLogFormatter');\n\n      if (log.hasOwnProperty('transactionIndex')) {\n        delete log.transactionIndex;\n      }\n\n      if (log.hasOwnProperty('logIndex')) {\n        delete log.logIndex;\n      }\n\n      if (log.hasOwnProperty('id')) {\n        delete log.id;\n      }\n\n      return log;\n    } else {\n      return outputLogFormatter(log);\n    }\n  };\n};\n\nexports.extendFormatters = extendFormatters;\n\nconst inputLogFilterFormatter = function (options) {\n  if (options) {\n    const logFilterOptions = {};\n\n    if (options.address) {\n      logFilterOptions.address = utils.validAddressOrError(options.address);\n    }\n\n    if (options.pos) {\n      logFilterOptions.pos = utils.validBytes32OrError(options.pos, 'Invalid position(block ID)');\n    }\n\n    if (options.t0) {\n      logFilterOptions.t0 = utils.validBytes32OrError(options.t0, 'Invalid t0');\n    }\n\n    if (options.t1) {\n      logFilterOptions.t1 = utils.validBytes32OrError(options.t1, 'Invalid t1');\n    }\n\n    if (options.t2) {\n      logFilterOptions.t2 = utils.validBytes32OrError(options.t2, 'Invalid t2');\n    }\n\n    if (options.t3) {\n      logFilterOptions.t3 = utils.validBytes32OrError(options.t3, 'Invalid t3');\n    }\n\n    if (options.t4) {\n      logFilterOptions.t4 = utils.validBytes32OrError(options.t4, 'Invalid t4');\n    }\n\n    return logFilterOptions;\n  }\n};\n\nexports.inputLogFilterFormatter = inputLogFilterFormatter;\n\nconst inputBlockFilterFormatter = function (blockID) {\n  if (blockID) {\n    blockID = utils.validBytes32OrError(blockID, 'Invalid position(block ID)');\n    return blockID;\n  }\n};\n\nexports.inputBlockFilterFormatter = inputBlockFilterFormatter;\n\nconst inputTransferFilterFormatter = function (options) {\n  if (options) {\n    const transferFilterOptions = {};\n\n    if (options.pos) {\n      transferFilterOptions.pos = utils.validBytes32OrError(options.pos, 'Invalid position(block ID)');\n    }\n\n    if (options.txOrigin) {\n      transferFilterOptions.txOrigin = utils.validAddressOrError(options.txOrigin);\n    }\n\n    if (options.sender) {\n      transferFilterOptions.sender = utils.validAddressOrError(options.sender);\n    }\n\n    if (options.recipient) {\n      transferFilterOptions.recipient = utils.validAddressOrError(options.recipient);\n    }\n\n    return transferFilterOptions;\n  }\n};\n\nexports.inputTransferFilterFormatter = inputTransferFilterFormatter;","map":{"version":3,"mappings":"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","names":["debug","require","extendFormatters","web3","web3Utils","utils","outputTransactionFormatter","extend","formatters","tx","isThorified","chainTag","numberToHex","clauses","clause","value","outputBigNumberFormatter","outputTransactionReceiptFormatter","receipt","hasOwnProperty","transactionIndex","cumulativeGasUsed","gasUsed","hexToNumber","output","outputs","events","map","event","Object","defineProperty","get","outputLogFormatter","log","logIndex","id","exports","inputLogFilterFormatter","options","logFilterOptions","address","validAddressOrError","pos","validBytes32OrError","t0","t1","t2","t3","t4","inputBlockFilterFormatter","blockID","inputTransferFilterFormatter","transferFilterOptions","txOrigin","sender","recipient"],"sourceRoot":"","sources":["../../src/extend/formatters.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}