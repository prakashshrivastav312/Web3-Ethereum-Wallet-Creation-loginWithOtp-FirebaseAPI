{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TypedResult = exports.SmartContractResultItem = exports.SmartContractResults = void 0;\n\nconst address_1 = require(\"../address\");\n\nconst balance_1 = require(\"../balance\");\n\nconst hash_1 = require(\"../hash\");\n\nconst networkParams_1 = require(\"../networkParams\");\n\nconst nonce_1 = require(\"../nonce\");\n\nconst transaction_1 = require(\"../transaction\");\n\nconst argSerializer_1 = require(\"./argSerializer\");\n\nconst returnCode_1 = require(\"./returnCode\");\n\nconst result_1 = require(\"./result\");\n\nclass SmartContractResults {\n  constructor(items) {\n    this.items = [];\n    this.immediate = new TypedResult();\n    this.resultingCalls = [];\n    this.items = items;\n\n    if (this.items.length > 0) {\n      let immediateResult = this.findImmediateResult();\n\n      if (immediateResult) {\n        this.immediate = immediateResult;\n      }\n\n      this.resultingCalls = this.findResultingCalls();\n    }\n  }\n\n  static empty() {\n    return new SmartContractResults([]);\n  }\n\n  static fromHttpResponse(smartContractResults) {\n    let items = (smartContractResults || []).map(item => SmartContractResultItem.fromHttpResponse(item));\n    return new SmartContractResults(items);\n  }\n\n  findImmediateResult() {\n    let immediateItem = this.items.filter(item => isImmediateResult(item))[0];\n\n    if (immediateItem) {\n      return new TypedResult(immediateItem);\n    }\n\n    return undefined;\n  }\n\n  findResultingCalls() {\n    let otherItems = this.items.filter(item => !isImmediateResult(item));\n    let resultingCalls = otherItems.map(item => new TypedResult(item));\n    return resultingCalls;\n  }\n\n  getImmediate() {\n    return this.immediate;\n  }\n\n  getResultingCalls() {\n    return this.resultingCalls;\n  }\n\n  getAllResults() {\n    return this.items.map(item => new TypedResult(item));\n  }\n\n}\n\nexports.SmartContractResults = SmartContractResults;\n\nfunction isImmediateResult(item) {\n  return item.nonce.valueOf() != 0;\n}\n\nclass SmartContractResultItem {\n  constructor() {\n    this.hash = hash_1.Hash.empty();\n    this.nonce = new nonce_1.Nonce(0);\n    this.value = balance_1.Balance.Zero();\n    this.receiver = new address_1.Address();\n    this.sender = new address_1.Address();\n    this.data = \"\";\n    this.previousHash = hash_1.Hash.empty();\n    this.originalHash = hash_1.Hash.empty();\n    this.gasLimit = new networkParams_1.GasLimit(0);\n    this.gasPrice = new networkParams_1.GasPrice(0);\n    this.callType = 0;\n    this.returnMessage = \"\";\n  }\n\n  static fromHttpResponse(response) {\n    let item = new SmartContractResultItem();\n    item.hash = new transaction_1.TransactionHash(response.hash);\n    item.nonce = new nonce_1.Nonce(response.nonce || 0);\n    item.value = balance_1.Balance.fromString(response.value);\n    item.receiver = new address_1.Address(response.receiver);\n    item.sender = new address_1.Address(response.sender);\n    item.data = response.data || \"\";\n    item.previousHash = new transaction_1.TransactionHash(response.prevTxHash);\n    item.originalHash = new transaction_1.TransactionHash(response.originalTxHash);\n    item.gasLimit = new networkParams_1.GasLimit(response.gasLimit);\n    item.gasPrice = new networkParams_1.GasPrice(response.gasPrice);\n    item.callType = response.callType;\n    item.returnMessage = response.returnMessage;\n    return item;\n  }\n\n  getDataTokens() {\n    return new argSerializer_1.ArgSerializer().stringToBuffers(this.data);\n  }\n\n}\n\nexports.SmartContractResultItem = SmartContractResultItem;\n\nclass TypedResult extends SmartContractResultItem {\n  constructor(init) {\n    super();\n    Object.assign(this, init);\n  }\n\n  assertSuccess() {\n    result_1.Result.assertSuccess(this);\n  }\n\n  isSuccess() {\n    return this.getReturnCode().isSuccess();\n  }\n\n  getReturnCode() {\n    let tokens = this.getDataTokens();\n\n    if (tokens.length < 2) {\n      return returnCode_1.ReturnCode.None;\n    }\n\n    let returnCodeToken = tokens[1];\n    return returnCode_1.ReturnCode.fromBuffer(returnCodeToken);\n  }\n\n  outputUntyped() {\n    this.assertSuccess(); // Skip the first 2 SCRs (eg. the @6f6b from @6f6b@2b).\n\n    return this.getDataTokens().slice(2);\n  }\n\n  setEndpointDefinition(endpointDefinition) {\n    this.endpointDefinition = endpointDefinition;\n  }\n\n  getEndpointDefinition() {\n    return this.endpointDefinition;\n  }\n\n  getReturnMessage() {\n    return this.returnMessage;\n  }\n\n  outputTyped() {\n    return result_1.Result.outputTyped(this);\n  }\n\n  unpackOutput() {\n    return result_1.Result.unpackOutput(this);\n  }\n\n}\n\nexports.TypedResult = TypedResult;","map":{"version":3,"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AAEA,MAAaA,oBAAb,CAAiC;EAK7BC,YAAYC,KAAZ,EAA4C;IAJ3B,aAAmC,EAAnC;IACA,iBAAyB,IAAIC,WAAJ,EAAzB;IACA,sBAAgC,EAAhC;IAGb,KAAKD,KAAL,GAAaA,KAAb;;IAEA,IAAI,KAAKA,KAAL,CAAWE,MAAX,GAAoB,CAAxB,EAA2B;MACvB,IAAIC,eAAe,GAAG,KAAKC,mBAAL,EAAtB;;MACA,IAAID,eAAJ,EAAqB;QACjB,KAAKE,SAAL,GAAiBF,eAAjB;MACH;;MACD,KAAKG,cAAL,GAAsB,KAAKC,kBAAL,EAAtB;IACH;EACJ;;EAEW,OAALC,KAAK;IACR,OAAO,IAAIV,oBAAJ,CAAyB,EAAzB,CAAP;EACH;;EAEsB,OAAhBW,gBAAgB,CAACC,oBAAD,EAA4B;IAC/C,IAAIV,KAAK,GAAG,CAACU,oBAAoB,IAAI,EAAzB,EAA6BC,GAA7B,CAAkCC,IAAD,IAAeC,uBAAuB,CAACJ,gBAAxB,CAAyCG,IAAzC,CAAhD,CAAZ;IACA,OAAO,IAAId,oBAAJ,CAAyBE,KAAzB,CAAP;EACH;;EAEOI,mBAAmB;IACvB,IAAIU,aAAa,GAAG,KAAKd,KAAL,CAAWe,MAAX,CAAkBH,IAAI,IAAII,iBAAiB,CAACJ,IAAD,CAA3C,EAAmD,CAAnD,CAApB;;IACA,IAAIE,aAAJ,EAAmB;MACf,OAAO,IAAIb,WAAJ,CAAgBa,aAAhB,CAAP;IACH;;IACD,OAAOG,SAAP;EACH;;EAEOV,kBAAkB;IACtB,IAAIW,UAAU,GAAG,KAAKlB,KAAL,CAAWe,MAAX,CAAkBH,IAAI,IAAI,CAACI,iBAAiB,CAACJ,IAAD,CAA5C,CAAjB;IACA,IAAIN,cAAc,GAAGY,UAAU,CAACP,GAAX,CAAeC,IAAI,IAAI,IAAIX,WAAJ,CAAgBW,IAAhB,CAAvB,CAArB;IACA,OAAON,cAAP;EACH;;EAEDa,YAAY;IACR,OAAO,KAAKd,SAAZ;EACH;;EAEDe,iBAAiB;IACb,OAAO,KAAKd,cAAZ;EACH;;EAEDe,aAAa;IACT,OAAO,KAAKrB,KAAL,CAAWW,GAAX,CAAeC,IAAI,IAAI,IAAIX,WAAJ,CAAgBW,IAAhB,CAAvB,CAAP;EACH;;AAlD4B;;AAAjCU;;AAqDA,SAASN,iBAAT,CAA2BJ,IAA3B,EAAwD;EACpD,OAAOA,IAAI,CAACW,KAAL,CAAWC,OAAX,MAAwB,CAA/B;AACH;;AAED,MAAaX,uBAAb,CAAoC;EAApCd;IACI,YAAa0B,YAAKjB,KAAL,EAAb;IACA,aAAe,IAAIkB,aAAJ,CAAU,CAAV,CAAf;IACA,aAAiBC,kBAAQC,IAAR,EAAjB;IACA,gBAAoB,IAAIC,iBAAJ,EAApB;IACA,cAAkB,IAAIA,iBAAJ,EAAlB;IACA,YAAe,EAAf;IACA,oBAAqBJ,YAAKjB,KAAL,EAArB;IACA,oBAAqBiB,YAAKjB,KAAL,EAArB;IACA,gBAAqB,IAAIsB,wBAAJ,CAAa,CAAb,CAArB;IACA,gBAAqB,IAAIA,wBAAJ,CAAa,CAAb,CAArB;IACA,gBAAmB,CAAnB;IACA,qBAAwB,EAAxB;EAqCH;;EAnC0B,OAAhBrB,gBAAgB,CAACsB,QAAD,EAatB;IACG,IAAInB,IAAI,GAAG,IAAIC,uBAAJ,EAAX;IAEAD,IAAI,CAACoB,IAAL,GAAY,IAAIC,6BAAJ,CAAoBF,QAAQ,CAACC,IAA7B,CAAZ;IACApB,IAAI,CAACW,KAAL,GAAa,IAAIG,aAAJ,CAAUK,QAAQ,CAACR,KAAT,IAAkB,CAA5B,CAAb;IACAX,IAAI,CAACsB,KAAL,GAAaP,kBAAQQ,UAAR,CAAmBJ,QAAQ,CAACG,KAA5B,CAAb;IACAtB,IAAI,CAACwB,QAAL,GAAgB,IAAIP,iBAAJ,CAAYE,QAAQ,CAACK,QAArB,CAAhB;IACAxB,IAAI,CAACyB,MAAL,GAAc,IAAIR,iBAAJ,CAAYE,QAAQ,CAACM,MAArB,CAAd;IACAzB,IAAI,CAAC0B,IAAL,GAAYP,QAAQ,CAACO,IAAT,IAAiB,EAA7B;IACA1B,IAAI,CAAC2B,YAAL,GAAoB,IAAIN,6BAAJ,CAAoBF,QAAQ,CAACS,UAA7B,CAApB;IACA5B,IAAI,CAAC6B,YAAL,GAAoB,IAAIR,6BAAJ,CAAoBF,QAAQ,CAACW,cAA7B,CAApB;IACA9B,IAAI,CAAC+B,QAAL,GAAgB,IAAIb,wBAAJ,CAAaC,QAAQ,CAACY,QAAtB,CAAhB;IACA/B,IAAI,CAACgC,QAAL,GAAgB,IAAId,wBAAJ,CAAaC,QAAQ,CAACa,QAAtB,CAAhB;IACAhC,IAAI,CAACiC,QAAL,GAAgBd,QAAQ,CAACc,QAAzB;IACAjC,IAAI,CAACkC,aAAL,GAAqBf,QAAQ,CAACe,aAA9B;IAEA,OAAOlC,IAAP;EACH;;EAEDmC,aAAa;IACT,OAAO,IAAIC,6BAAJ,GAAoBC,eAApB,CAAoC,KAAKX,IAAzC,CAAP;EACH;;AAhD+B;;AAApChB;;AAmDA,MAAarB,WAAb,SAAiCY,uBAAjC,CAAwD;EAMpDd,YAAYmD,IAAZ,EAAmD;IAC/C;IACAC,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoBF,IAApB;EACH;;EAEDG,aAAa;IACTC,gBAAOD,aAAP,CAAqB,IAArB;EACH;;EAEDE,SAAS;IACL,OAAO,KAAKC,aAAL,GAAqBD,SAArB,EAAP;EACH;;EAEDC,aAAa;IACT,IAAIC,MAAM,GAAG,KAAKV,aAAL,EAAb;;IACA,IAAIU,MAAM,CAACvD,MAAP,GAAgB,CAApB,EAAuB;MACnB,OAAOwD,wBAAWC,IAAlB;IACH;;IACD,IAAIC,eAAe,GAAGH,MAAM,CAAC,CAAD,CAA5B;IACA,OAAOC,wBAAWG,UAAX,CAAsBD,eAAtB,CAAP;EACH;;EAEDE,aAAa;IACT,KAAKT,aAAL,GADS,CAGT;;IACA,OAAO,KAAKN,aAAL,GAAqBgB,KAArB,CAA2B,CAA3B,CAAP;EACH;;EAEDC,qBAAqB,CAACC,kBAAD,EAAuC;IACxD,KAAKA,kBAAL,GAA0BA,kBAA1B;EACH;;EAEDC,qBAAqB;IACjB,OAAO,KAAKD,kBAAZ;EACH;;EAEDE,gBAAgB;IACZ,OAAO,KAAKrB,aAAZ;EACH;;EAEDsB,WAAW;IACP,OAAOd,gBAAOc,WAAP,CAAmB,IAAnB,CAAP;EACH;;EAEDC,YAAY;IACR,OAAOf,gBAAOe,YAAP,CAAoB,IAApB,CAAP;EACH;;AArDmD;;AAAxD/C","names":["SmartContractResults","constructor","items","TypedResult","length","immediateResult","findImmediateResult","immediate","resultingCalls","findResultingCalls","empty","fromHttpResponse","smartContractResults","map","item","SmartContractResultItem","immediateItem","filter","isImmediateResult","undefined","otherItems","getImmediate","getResultingCalls","getAllResults","exports","nonce","valueOf","hash_1","nonce_1","balance_1","Zero","address_1","networkParams_1","response","hash","transaction_1","value","fromString","receiver","sender","data","previousHash","prevTxHash","originalHash","originalTxHash","gasLimit","gasPrice","callType","returnMessage","getDataTokens","argSerializer_1","stringToBuffers","init","Object","assign","assertSuccess","result_1","isSuccess","getReturnCode","tokens","returnCode_1","None","returnCodeToken","fromBuffer","outputUntyped","slice","setEndpointDefinition","endpointDefinition","getEndpointDefinition","getReturnMessage","outputTyped","unpackOutput"],"sourceRoot":"","sources":["../../src/smartcontracts/smartContractResults.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}