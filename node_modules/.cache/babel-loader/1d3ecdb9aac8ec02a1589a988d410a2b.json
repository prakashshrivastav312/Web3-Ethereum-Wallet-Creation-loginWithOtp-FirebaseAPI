{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nconst typeFields_1 = require('../../typeFields');\n\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.InputTypes.TAP_SCRIPT_SIG) {\n    throw new Error('Decode Error: could not decode tapScriptSig with key 0x' + keyVal.key.toString('hex'));\n  }\n\n  if (keyVal.key.length !== 65) {\n    throw new Error('Decode Error: tapScriptSig has invalid key 0x' + keyVal.key.toString('hex'));\n  }\n\n  if (keyVal.value.length !== 64 && keyVal.value.length !== 65) {\n    throw new Error('Decode Error: tapScriptSig has invalid signature in key 0x' + keyVal.key.toString('hex'));\n  }\n\n  const pubkey = keyVal.key.slice(1, 33);\n  const leafHash = keyVal.key.slice(33);\n  return {\n    pubkey,\n    leafHash,\n    signature: keyVal.value\n  };\n}\n\nexports.decode = decode;\n\nfunction encode(tSig) {\n  const head = Buffer.from([typeFields_1.InputTypes.TAP_SCRIPT_SIG]);\n  return {\n    key: Buffer.concat([head, tSig.pubkey, tSig.leafHash]),\n    value: tSig.signature\n  };\n}\n\nexports.encode = encode;\nexports.expected = '{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }';\n\nfunction check(data) {\n  return Buffer.isBuffer(data.pubkey) && Buffer.isBuffer(data.leafHash) && Buffer.isBuffer(data.signature) && data.pubkey.length === 32 && data.leafHash.length === 32 && (data.signature.length === 64 || data.signature.length === 65);\n}\n\nexports.check = check;\n\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString = item.pubkey.toString('hex') + item.leafHash.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return array.filter(v => v.pubkey.equals(item.pubkey) && v.leafHash.equals(item.leafHash)).length === 0;\n}\n\nexports.canAddToArray = canAddToArray;","map":{"version":3,"names":["Object","defineProperty","exports","value","typeFields_1","require","decode","keyVal","key","InputTypes","TAP_SCRIPT_SIG","Error","toString","length","pubkey","slice","leafHash","signature","encode","tSig","head","Buffer","from","concat","expected","check","data","isBuffer","canAddToArray","array","item","dupeSet","dupeString","has","add","filter","v","equals"],"sources":["C:/Users/acer/node_modules/bip174/src/lib/converter/input/tapScriptSig.js"],"sourcesContent":["'use strict';\nObject.defineProperty(exports, '__esModule', { value: true });\nconst typeFields_1 = require('../../typeFields');\nfunction decode(keyVal) {\n  if (keyVal.key[0] !== typeFields_1.InputTypes.TAP_SCRIPT_SIG) {\n    throw new Error(\n      'Decode Error: could not decode tapScriptSig with key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  if (keyVal.key.length !== 65) {\n    throw new Error(\n      'Decode Error: tapScriptSig has invalid key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  if (keyVal.value.length !== 64 && keyVal.value.length !== 65) {\n    throw new Error(\n      'Decode Error: tapScriptSig has invalid signature in key 0x' +\n        keyVal.key.toString('hex'),\n    );\n  }\n  const pubkey = keyVal.key.slice(1, 33);\n  const leafHash = keyVal.key.slice(33);\n  return {\n    pubkey,\n    leafHash,\n    signature: keyVal.value,\n  };\n}\nexports.decode = decode;\nfunction encode(tSig) {\n  const head = Buffer.from([typeFields_1.InputTypes.TAP_SCRIPT_SIG]);\n  return {\n    key: Buffer.concat([head, tSig.pubkey, tSig.leafHash]),\n    value: tSig.signature,\n  };\n}\nexports.encode = encode;\nexports.expected = '{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }';\nfunction check(data) {\n  return (\n    Buffer.isBuffer(data.pubkey) &&\n    Buffer.isBuffer(data.leafHash) &&\n    Buffer.isBuffer(data.signature) &&\n    data.pubkey.length === 32 &&\n    data.leafHash.length === 32 &&\n    (data.signature.length === 64 || data.signature.length === 65)\n  );\n}\nexports.check = check;\nfunction canAddToArray(array, item, dupeSet) {\n  const dupeString =\n    item.pubkey.toString('hex') + item.leafHash.toString('hex');\n  if (dupeSet.has(dupeString)) return false;\n  dupeSet.add(dupeString);\n  return (\n    array.filter(\n      v => v.pubkey.equals(item.pubkey) && v.leafHash.equals(item.leafHash),\n    ).length === 0\n  );\n}\nexports.canAddToArray = canAddToArray;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}