{"ast":null,"code":"/*\n    Copyright 2018 The caver-js Authors\n    This file is part of the caver-js library.\n\n    The caver-js library is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    The caver-js library is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with the caver-js. If not, see <http://www.gnu.org/licenses/>.\n*/\nconst RLP = require('eth-lib/lib/rlp');\n\nconst Hash = require('eth-lib/lib/hash');\n\nconst utils = require('../../../caver-utils');\n\nconst {\n  rlpEncodeForLegacyTransaction,\n  rlpEncodeForValueTransfer,\n  rlpEncodeForValueTransferMemo,\n  rlpEncodeForFeeDelegatedValueTransferMemoWithRatio,\n  rlpEncodeForFeeDelegatedValueTransfer,\n  rlpEncodeForFeeDelegatedValueTransferWithRatio,\n  rlpEncodeForFeeDelegatedValueTransferMemo,\n  rlpEncodeForAccountUpdate,\n  rlpEncodeForContractDeploy,\n  rlpEncodeForContractExecution,\n  rlpEncodeForFeeDelegatedAccountUpdate,\n  rlpEncodeForFeeDelegatedAccountUpdateWithRatio,\n  rlpEncodeForFeeDelegatedSmartContractDeploy,\n  rlpEncodeForFeeDelegatedSmartContractDeployWithRatio,\n  rlpEncodeForFeeDelegatedSmartContractExecution,\n  rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio,\n  rlpEncodeForCancel,\n  rlpEncodeForFeeDelegatedCancel,\n  rlpEncodeForFeeDelegatedCancelWithRatio,\n  rlpEncodeForChainDataAnchoring,\n  parseAccountKey\n} = require('./transactionType');\n\nconst creationNotSupportError = 'ACCOUNT_CREATION transaction type is not supported yet.';\n\nfunction encodeRLPByTxType(transaction) {\n  transaction.type = transaction.senderRawTransaction ? utils.getTxTypeStringFromRawTransaction(transaction.senderRawTransaction) : transaction.type;\n\n  switch (transaction.type) {\n    case 'ACCOUNT_CREATION':\n      throw new Error(creationNotSupportError);\n\n    case 'ACCOUNT_UPDATE':\n      return rlpEncodeForAccountUpdate(transaction);\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n      return rlpEncodeForFeeDelegatedAccountUpdate(transaction);\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedAccountUpdateWithRatio(transaction);\n\n    case 'VALUE_TRANSFER':\n      return rlpEncodeForValueTransfer(transaction);\n\n    case 'VALUE_TRANSFER_MEMO':\n      return rlpEncodeForValueTransferMemo(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER':\n      return rlpEncodeForFeeDelegatedValueTransfer(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedValueTransferWithRatio(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n      return rlpEncodeForFeeDelegatedValueTransferMemo(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedValueTransferMemoWithRatio(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n      return rlpEncodeForFeeDelegatedSmartContractDeploy(transaction);\n\n    case 'SMART_CONTRACT_DEPLOY':\n      return rlpEncodeForContractDeploy(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedSmartContractDeployWithRatio(transaction);\n\n    case 'SMART_CONTRACT_EXECUTION':\n      return rlpEncodeForContractExecution(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n      return rlpEncodeForFeeDelegatedSmartContractExecution(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio(transaction);\n\n    case 'CANCEL':\n      return rlpEncodeForCancel(transaction);\n\n    case 'FEE_DELEGATED_CANCEL':\n      return rlpEncodeForFeeDelegatedCancel(transaction);\n\n    case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedCancelWithRatio(transaction);\n\n    case 'CHAIN_DATA_ANCHORING':\n      return rlpEncodeForChainDataAnchoring(transaction);\n\n    case 'LEGACY':\n    default:\n      return rlpEncodeForLegacyTransaction(transaction);\n  }\n} // case1) sig === [v, r, s]\n// case2) sig ===\n\n\nfunction makeRawTransaction(rlpEncoded, sig, transaction) {\n  const decodedValues = RLP.decode(rlpEncoded);\n  let rawTx;\n  transaction.type = transaction.senderRawTransaction ? utils.getTxTypeStringFromRawTransaction(transaction.senderRawTransaction) : transaction.type;\n\n  switch (transaction.type) {\n    case 'ACCOUNT_CREATION':\n      throw new Error(creationNotSupportError);\n\n    case 'VALUE_TRANSFER':\n    case 'VALUE_TRANSFER_MEMO':\n    case 'ACCOUNT_UPDATE':\n    case 'SMART_CONTRACT_DEPLOY':\n    case 'SMART_CONTRACT_EXECUTION':\n    case 'CANCEL':\n    case 'CHAIN_DATA_ANCHORING':\n      return _combineSenderRawTransaction(rlpEncoded, sig);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER':\n    case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n    case 'FEE_DELEGATED_CANCEL':\n    case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO':\n      {\n        if (transaction.senderRawTransaction) {\n          const decoded = decodeFromRawTransaction(transaction.senderRawTransaction);\n          return _combineFeePayerRawTransaction(rlpEncoded, sig, transaction, decoded.signatures);\n        }\n\n        if (transaction.feePayer && transaction.feePayer !== '0x' && transaction.feePayer !== '0x0000000000000000000000000000000000000000' && transaction.feePayerSignatures) {\n          return _combineFeePayerRawTransaction(rlpEncoded, transaction.feePayerSignatures, transaction, sig);\n        }\n\n        return _combineSenderRawTransaction(rlpEncoded, sig);\n      }\n\n    case 'LEGACY':\n    default:\n      rawTx = decodedValues.slice(0, 6).concat(sig[0]);\n      return {\n        rawTransaction: RLP.encode(rawTx),\n        signatures: sig[0],\n        feePayerSignatures: undefined\n      };\n  }\n}\n\nfunction _combineSenderRawTransaction(rlpEncoded, sig) {\n  const decodedValues = RLP.decode(rlpEncoded);\n  const [data] = decodedValues;\n  let [txType, ...rawTx] = RLP.decode(data);\n  if (!Array.isArray(sig[0])) sig = [sig];\n  sig = refineSignatures(sig);\n  rawTx = [...rawTx, sig]; // set default feepayer's information in rawTx\n\n  const typeString = utils.getTxTypeStringFromRawTransaction(txType);\n  if (typeString !== undefined && typeString.includes('FEE_DELEGATED')) rawTx = [...rawTx, '0x0000000000000000000000000000000000000000', [['0x01', '0x', '0x']]];\n  return {\n    rawTransaction: txType + RLP.encode(rawTx).slice(2),\n    signatures: sig,\n    feePayerSignatures: undefined\n  };\n}\n\nfunction _combineFeePayerRawTransaction(rlpEncoded, feePayerSignatures, transaction, senderSignature) {\n  const decodedValues = RLP.decode(rlpEncoded);\n  const [data] = decodedValues;\n  let [txType, ...rawTx] = RLP.decode(data);\n  if (!Array.isArray(feePayerSignatures[0])) feePayerSignatures = [feePayerSignatures];\n  senderSignature = refineSignatures(senderSignature);\n  feePayerSignatures = refineSignatures(feePayerSignatures);\n  rawTx = [...rawTx, senderSignature, transaction.feePayer.toLowerCase(), feePayerSignatures];\n  return {\n    rawTransaction: txType + RLP.encode(rawTx).slice(2),\n    signatures: senderSignature,\n    feePayerSignatures\n  };\n} // refineSignatures removes duplication and empty signatures\n\n\nfunction refineSignatures(sigArray) {\n  const set = new Set();\n  let result = [];\n\n  for (const sig of sigArray) {\n    if (sig.length > 0 && !utils.isEmptySig(sig)) {\n      const sigString = sig.join('');\n\n      if (!set.has(sigString)) {\n        set.add(sigString, true);\n        result.push(sig);\n      }\n    }\n  }\n\n  if (result.length === 0) result = [['0x01', '0x', '0x']];\n  return result;\n}\n\nfunction extractSignatures(rawTransaction) {\n  let senderSignatures = [];\n  let feePayerSignatures = [];\n\n  const decoded = _decodeFromRawTransaction(rawTransaction);\n\n  senderSignatures = senderSignatures.concat(decoded.signatures);\n\n  if (decoded.feePayerSignatures) {\n    feePayerSignatures = feePayerSignatures.concat(decoded.feePayerSignatures);\n  }\n\n  return {\n    senderSignatures,\n    feePayerSignatures,\n    decodedTransaction: decoded\n  };\n}\n\nfunction splitFeePayer(rawTransaction) {\n  const typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction);\n  if (!typeString || !typeString.includes('FEE_DELEGATED')) throw new Error(`Failed to split fee payer: not a fee delegated transaction type('${typeString || 'LEGACY'}')`);\n  const txType = rawTransaction.slice(0, 4);\n  const decodedValues = RLP.decode(utils.addHexPrefix(rawTransaction.slice(4)));\n  const detachFeePayer = decodedValues.splice(0, decodedValues.length - 2);\n  detachFeePayer.push('0x0000000000000000000000000000000000000000');\n  detachFeePayer.push([['0x01', '0x', '0x']]);\n  return {\n    senderRawTransaction: txType + RLP.encode(detachFeePayer).slice(2),\n    feePayer: decodedValues[0],\n    feePayerSignatures: decodedValues[1]\n  };\n}\n\nfunction decodeFromRawTransaction(rawTransaction, type) {\n  let decodeResult = _decodeFromRawTransaction(rawTransaction, type);\n\n  switch (decodeResult.type) {\n    case 'ACCOUNT_UPDATE':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n      {\n        decodeResult = parseAccountKey(decodeResult);\n      }\n  }\n\n  return decodeResult;\n}\n\nfunction _decodeFromRawTransaction(rawTransaction, type) {\n  let typeString = type;\n\n  if (typeString === undefined || typeString !== 'LEGACY') {\n    typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction);\n\n    if (typeString === undefined) {\n      typeString = 'LEGACY';\n    } else {\n      rawTransaction = `0x${rawTransaction.slice(4)}`;\n    }\n  }\n\n  switch (typeString) {\n    case 'LEGACY':\n      {\n        const [nonce, gasPrice, gas, to, value, data, v, r, s] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          data,\n          v,\n          r,\n          s,\n          signatures: [v, r, s]\n        };\n      }\n\n    case 'VALUE_TRANSFER':\n      {\n        const [nonce, gasPrice, gas, to, value, from, signatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER':\n      {\n        const [nonce, gasPrice, gas, to, value, from, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n      {\n        const [nonce, gasPrice, gas, to, value, from, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'VALUE_TRANSFER_MEMO':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, signatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'ACCOUNT_CREATION':\n      {\n        throw new Error(creationNotSupportError);\n      }\n\n    case 'ACCOUNT_UPDATE':\n      {\n        const [nonce, gasPrice, gas, from, accountKey, signatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          accountKey,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n      {\n        const [nonce, gasPrice, gas, from, accountKey, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          accountKey,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n      {\n        const [nonce, gasPrice, gas, from, accountKey, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          accountKey,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'SMART_CONTRACT_DEPLOY':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, humanReadable, codeFormat, signatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          humanReadable: humanReadable === '0x01',\n          codeFormat,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, humanReadable, codeFormat, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          humanReadable: humanReadable === '0x01',\n          codeFormat,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, humanReadable, feeRatio, codeFormat, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          humanReadable: humanReadable === '0x01',\n          feeRatio,\n          codeFormat,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'SMART_CONTRACT_EXECUTION':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, signatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO':\n      {\n        const [nonce, gasPrice, gas, to, value, from, data, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'CANCEL':\n      {\n        const [nonce, gasPrice, gas, from, signatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_CANCEL':\n      {\n        const [nonce, gasPrice, gas, from, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n      {\n        const [nonce, gasPrice, gas, from, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'CHAIN_DATA_ANCHORING':\n      {\n        const [nonce, gasPrice, gas, from, data, signatures] = RLP.decode(rawTransaction);\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          data: data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n  }\n}\n\nfunction overwriteSignature(rawTransaction, txObj, signature, feePayerSignature) {\n  if (signature === undefined) {\n    signature = [txObj.v, txObj.r, txObj.s];\n  }\n\n  if (txObj.type.includes('FEE_DELEGATED') && feePayerSignature === undefined) {\n    feePayerSignature = [txObj.payerV, txObj.payerR, txObj.payerS];\n  }\n\n  if (txObj.type === 'LEGACY') {\n    let decodeLegacy = RLP.decode(rawTransaction);\n    decodeLegacy = decodeLegacy.slice(0, 6).concat(signature);\n    return RLP.encode(decodeLegacy);\n  }\n\n  const type = rawTransaction.slice(0, 4);\n  const typeDetached = `0x${rawTransaction.slice(4)}`;\n  const data = RLP.decode(typeDetached);\n\n  if (txObj.type.includes('FEE_DELEGATED')) {\n    data[data.length - 3] = [signature];\n    data[data.length - 1] = [feePayerSignature];\n  } else {\n    data[data.length - 1] = [signature];\n  }\n\n  return type + RLP.encode(data).slice(2);\n}\n\nfunction getSenderTxHash(rawTransaction) {\n  const typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction);\n  if (typeString === undefined || !typeString.includes('FEE_DELEGATED')) return Hash.keccak256(rawTransaction);\n  const type = rawTransaction.slice(0, 4);\n  const typeDetached = `0x${rawTransaction.slice(4)}`;\n  const data = RLP.decode(typeDetached);\n  return Hash.keccak256(type + RLP.encode(data.slice(0, data.length - 2)).slice(2));\n}\n\nmodule.exports = {\n  encodeRLPByTxType,\n  makeRawTransaction,\n  decodeFromRawTransaction,\n  overwriteSignature,\n  getSenderTxHash,\n  splitFeePayer,\n  extractSignatures\n};","map":{"version":3,"names":["RLP","require","Hash","utils","rlpEncodeForLegacyTransaction","rlpEncodeForValueTransfer","rlpEncodeForValueTransferMemo","rlpEncodeForFeeDelegatedValueTransferMemoWithRatio","rlpEncodeForFeeDelegatedValueTransfer","rlpEncodeForFeeDelegatedValueTransferWithRatio","rlpEncodeForFeeDelegatedValueTransferMemo","rlpEncodeForAccountUpdate","rlpEncodeForContractDeploy","rlpEncodeForContractExecution","rlpEncodeForFeeDelegatedAccountUpdate","rlpEncodeForFeeDelegatedAccountUpdateWithRatio","rlpEncodeForFeeDelegatedSmartContractDeploy","rlpEncodeForFeeDelegatedSmartContractDeployWithRatio","rlpEncodeForFeeDelegatedSmartContractExecution","rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio","rlpEncodeForCancel","rlpEncodeForFeeDelegatedCancel","rlpEncodeForFeeDelegatedCancelWithRatio","rlpEncodeForChainDataAnchoring","parseAccountKey","creationNotSupportError","encodeRLPByTxType","transaction","type","senderRawTransaction","getTxTypeStringFromRawTransaction","Error","makeRawTransaction","rlpEncoded","sig","decodedValues","decode","rawTx","_combineSenderRawTransaction","decoded","decodeFromRawTransaction","_combineFeePayerRawTransaction","signatures","feePayer","feePayerSignatures","slice","concat","rawTransaction","encode","undefined","data","txType","Array","isArray","refineSignatures","typeString","includes","senderSignature","toLowerCase","sigArray","set","Set","result","length","isEmptySig","sigString","join","has","add","push","extractSignatures","senderSignatures","_decodeFromRawTransaction","decodedTransaction","splitFeePayer","addHexPrefix","detachFeePayer","splice","decodeResult","nonce","gasPrice","gas","to","value","v","r","s","from","payerV","payerR","payerS","feeRatio","accountKey","humanReadable","codeFormat","overwriteSignature","txObj","signature","feePayerSignature","decodeLegacy","typeDetached","getSenderTxHash","keccak256","module","exports"],"sources":["C:/Users/acer/node_modules/caver-js/packages/caver-klay/caver-klay-accounts/src/makeRawTransaction.js"],"sourcesContent":["/*\n    Copyright 2018 The caver-js Authors\n    This file is part of the caver-js library.\n\n    The caver-js library is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    The caver-js library is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with the caver-js. If not, see <http://www.gnu.org/licenses/>.\n*/\n\nconst RLP = require('eth-lib/lib/rlp')\nconst Hash = require('eth-lib/lib/hash')\nconst utils = require('../../../caver-utils')\n\nconst {\n    rlpEncodeForLegacyTransaction,\n    rlpEncodeForValueTransfer,\n    rlpEncodeForValueTransferMemo,\n    rlpEncodeForFeeDelegatedValueTransferMemoWithRatio,\n    rlpEncodeForFeeDelegatedValueTransfer,\n    rlpEncodeForFeeDelegatedValueTransferWithRatio,\n    rlpEncodeForFeeDelegatedValueTransferMemo,\n    rlpEncodeForAccountUpdate,\n    rlpEncodeForContractDeploy,\n    rlpEncodeForContractExecution,\n    rlpEncodeForFeeDelegatedAccountUpdate,\n    rlpEncodeForFeeDelegatedAccountUpdateWithRatio,\n    rlpEncodeForFeeDelegatedSmartContractDeploy,\n    rlpEncodeForFeeDelegatedSmartContractDeployWithRatio,\n    rlpEncodeForFeeDelegatedSmartContractExecution,\n    rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio,\n\n    rlpEncodeForCancel,\n    rlpEncodeForFeeDelegatedCancel,\n    rlpEncodeForFeeDelegatedCancelWithRatio,\n    rlpEncodeForChainDataAnchoring,\n\n    parseAccountKey,\n} = require('./transactionType')\n\nconst creationNotSupportError = 'ACCOUNT_CREATION transaction type is not supported yet.'\n\nfunction encodeRLPByTxType(transaction) {\n    transaction.type = transaction.senderRawTransaction\n        ? utils.getTxTypeStringFromRawTransaction(transaction.senderRawTransaction)\n        : transaction.type\n\n    switch (transaction.type) {\n        case 'ACCOUNT_CREATION':\n            throw new Error(creationNotSupportError)\n        case 'ACCOUNT_UPDATE':\n            return rlpEncodeForAccountUpdate(transaction)\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n            return rlpEncodeForFeeDelegatedAccountUpdate(transaction)\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n            return rlpEncodeForFeeDelegatedAccountUpdateWithRatio(transaction)\n        case 'VALUE_TRANSFER':\n            return rlpEncodeForValueTransfer(transaction)\n        case 'VALUE_TRANSFER_MEMO':\n            return rlpEncodeForValueTransferMemo(transaction)\n        case 'FEE_DELEGATED_VALUE_TRANSFER':\n            return rlpEncodeForFeeDelegatedValueTransfer(transaction)\n        case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n            return rlpEncodeForFeeDelegatedValueTransferWithRatio(transaction)\n        case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n            return rlpEncodeForFeeDelegatedValueTransferMemo(transaction)\n        case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n            return rlpEncodeForFeeDelegatedValueTransferMemoWithRatio(transaction)\n        case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n            return rlpEncodeForFeeDelegatedSmartContractDeploy(transaction)\n        case 'SMART_CONTRACT_DEPLOY':\n            return rlpEncodeForContractDeploy(transaction)\n        case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n            return rlpEncodeForFeeDelegatedSmartContractDeployWithRatio(transaction)\n        case 'SMART_CONTRACT_EXECUTION':\n            return rlpEncodeForContractExecution(transaction)\n        case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n            return rlpEncodeForFeeDelegatedSmartContractExecution(transaction)\n        case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO':\n            return rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio(transaction)\n        case 'CANCEL':\n            return rlpEncodeForCancel(transaction)\n        case 'FEE_DELEGATED_CANCEL':\n            return rlpEncodeForFeeDelegatedCancel(transaction)\n        case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n            return rlpEncodeForFeeDelegatedCancelWithRatio(transaction)\n        case 'CHAIN_DATA_ANCHORING':\n            return rlpEncodeForChainDataAnchoring(transaction)\n        case 'LEGACY':\n        default:\n            return rlpEncodeForLegacyTransaction(transaction)\n    }\n}\n\n// case1) sig === [v, r, s]\n// case2) sig ===\nfunction makeRawTransaction(rlpEncoded, sig, transaction) {\n    const decodedValues = RLP.decode(rlpEncoded)\n    let rawTx\n\n    transaction.type = transaction.senderRawTransaction\n        ? utils.getTxTypeStringFromRawTransaction(transaction.senderRawTransaction)\n        : transaction.type\n\n    switch (transaction.type) {\n        case 'ACCOUNT_CREATION':\n            throw new Error(creationNotSupportError)\n        case 'VALUE_TRANSFER':\n        case 'VALUE_TRANSFER_MEMO':\n        case 'ACCOUNT_UPDATE':\n        case 'SMART_CONTRACT_DEPLOY':\n        case 'SMART_CONTRACT_EXECUTION':\n        case 'CANCEL':\n        case 'CHAIN_DATA_ANCHORING':\n            return _combineSenderRawTransaction(rlpEncoded, sig)\n        case 'FEE_DELEGATED_VALUE_TRANSFER':\n        case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n        case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n        case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n        case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n        case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n        case 'FEE_DELEGATED_CANCEL':\n        case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n        case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n        case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO': {\n            if (transaction.senderRawTransaction) {\n                const decoded = decodeFromRawTransaction(transaction.senderRawTransaction)\n                return _combineFeePayerRawTransaction(rlpEncoded, sig, transaction, decoded.signatures)\n            }\n            if (\n                transaction.feePayer &&\n                transaction.feePayer !== '0x' &&\n                transaction.feePayer !== '0x0000000000000000000000000000000000000000' &&\n                transaction.feePayerSignatures\n            ) {\n                return _combineFeePayerRawTransaction(rlpEncoded, transaction.feePayerSignatures, transaction, sig)\n            }\n            return _combineSenderRawTransaction(rlpEncoded, sig)\n        }\n        case 'LEGACY':\n        default:\n            rawTx = decodedValues.slice(0, 6).concat(sig[0])\n            return {\n                rawTransaction: RLP.encode(rawTx),\n                signatures: sig[0],\n                feePayerSignatures: undefined,\n            }\n    }\n}\n\nfunction _combineSenderRawTransaction(rlpEncoded, sig) {\n    const decodedValues = RLP.decode(rlpEncoded)\n\n    const [data] = decodedValues\n    let [txType, ...rawTx] = RLP.decode(data)\n\n    if (!Array.isArray(sig[0])) sig = [sig]\n    sig = refineSignatures(sig)\n\n    rawTx = [...rawTx, sig]\n\n    // set default feepayer's information in rawTx\n    const typeString = utils.getTxTypeStringFromRawTransaction(txType)\n    if (typeString !== undefined && typeString.includes('FEE_DELEGATED'))\n        rawTx = [...rawTx, '0x0000000000000000000000000000000000000000', [['0x01', '0x', '0x']]]\n\n    return {\n        rawTransaction: txType + RLP.encode(rawTx).slice(2),\n        signatures: sig,\n        feePayerSignatures: undefined,\n    }\n}\n\nfunction _combineFeePayerRawTransaction(rlpEncoded, feePayerSignatures, transaction, senderSignature) {\n    const decodedValues = RLP.decode(rlpEncoded)\n\n    const [data] = decodedValues\n    let [txType, ...rawTx] = RLP.decode(data)\n\n    if (!Array.isArray(feePayerSignatures[0])) feePayerSignatures = [feePayerSignatures]\n    senderSignature = refineSignatures(senderSignature)\n    feePayerSignatures = refineSignatures(feePayerSignatures)\n\n    rawTx = [...rawTx, senderSignature, transaction.feePayer.toLowerCase(), feePayerSignatures]\n\n    return {\n        rawTransaction: txType + RLP.encode(rawTx).slice(2),\n        signatures: senderSignature,\n        feePayerSignatures,\n    }\n}\n\n// refineSignatures removes duplication and empty signatures\nfunction refineSignatures(sigArray) {\n    const set = new Set()\n    let result = []\n    for (const sig of sigArray) {\n        if (sig.length > 0 && !utils.isEmptySig(sig)) {\n            const sigString = sig.join('')\n            if (!set.has(sigString)) {\n                set.add(sigString, true)\n                result.push(sig)\n            }\n        }\n    }\n\n    if (result.length === 0) result = [['0x01', '0x', '0x']]\n\n    return result\n}\n\nfunction extractSignatures(rawTransaction) {\n    let senderSignatures = []\n    let feePayerSignatures = []\n\n    const decoded = _decodeFromRawTransaction(rawTransaction)\n    senderSignatures = senderSignatures.concat(decoded.signatures)\n    if (decoded.feePayerSignatures) {\n        feePayerSignatures = feePayerSignatures.concat(decoded.feePayerSignatures)\n    }\n    return { senderSignatures, feePayerSignatures, decodedTransaction: decoded }\n}\n\nfunction splitFeePayer(rawTransaction) {\n    const typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction)\n\n    if (!typeString || !typeString.includes('FEE_DELEGATED'))\n        throw new Error(`Failed to split fee payer: not a fee delegated transaction type('${typeString || 'LEGACY'}')`)\n\n    const txType = rawTransaction.slice(0, 4)\n    const decodedValues = RLP.decode(utils.addHexPrefix(rawTransaction.slice(4)))\n\n    const detachFeePayer = decodedValues.splice(0, decodedValues.length - 2)\n    detachFeePayer.push('0x0000000000000000000000000000000000000000')\n    detachFeePayer.push([['0x01', '0x', '0x']])\n\n    return {\n        senderRawTransaction: txType + RLP.encode(detachFeePayer).slice(2),\n        feePayer: decodedValues[0],\n        feePayerSignatures: decodedValues[1],\n    }\n}\n\nfunction decodeFromRawTransaction(rawTransaction, type) {\n    let decodeResult = _decodeFromRawTransaction(rawTransaction, type)\n\n    switch (decodeResult.type) {\n        case 'ACCOUNT_UPDATE':\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO': {\n            decodeResult = parseAccountKey(decodeResult)\n        }\n    }\n    return decodeResult\n}\n\nfunction _decodeFromRawTransaction(rawTransaction, type) {\n    let typeString = type\n    if (typeString === undefined || typeString !== 'LEGACY') {\n        typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction)\n        if (typeString === undefined) {\n            typeString = 'LEGACY'\n        } else {\n            rawTransaction = `0x${rawTransaction.slice(4)}`\n        }\n    }\n\n    switch (typeString) {\n        case 'LEGACY': {\n            const [nonce, gasPrice, gas, to, value, data, v, r, s] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                data,\n                v,\n                r,\n                s,\n                signatures: [v, r, s],\n            }\n        }\n        case 'VALUE_TRANSFER': {\n            const [nonce, gasPrice, gas, to, value, from, signatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n            }\n        }\n        case 'FEE_DELEGATED_VALUE_TRANSFER': {\n            const [nonce, gasPrice, gas, to, value, from, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO': {\n            const [nonce, gasPrice, gas, to, value, from, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                feeRatio,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'VALUE_TRANSFER_MEMO': {\n            const [nonce, gasPrice, gas, to, value, from, data, signatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n            }\n        }\n        case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO': {\n            const [nonce, gasPrice, gas, to, value, from, data, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO': {\n            const [nonce, gasPrice, gas, to, value, from, data, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(\n                rawTransaction\n            )\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                feeRatio,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'ACCOUNT_CREATION': {\n            throw new Error(creationNotSupportError)\n        }\n        case 'ACCOUNT_UPDATE': {\n            const [nonce, gasPrice, gas, from, accountKey, signatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                from,\n                accountKey,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n            }\n        }\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE': {\n            const [nonce, gasPrice, gas, from, accountKey, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                from,\n                accountKey,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO': {\n            const [nonce, gasPrice, gas, from, accountKey, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                from,\n                accountKey,\n                feeRatio,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'SMART_CONTRACT_DEPLOY': {\n            const [nonce, gasPrice, gas, to, value, from, data, humanReadable, codeFormat, signatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                humanReadable: humanReadable === '0x01',\n                codeFormat,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n            }\n        }\n        case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY': {\n            const [\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                humanReadable,\n                codeFormat,\n                signatures,\n                feePayer,\n                feePayerSignatures,\n            ] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                humanReadable: humanReadable === '0x01',\n                codeFormat,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO': {\n            const [\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                humanReadable,\n                feeRatio,\n                codeFormat,\n                signatures,\n                feePayer,\n                feePayerSignatures,\n            ] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                humanReadable: humanReadable === '0x01',\n                feeRatio,\n                codeFormat,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'SMART_CONTRACT_EXECUTION': {\n            const [nonce, gasPrice, gas, to, value, from, data, signatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n            }\n        }\n        case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION': {\n            const [nonce, gasPrice, gas, to, value, from, data, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO': {\n            const [nonce, gasPrice, gas, to, value, from, data, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(\n                rawTransaction\n            )\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                to,\n                value,\n                from,\n                data,\n                feeRatio,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'CANCEL': {\n            const [nonce, gasPrice, gas, from, signatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                from,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n            }\n        }\n        case 'FEE_DELEGATED_CANCEL': {\n            const [nonce, gasPrice, gas, from, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                from,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'FEE_DELEGATED_CANCEL_WITH_RATIO': {\n            const [nonce, gasPrice, gas, from, feeRatio, signatures, feePayer, feePayerSignatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                from,\n                feeRatio,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n                feePayer,\n                payerV: feePayerSignatures[0][0],\n                payerR: feePayerSignatures[0][1],\n                payerS: feePayerSignatures[0][2],\n                feePayerSignatures,\n            }\n        }\n        case 'CHAIN_DATA_ANCHORING': {\n            const [nonce, gasPrice, gas, from, data, signatures] = RLP.decode(rawTransaction)\n            return {\n                type: typeString,\n                nonce,\n                gasPrice,\n                gas,\n                from,\n                data: data,\n                v: signatures[0][0],\n                r: signatures[0][1],\n                s: signatures[0][2],\n                signatures,\n            }\n        }\n    }\n}\n\nfunction overwriteSignature(rawTransaction, txObj, signature, feePayerSignature) {\n    if (signature === undefined) {\n        signature = [txObj.v, txObj.r, txObj.s]\n    }\n    if (txObj.type.includes('FEE_DELEGATED') && feePayerSignature === undefined) {\n        feePayerSignature = [txObj.payerV, txObj.payerR, txObj.payerS]\n    }\n\n    if (txObj.type === 'LEGACY') {\n        let decodeLegacy = RLP.decode(rawTransaction)\n        decodeLegacy = decodeLegacy.slice(0, 6).concat(signature)\n        return RLP.encode(decodeLegacy)\n    }\n\n    const type = rawTransaction.slice(0, 4)\n    const typeDetached = `0x${rawTransaction.slice(4)}`\n\n    const data = RLP.decode(typeDetached)\n    if (txObj.type.includes('FEE_DELEGATED')) {\n        data[data.length - 3] = [signature]\n        data[data.length - 1] = [feePayerSignature]\n    } else {\n        data[data.length - 1] = [signature]\n    }\n\n    return type + RLP.encode(data).slice(2)\n}\n\nfunction getSenderTxHash(rawTransaction) {\n    const typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction)\n    if (typeString === undefined || !typeString.includes('FEE_DELEGATED')) return Hash.keccak256(rawTransaction)\n\n    const type = rawTransaction.slice(0, 4)\n    const typeDetached = `0x${rawTransaction.slice(4)}`\n\n    const data = RLP.decode(typeDetached)\n\n    return Hash.keccak256(type + RLP.encode(data.slice(0, data.length - 2)).slice(2))\n}\n\nmodule.exports = {\n    encodeRLPByTxType,\n    makeRawTransaction,\n    decodeFromRawTransaction,\n    overwriteSignature,\n    getSenderTxHash,\n    splitFeePayer,\n    extractSignatures,\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}