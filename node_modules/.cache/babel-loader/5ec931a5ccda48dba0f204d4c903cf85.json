{"ast":null,"code":"'use strict';\n\nvar defined = require('./utils').defined;\n\nvar varint = require('varint');\n\nfunction compileEncodingLength(m, enc, oneofs) {\n  const oneofsKeys = Object.keys(oneofs);\n  const encLength = enc.length;\n  const hls = new Array(encLength);\n\n  for (let i = 0; i < m.fields.length; i++) {\n    hls[i] = varint.encodingLength(m.fields[i].tag << 3 | enc[i].type);\n    const field = m.fields[i];\n    m.fields[i].packed = field.repeated && field.options && field.options.packed && field.options.packed !== 'false';\n  }\n\n  return function encodingLength(obj) {\n    let length = 0;\n    let i = 0;\n    let j = 0;\n\n    for (i = 0; i < oneofsKeys.length; i++) {\n      const name = oneofsKeys[i];\n      const props = oneofs[name];\n      let match = false;\n\n      for (j = 0; j < props.length; j++) {\n        if (defined(obj[props[j]])) {\n          if (match) {\n            throw new Error('only one of the properties defined in oneof ' + name + ' can be set');\n          }\n\n          match = true;\n        }\n      }\n    }\n\n    for (i = 0; i < encLength; i++) {\n      const e = enc[i];\n      const field = m.fields[i];\n      let val = obj[field.name];\n      const hl = hls[i];\n      let len;\n\n      if (!defined(val)) {\n        if (field.required) {\n          throw new Error(field.name + ' is required');\n        }\n\n        continue;\n      }\n\n      if (field.map) {\n        const tmp = Object.keys(val);\n\n        for (j = 0; j < tmp.length; j++) {\n          tmp[j] = {\n            key: tmp[j],\n            value: val[tmp[j]]\n          };\n        }\n\n        val = tmp;\n      }\n\n      if (field.packed) {\n        let packedLen = 0;\n\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue;\n          }\n\n          len = e.encodingLength(val[j]);\n          packedLen += len;\n\n          if (e.message) {\n            packedLen += varint.encodingLength(len);\n          }\n        }\n\n        if (packedLen) {\n          length += hl + packedLen + varint.encodingLength(packedLen);\n        }\n      } else if (field.repeated) {\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue;\n          }\n\n          len = e.encodingLength(val[j]);\n          length += hl + len + (e.message ? varint.encodingLength(len) : 0);\n        }\n      } else {\n        len = e.encodingLength(val);\n        length += hl + len + (e.message ? varint.encodingLength(len) : 0);\n      }\n    }\n\n    return length;\n  };\n}\n\nmodule.exports = compileEncodingLength;","map":{"version":3,"names":["defined","require","varint","compileEncodingLength","m","enc","oneofs","oneofsKeys","Object","keys","encLength","length","hls","Array","i","fields","encodingLength","tag","type","field","packed","repeated","options","obj","j","name","props","match","Error","e","val","hl","len","required","map","tmp","key","value","packedLen","message","module","exports"],"sources":["C:/Users/acer/node_modules/protons/src/compile/encoding-length.js"],"sourcesContent":["'use strict'\n\nvar defined = require('./utils').defined\nvar varint = require('varint')\n\nfunction compileEncodingLength (m, enc, oneofs) {\n  const oneofsKeys = Object.keys(oneofs)\n  const encLength = enc.length\n\n  const hls = new Array(encLength)\n\n  for (let i = 0; i < m.fields.length; i++) {\n    hls[i] = varint.encodingLength(m.fields[i].tag << 3 | enc[i].type)\n\n    const field = m.fields[i]\n    m.fields[i].packed = field.repeated && field.options && field.options.packed && field.options.packed !== 'false'\n  }\n\n  return function encodingLength (obj) {\n    let length = 0\n    let i = 0\n    let j = 0\n\n    for (i = 0; i < oneofsKeys.length; i++) {\n      const name = oneofsKeys[i]\n      const props = oneofs[name]\n\n      let match = false\n      for (j = 0; j < props.length; j++) {\n        if (defined(obj[props[j]])) {\n          if (match) {\n            throw new Error('only one of the properties defined in oneof ' + name + ' can be set')\n          }\n          match = true\n        }\n      }\n    }\n\n    for (i = 0; i < encLength; i++) {\n      const e = enc[i]\n      const field = m.fields[i]\n      let val = obj[field.name]\n      const hl = hls[i]\n      let len\n\n      if (!defined(val)) {\n        if (field.required) {\n          throw new Error(field.name + ' is required')\n        }\n\n        continue\n      }\n\n      if (field.map) {\n        const tmp = Object.keys(val)\n        for (j = 0; j < tmp.length; j++) {\n          tmp[j] = {\n            key: tmp[j],\n            value: val[tmp[j]]\n          }\n        }\n\n        val = tmp\n      }\n\n      if (field.packed) {\n        let packedLen = 0\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue\n          }\n          len = e.encodingLength(val[j])\n          packedLen += len\n\n          if (e.message) {\n            packedLen += varint.encodingLength(len)\n          }\n        }\n\n        if (packedLen) {\n          length += hl + packedLen + varint.encodingLength(packedLen)\n        }\n      } else if (field.repeated) {\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue\n          }\n\n          len = e.encodingLength(val[j])\n          length += hl + len + (e.message ? varint.encodingLength(len) : 0)\n        }\n      } else {\n        len = e.encodingLength(val)\n        length += hl + len + (e.message ? varint.encodingLength(len) : 0)\n      }\n    }\n\n    return length\n  }\n}\n\nmodule.exports = compileEncodingLength\n"],"mappings":"AAAA;;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAP,CAAmBD,OAAjC;;AACA,IAAIE,MAAM,GAAGD,OAAO,CAAC,QAAD,CAApB;;AAEA,SAASE,qBAAT,CAAgCC,CAAhC,EAAmCC,GAAnC,EAAwCC,MAAxC,EAAgD;EAC9C,MAAMC,UAAU,GAAGC,MAAM,CAACC,IAAP,CAAYH,MAAZ,CAAnB;EACA,MAAMI,SAAS,GAAGL,GAAG,CAACM,MAAtB;EAEA,MAAMC,GAAG,GAAG,IAAIC,KAAJ,CAAUH,SAAV,CAAZ;;EAEA,KAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,CAAC,CAACW,MAAF,CAASJ,MAA7B,EAAqCG,CAAC,EAAtC,EAA0C;IACxCF,GAAG,CAACE,CAAD,CAAH,GAASZ,MAAM,CAACc,cAAP,CAAsBZ,CAAC,CAACW,MAAF,CAASD,CAAT,EAAYG,GAAZ,IAAmB,CAAnB,GAAuBZ,GAAG,CAACS,CAAD,CAAH,CAAOI,IAApD,CAAT;IAEA,MAAMC,KAAK,GAAGf,CAAC,CAACW,MAAF,CAASD,CAAT,CAAd;IACAV,CAAC,CAACW,MAAF,CAASD,CAAT,EAAYM,MAAZ,GAAqBD,KAAK,CAACE,QAAN,IAAkBF,KAAK,CAACG,OAAxB,IAAmCH,KAAK,CAACG,OAAN,CAAcF,MAAjD,IAA2DD,KAAK,CAACG,OAAN,CAAcF,MAAd,KAAyB,OAAzG;EACD;;EAED,OAAO,SAASJ,cAAT,CAAyBO,GAAzB,EAA8B;IACnC,IAAIZ,MAAM,GAAG,CAAb;IACA,IAAIG,CAAC,GAAG,CAAR;IACA,IAAIU,CAAC,GAAG,CAAR;;IAEA,KAAKV,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGP,UAAU,CAACI,MAA3B,EAAmCG,CAAC,EAApC,EAAwC;MACtC,MAAMW,IAAI,GAAGlB,UAAU,CAACO,CAAD,CAAvB;MACA,MAAMY,KAAK,GAAGpB,MAAM,CAACmB,IAAD,CAApB;MAEA,IAAIE,KAAK,GAAG,KAAZ;;MACA,KAAKH,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGE,KAAK,CAACf,MAAtB,EAA8Ba,CAAC,EAA/B,EAAmC;QACjC,IAAIxB,OAAO,CAACuB,GAAG,CAACG,KAAK,CAACF,CAAD,CAAN,CAAJ,CAAX,EAA4B;UAC1B,IAAIG,KAAJ,EAAW;YACT,MAAM,IAAIC,KAAJ,CAAU,iDAAiDH,IAAjD,GAAwD,aAAlE,CAAN;UACD;;UACDE,KAAK,GAAG,IAAR;QACD;MACF;IACF;;IAED,KAAKb,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGJ,SAAhB,EAA2BI,CAAC,EAA5B,EAAgC;MAC9B,MAAMe,CAAC,GAAGxB,GAAG,CAACS,CAAD,CAAb;MACA,MAAMK,KAAK,GAAGf,CAAC,CAACW,MAAF,CAASD,CAAT,CAAd;MACA,IAAIgB,GAAG,GAAGP,GAAG,CAACJ,KAAK,CAACM,IAAP,CAAb;MACA,MAAMM,EAAE,GAAGnB,GAAG,CAACE,CAAD,CAAd;MACA,IAAIkB,GAAJ;;MAEA,IAAI,CAAChC,OAAO,CAAC8B,GAAD,CAAZ,EAAmB;QACjB,IAAIX,KAAK,CAACc,QAAV,EAAoB;UAClB,MAAM,IAAIL,KAAJ,CAAUT,KAAK,CAACM,IAAN,GAAa,cAAvB,CAAN;QACD;;QAED;MACD;;MAED,IAAIN,KAAK,CAACe,GAAV,EAAe;QACb,MAAMC,GAAG,GAAG3B,MAAM,CAACC,IAAP,CAAYqB,GAAZ,CAAZ;;QACA,KAAKN,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGW,GAAG,CAACxB,MAApB,EAA4Ba,CAAC,EAA7B,EAAiC;UAC/BW,GAAG,CAACX,CAAD,CAAH,GAAS;YACPY,GAAG,EAAED,GAAG,CAACX,CAAD,CADD;YAEPa,KAAK,EAAEP,GAAG,CAACK,GAAG,CAACX,CAAD,CAAJ;UAFH,CAAT;QAID;;QAEDM,GAAG,GAAGK,GAAN;MACD;;MAED,IAAIhB,KAAK,CAACC,MAAV,EAAkB;QAChB,IAAIkB,SAAS,GAAG,CAAhB;;QACA,KAAKd,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGM,GAAG,CAACnB,MAApB,EAA4Ba,CAAC,EAA7B,EAAiC;UAC/B,IAAI,CAACxB,OAAO,CAAC8B,GAAG,CAACN,CAAD,CAAJ,CAAZ,EAAsB;YACpB;UACD;;UACDQ,GAAG,GAAGH,CAAC,CAACb,cAAF,CAAiBc,GAAG,CAACN,CAAD,CAApB,CAAN;UACAc,SAAS,IAAIN,GAAb;;UAEA,IAAIH,CAAC,CAACU,OAAN,EAAe;YACbD,SAAS,IAAIpC,MAAM,CAACc,cAAP,CAAsBgB,GAAtB,CAAb;UACD;QACF;;QAED,IAAIM,SAAJ,EAAe;UACb3B,MAAM,IAAIoB,EAAE,GAAGO,SAAL,GAAiBpC,MAAM,CAACc,cAAP,CAAsBsB,SAAtB,CAA3B;QACD;MACF,CAjBD,MAiBO,IAAInB,KAAK,CAACE,QAAV,EAAoB;QACzB,KAAKG,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGM,GAAG,CAACnB,MAApB,EAA4Ba,CAAC,EAA7B,EAAiC;UAC/B,IAAI,CAACxB,OAAO,CAAC8B,GAAG,CAACN,CAAD,CAAJ,CAAZ,EAAsB;YACpB;UACD;;UAEDQ,GAAG,GAAGH,CAAC,CAACb,cAAF,CAAiBc,GAAG,CAACN,CAAD,CAApB,CAAN;UACAb,MAAM,IAAIoB,EAAE,GAAGC,GAAL,IAAYH,CAAC,CAACU,OAAF,GAAYrC,MAAM,CAACc,cAAP,CAAsBgB,GAAtB,CAAZ,GAAyC,CAArD,CAAV;QACD;MACF,CATM,MASA;QACLA,GAAG,GAAGH,CAAC,CAACb,cAAF,CAAiBc,GAAjB,CAAN;QACAnB,MAAM,IAAIoB,EAAE,GAAGC,GAAL,IAAYH,CAAC,CAACU,OAAF,GAAYrC,MAAM,CAACc,cAAP,CAAsBgB,GAAtB,CAAZ,GAAyC,CAArD,CAAV;MACD;IACF;;IAED,OAAOrB,MAAP;EACD,CAhFD;AAiFD;;AAED6B,MAAM,CAACC,OAAP,GAAiBtC,qBAAjB"},"metadata":{},"sourceType":"script"}