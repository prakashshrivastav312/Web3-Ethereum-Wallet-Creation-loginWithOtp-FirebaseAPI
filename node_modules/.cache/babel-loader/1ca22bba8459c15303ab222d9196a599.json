{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getCurrentServerTime = exports.SERVER_TIME_MAP = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar axios_1 = tslib_1.__importDefault(require(\"axios\"));\n\nvar urijs_1 = tslib_1.__importDefault(require(\"urijs\"));\n\nvar version = require(\"../package.json\").version;\n\nexports.SERVER_TIME_MAP = {};\nvar HorizonAxiosClient = axios_1.default.create({\n  headers: {\n    \"X-Client-Name\": \"js-stellar-sdk\",\n    \"X-Client-Version\": version\n  }\n});\n\nfunction _toSeconds(ms) {\n  return Math.floor(ms / 1000);\n}\n\nHorizonAxiosClient.interceptors.response.use(function interceptorHorizonResponse(response) {\n  var hostname = urijs_1.default(response.config.url).hostname();\n\n  var serverTime = _toSeconds(Date.parse(response.headers.date));\n\n  var localTimeRecorded = _toSeconds(new Date().getTime());\n\n  if (!isNaN(serverTime)) {\n    exports.SERVER_TIME_MAP[hostname] = {\n      serverTime: serverTime,\n      localTimeRecorded: localTimeRecorded\n    };\n  }\n\n  return response;\n});\nexports.default = HorizonAxiosClient;\n\nfunction getCurrentServerTime(hostname) {\n  var entry = exports.SERVER_TIME_MAP[hostname];\n\n  if (!entry || !entry.localTimeRecorded || !entry.serverTime) {\n    return null;\n  }\n\n  var serverTime = entry.serverTime,\n      localTimeRecorded = entry.localTimeRecorded;\n\n  var currentTime = _toSeconds(new Date().getTime());\n\n  if (currentTime - localTimeRecorded > 60 * 5) {\n    return null;\n  }\n\n  return currentTime - localTimeRecorded + serverTime;\n}\n\nexports.getCurrentServerTime = getCurrentServerTime;","map":{"version":3,"mappings":";;;;;;;;;AAAA;;AACA;;AAGA,IAAMA,OAAO,GAAGC,OAAO,CAAC,iBAAD,CAAP,CAA2BD,OAA3C;;AAmBaE,0BAA8C,EAA9C;AAEb,IAAMC,kBAAkB,GAAGC,gBAAMC,MAAN,CAAa;EACtCC,OAAO,EAAE;IACP,iBAAiB,gBADV;IAEP,oBAAoBN;EAFb;AAD6B,CAAb,CAA3B;;AAOA,SAASO,UAAT,CAAoBC,EAApB,EAA8B;EAC5B,OAAOC,IAAI,CAACC,KAAL,CAAWF,EAAE,GAAG,IAAhB,CAAP;AACD;;AAEDL,kBAAkB,CAACQ,YAAnB,CAAgCC,QAAhC,CAAyCC,GAAzC,CACE,SAASC,0BAAT,CAAoCF,QAApC,EAA2D;EACzD,IAAMG,QAAQ,GAAGC,gBAAIJ,QAAQ,CAACK,MAAT,CAAgBC,GAApB,EAA0BH,QAA1B,EAAjB;;EACA,IAAMI,UAAU,GAAGZ,UAAU,CAACa,IAAI,CAACC,KAAL,CAAWT,QAAQ,CAACN,OAAT,CAAiBgB,IAA5B,CAAD,CAA7B;;EACA,IAAMC,iBAAiB,GAAGhB,UAAU,CAAC,IAAIa,IAAJ,GAAWI,OAAX,EAAD,CAApC;;EAEA,IAAI,CAACC,KAAK,CAACN,UAAD,CAAV,EAAwB;IACtBjB,wBAAgBa,QAAhB,IAA4B;MAC1BI,UAAU,YADgB;MAE1BI,iBAAiB;IAFS,CAA5B;EAID;;EAED,OAAOX,QAAP;AACD,CAdH;AAiBAV,kBAAeC,kBAAf;;AAWA,SAAgBuB,oBAAhB,CAAqCX,QAArC,EAAqD;EACnD,IAAMY,KAAK,GAAGzB,wBAAgBa,QAAhB,CAAd;;EAEA,IAAI,CAACY,KAAD,IAAU,CAACA,KAAK,CAACJ,iBAAjB,IAAsC,CAACI,KAAK,CAACR,UAAjD,EAA6D;IAC3D,OAAO,IAAP;EACD;;EAEO,cAAU,GAAwBQ,KAAK,WAAvC;EAAA,IAAYJ,iBAAiB,GAAKI,KAAK,kBAAvC;;EACR,IAAMC,WAAW,GAAGrB,UAAU,CAAC,IAAIa,IAAJ,GAAWI,OAAX,EAAD,CAA9B;;EAGA,IAAII,WAAW,GAAGL,iBAAd,GAAkC,KAAK,CAA3C,EAA8C;IAC5C,OAAO,IAAP;EACD;;EAED,OAAOK,WAAW,GAAGL,iBAAd,GAAkCJ,UAAzC;AACD;;AAhBDjB","names":["version","require","exports","HorizonAxiosClient","axios_1","create","headers","_toSeconds","ms","Math","floor","interceptors","response","use","interceptorHorizonResponse","hostname","urijs_1","config","url","serverTime","Date","parse","date","localTimeRecorded","getTime","isNaN","getCurrentServerTime","entry","currentTime"],"sourceRoot":"","sources":["../src/horizon_axios_client.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}