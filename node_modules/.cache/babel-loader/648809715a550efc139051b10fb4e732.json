{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AsyncTimer = void 0;\n\nconst errors = __importStar(require(\"./errors\"));\n\nconst errors_1 = require(\"./errors\");\n\nconst logger_1 = require(\"./logger\");\n/*\n * AsyncTimer is an async-friendly abstraction that wraps JavaScript's setTimeout() and clearTimeout().\n */\n\n\nclass AsyncTimer {\n  /**\n   * Creates an AsyncTimer.\n   */\n  constructor(name) {\n    this.timeoutHandle = null;\n    this.rejectionFunc = null;\n    this.name = name;\n    this.correlationTag = 0;\n  }\n  /**\n   * Starts the timer.\n   * @param timeout The time (in milliseconds) to wait until resolving the promise.\n   */\n\n\n  start(timeout) {\n    if (this.timeoutHandle) {\n      throw new errors.ErrAsyncTimerAlreadyRunning();\n    }\n\n    this.correlationTag++;\n    logger_1.Logger.trace(`AsyncTimer[${this.name}'${this.correlationTag}].start()`);\n    return new Promise((resolve, reject) => {\n      this.rejectionFunc = reject;\n\n      let timeoutCallback = () => {\n        this.rejectionFunc = null;\n        this.stop();\n        resolve();\n      };\n\n      this.timeoutHandle = setTimeout(timeoutCallback, timeout);\n    });\n  }\n  /**\n   * Aborts the timer: rejects the promise (if any) and stops the timer.\n   */\n\n\n  abort() {\n    logger_1.Logger.trace(`AsyncTimer[${this.name}'${this.correlationTag}].abort()`);\n\n    if (this.rejectionFunc) {\n      this.rejectionFunc(new errors_1.ErrAsyncTimerAborted());\n      this.rejectionFunc = null;\n    }\n\n    this.stop();\n  }\n  /**\n   * Stops the timer.\n   */\n\n\n  stop() {\n    if (this.isStopped()) {\n      return;\n    }\n\n    logger_1.Logger.trace(`AsyncTimer[${this.name}'${this.correlationTag}].stop()`);\n\n    if (this.timeoutHandle) {\n      clearTimeout(this.timeoutHandle);\n      this.timeoutHandle = null;\n    }\n  }\n  /**\n   * Returns whether the timer is stopped.\n   */\n\n\n  isStopped() {\n    return this.timeoutHandle ? false : true;\n  }\n\n}\n\nexports.AsyncTimer = AsyncTimer;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;AAEA;;;;;AAGA,MAAaA,UAAb,CAAuB;EAMnB;;;EAGAC,YAAYC,IAAZ,EAAwB;IAPhB,qBAAqB,IAArB;IACA,qBAAqB,IAArB;IAOJ,KAAKA,IAAL,GAAYA,IAAZ;IACA,KAAKC,cAAL,GAAsB,CAAtB;EACH;EAED;;;;;;EAIOC,KAAK,CAACC,OAAD,EAAgB;IACxB,IAAI,KAAKC,aAAT,EAAwB;MACpB,MAAM,IAAIC,MAAM,CAACC,2BAAX,EAAN;IACH;;IAED,KAAKL,cAAL;IACAM,gBAAOC,KAAP,CAAa,cAAc,KAAKR,IAAI,IAAI,KAAKC,cAAc,WAA3D;IAEA,OAAO,IAAIQ,OAAJ,CAAkB,CAACC,OAAD,EAAUC,MAAV,KAAoB;MACzC,KAAKC,aAAL,GAAqBD,MAArB;;MAEA,IAAIE,eAAe,GAAG,MAAK;QACvB,KAAKD,aAAL,GAAqB,IAArB;QACA,KAAKE,IAAL;QACAJ,OAAO;MACV,CAJD;;MAMA,KAAKN,aAAL,GAAqBW,UAAU,CAACF,eAAD,EAAkBV,OAAlB,CAA/B;IACH,CAVM,CAAP;EAWH;EAED;;;;;EAGOa,KAAK;IACRT,gBAAOC,KAAP,CAAa,cAAc,KAAKR,IAAI,IAAI,KAAKC,cAAc,WAA3D;;IAEA,IAAI,KAAKW,aAAT,EAAwB;MACpB,KAAKA,aAAL,CAAmB,IAAIK,6BAAJ,EAAnB;MACA,KAAKL,aAAL,GAAqB,IAArB;IACH;;IAED,KAAKE,IAAL;EACH;EAED;;;;;EAGOA,IAAI;IACP,IAAI,KAAKI,SAAL,EAAJ,EAAsB;MAClB;IACH;;IAEDX,gBAAOC,KAAP,CAAa,cAAc,KAAKR,IAAI,IAAI,KAAKC,cAAc,UAA3D;;IAEA,IAAI,KAAKG,aAAT,EAAwB;MACpBe,YAAY,CAAC,KAAKf,aAAN,CAAZ;MACA,KAAKA,aAAL,GAAqB,IAArB;IACH;EACJ;EAED;;;;;EAGOc,SAAS;IACZ,OAAO,KAAKd,aAAL,GAAqB,KAArB,GAA6B,IAApC;EACH;;AA1EkB;;AAAvBgB","names":["AsyncTimer","constructor","name","correlationTag","start","timeout","timeoutHandle","errors","ErrAsyncTimerAlreadyRunning","logger_1","trace","Promise","resolve","reject","rejectionFunc","timeoutCallback","stop","setTimeout","abort","errors_1","isStopped","clearTimeout","exports"],"sourceRoot":"","sources":["../src/asyncTimer.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}