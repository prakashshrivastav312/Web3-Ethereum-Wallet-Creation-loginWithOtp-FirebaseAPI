{"ast":null,"code":"import { AbiCoder, formatSignature as _formatSignature } from '@vechain/ethers/utils/abi-coder';\nimport { keccak256 } from './cry/keccak';\n\nclass Coder extends AbiCoder {\n  constructor() {\n    super((type, value) => {\n      if (type.match(/^u?int/) && !Array.isArray(value) && typeof value !== 'object' || value._ethersType === 'BigNumber') {\n        return value.toString();\n      }\n\n      return value;\n    });\n  }\n\n  encode(types, values) {\n    try {\n      return super.encode(types, values);\n    } catch (err) {\n      if (err.reason) {\n        throw new Error(err.reason);\n      }\n\n      throw err;\n    }\n  }\n\n  decode(types, data) {\n    try {\n      return super.decode(types, data);\n    } catch (err) {\n      if (err.reason) {\n        throw new Error(err.reason);\n      }\n\n      throw err;\n    }\n  }\n\n}\n\nconst coder = new Coder();\n\nfunction formatSignature(fragment) {\n  try {\n    return _formatSignature(fragment);\n  } catch (err) {\n    if (err.reason) {\n      throw new Error(err.reason);\n    }\n\n    throw err;\n  }\n}\n/** encode/decode parameters of contract function call, event log, according to ABI JSON */\n\n\nexport var abi;\n\n(function (abi) {\n  /**\n   * encode single parameter\n   * @param type type of the parameter\n   * @param value value of the parameter\n   * @returns encoded value in hex string\n   */\n  function encodeParameter(type, value) {\n    return coder.encode([type], [value]);\n  }\n\n  abi.encodeParameter = encodeParameter;\n  /**\n   * decode single parameter\n   * @param type type of the parameter\n   * @param data encoded parameter in hex string\n   * @returns decoded value\n   */\n\n  function decodeParameter(type, data) {\n    return coder.decode([type], data)[0];\n  }\n\n  abi.decodeParameter = decodeParameter;\n  /**\n   * encode a group of parameters\n   * @param types type array\n   * @param values value array\n   * @returns encoded values in hex string\n   */\n\n  function encodeParameters(types, values) {\n    return coder.encode(types, values);\n  }\n\n  abi.encodeParameters = encodeParameters;\n  /**\n   * decode a group of parameters\n   * @param types type array\n   * @param data encoded values in hex string\n   * @returns decoded object\n   */\n\n  function decodeParameters(types, data) {\n    const result = coder.decode(types, data);\n    const decoded = {};\n    types.forEach((t, i) => {\n      decoded[i] = result[i];\n\n      if (t.name) {\n        decoded[t.name] = result[i];\n      }\n    });\n    return decoded;\n  }\n\n  abi.decodeParameters = decodeParameters;\n  /** for contract function */\n\n  class Function {\n    /**\n     * create a function object\n     * @param definition abi definition of the function\n     */\n    constructor(definition) {\n      this.definition = definition;\n      this.canonicalName = formatSignature(definition);\n      this.signature = '0x' + keccak256(this.canonicalName).slice(0, 4).toString('hex');\n    }\n    /**\n     * encode input parameters into call data\n     * @param args arguments for the function\n     */\n\n\n    encode() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return this.signature + encodeParameters(this.definition.inputs, args).slice(2);\n    }\n    /**\n     * decode output data\n     * @param outputData output data to decode\n     */\n\n\n    decode(outputData) {\n      return decodeParameters(this.definition.outputs, outputData);\n    }\n\n  }\n\n  abi.Function = Function;\n  /** for contract event */\n\n  class Event {\n    /** for contract event */\n    constructor(definition) {\n      this.definition = definition;\n      this.canonicalName = formatSignature(definition);\n      this.signature = '0x' + keccak256(this.canonicalName).toString('hex');\n    }\n    /**\n     * encode an object of indexed keys into topics.\n     * @param indexed an object contains indexed keys\n     */\n\n\n    encode(indexed) {\n      const topics = [];\n\n      if (!this.definition.anonymous) {\n        topics.push(this.signature);\n      }\n\n      for (const input of this.definition.inputs) {\n        if (!input.indexed) {\n          continue;\n        }\n\n        const value = indexed[input.name];\n\n        if (value === undefined || value === null) {\n          topics.push(null);\n        } else {\n          let topic;\n\n          if (isDynamicType(input.type)) {\n            if (input.type === 'string') {\n              topic = '0x' + keccak256(value).toString('hex');\n            } else {\n              if (typeof value === 'string' && /^0x[0-9a-f]+$/i.test(value) && value.length % 2 === 0) {\n                topic = '0x' + keccak256(Buffer.from(value.slice(2), 'hex')).toString('hex');\n              } else {\n                throw new Error(`invalid ${input.type} value`);\n              }\n            }\n          } else {\n            topic = encodeParameter(input.type, value);\n          }\n\n          topics.push(topic);\n        }\n      }\n\n      return topics;\n    }\n    /**\n     * decode event log\n     * @param data data in event output\n     * @param topics topics in event\n     */\n\n\n    decode(data, topics) {\n      if (!this.definition.anonymous) {\n        topics = topics.slice(1);\n      }\n\n      if (this.definition.inputs.filter(t => t.indexed).length !== topics.length) {\n        throw new Error('invalid topics count');\n      }\n\n      const decodedNonIndexed = coder.decode(this.definition.inputs.filter(t => !t.indexed).map(t => t.type), data);\n      const decoded = {};\n      this.definition.inputs.forEach((t, i) => {\n        if (t.indexed) {\n          const topic = topics.shift();\n          decoded[i] = isDynamicType(t.type) ? topic : decodeParameter(t.type, topic);\n        } else {\n          decoded[i] = decodedNonIndexed.shift();\n        }\n\n        if (t.name) {\n          decoded[t.name] = decoded[i];\n        }\n      });\n      return decoded;\n    }\n\n  }\n\n  abi.Event = Event;\n\n  function isDynamicType(type) {\n    return type === 'bytes' || type === 'string' || type.endsWith('[]');\n  }\n})(abi || (abi = {}));","map":{"version":3,"mappings":"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","names":["AbiCoder","formatSignature","_formatSignature","keccak256","Coder","constructor","type","value","match","Array","isArray","_ethersType","toString","encode","types","values","err","reason","Error","decode","data","coder","fragment","abi","encodeParameter","decodeParameter","encodeParameters","decodeParameters","result","decoded","forEach","t","i","name","Function","definition","canonicalName","signature","slice","args","inputs","outputData","outputs","Event","indexed","topics","anonymous","push","input","undefined","topic","isDynamicType","test","length","Buffer","from","filter","decodedNonIndexed","map","shift","endsWith"],"sourceRoot":"","sources":["../src/abi.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}