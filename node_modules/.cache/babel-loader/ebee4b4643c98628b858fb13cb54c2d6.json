{"ast":null,"code":"'use strict';\n\nconst {\n  AbortController\n} = require('native-abort-controller');\n\nclass SubscriptionTracker {\n  constructor() {\n    this._subs = new Map();\n  }\n\n  static singleton() {\n    if (SubscriptionTracker.instance) return SubscriptionTracker.instance;\n    SubscriptionTracker.instance = new SubscriptionTracker();\n    return SubscriptionTracker.instance;\n  }\n\n  subscribe(topic, handler, signal) {\n    const topicSubs = this._subs.get(topic) || [];\n\n    if (topicSubs.find(s => s.handler === handler)) {\n      throw new Error(`Already subscribed to ${topic} with this handler`);\n    } // Create controller so a call to unsubscribe can cancel the request\n\n\n    const controller = new AbortController();\n\n    this._subs.set(topic, [{\n      handler,\n      controller\n    }].concat(topicSubs)); // If there is an external signal, forward the abort event\n\n\n    if (signal) {\n      signal.addEventListener('abort', () => this.unsubscribe(topic, handler));\n    }\n\n    return controller.signal;\n  }\n\n  unsubscribe(topic, handler) {\n    const subs = this._subs.get(topic) || [];\n    let unsubs;\n\n    if (handler) {\n      this._subs.set(topic, subs.filter(s => s.handler !== handler));\n\n      unsubs = subs.filter(s => s.handler === handler);\n    } else {\n      this._subs.set(topic, []);\n\n      unsubs = subs;\n    }\n\n    unsubs.forEach(s => s.controller.abort());\n  }\n\n}\n\nSubscriptionTracker.instance = null;\nmodule.exports = SubscriptionTracker;","map":{"version":3,"names":["AbortController","require","SubscriptionTracker","constructor","_subs","Map","singleton","instance","subscribe","topic","handler","signal","topicSubs","get","find","s","Error","controller","set","concat","addEventListener","unsubscribe","subs","unsubs","filter","forEach","abort","module","exports"],"sources":["C:/Users/acer/node_modules/ipfs-http-client/src/pubsub/subscription-tracker.js"],"sourcesContent":["'use strict'\n\nconst { AbortController } = require('native-abort-controller')\n\nclass SubscriptionTracker {\n  constructor () {\n    this._subs = new Map()\n  }\n\n  static singleton () {\n    if (SubscriptionTracker.instance) return SubscriptionTracker.instance\n    SubscriptionTracker.instance = new SubscriptionTracker()\n    return SubscriptionTracker.instance\n  }\n\n  subscribe (topic, handler, signal) {\n    const topicSubs = this._subs.get(topic) || []\n\n    if (topicSubs.find(s => s.handler === handler)) {\n      throw new Error(`Already subscribed to ${topic} with this handler`)\n    }\n\n    // Create controller so a call to unsubscribe can cancel the request\n    const controller = new AbortController()\n\n    this._subs.set(topic, [{ handler, controller }].concat(topicSubs))\n\n    // If there is an external signal, forward the abort event\n    if (signal) {\n      signal.addEventListener('abort', () => this.unsubscribe(topic, handler))\n    }\n\n    return controller.signal\n  }\n\n  unsubscribe (topic, handler) {\n    const subs = this._subs.get(topic) || []\n    let unsubs\n\n    if (handler) {\n      this._subs.set(topic, subs.filter(s => s.handler !== handler))\n      unsubs = subs.filter(s => s.handler === handler)\n    } else {\n      this._subs.set(topic, [])\n      unsubs = subs\n    }\n\n    unsubs.forEach(s => s.controller.abort())\n  }\n}\n\nSubscriptionTracker.instance = null\n\nmodule.exports = SubscriptionTracker\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAAsBC,OAAO,CAAC,yBAAD,CAAnC;;AAEA,MAAMC,mBAAN,CAA0B;EACxBC,WAAW,GAAI;IACb,KAAKC,KAAL,GAAa,IAAIC,GAAJ,EAAb;EACD;;EAEe,OAATC,SAAS,GAAI;IAClB,IAAIJ,mBAAmB,CAACK,QAAxB,EAAkC,OAAOL,mBAAmB,CAACK,QAA3B;IAClCL,mBAAmB,CAACK,QAApB,GAA+B,IAAIL,mBAAJ,EAA/B;IACA,OAAOA,mBAAmB,CAACK,QAA3B;EACD;;EAEDC,SAAS,CAAEC,KAAF,EAASC,OAAT,EAAkBC,MAAlB,EAA0B;IACjC,MAAMC,SAAS,GAAG,KAAKR,KAAL,CAAWS,GAAX,CAAeJ,KAAf,KAAyB,EAA3C;;IAEA,IAAIG,SAAS,CAACE,IAAV,CAAeC,CAAC,IAAIA,CAAC,CAACL,OAAF,KAAcA,OAAlC,CAAJ,EAAgD;MAC9C,MAAM,IAAIM,KAAJ,CAAW,yBAAwBP,KAAM,oBAAzC,CAAN;IACD,CALgC,CAOjC;;;IACA,MAAMQ,UAAU,GAAG,IAAIjB,eAAJ,EAAnB;;IAEA,KAAKI,KAAL,CAAWc,GAAX,CAAeT,KAAf,EAAsB,CAAC;MAAEC,OAAF;MAAWO;IAAX,CAAD,EAA0BE,MAA1B,CAAiCP,SAAjC,CAAtB,EAViC,CAYjC;;;IACA,IAAID,MAAJ,EAAY;MACVA,MAAM,CAACS,gBAAP,CAAwB,OAAxB,EAAiC,MAAM,KAAKC,WAAL,CAAiBZ,KAAjB,EAAwBC,OAAxB,CAAvC;IACD;;IAED,OAAOO,UAAU,CAACN,MAAlB;EACD;;EAEDU,WAAW,CAAEZ,KAAF,EAASC,OAAT,EAAkB;IAC3B,MAAMY,IAAI,GAAG,KAAKlB,KAAL,CAAWS,GAAX,CAAeJ,KAAf,KAAyB,EAAtC;IACA,IAAIc,MAAJ;;IAEA,IAAIb,OAAJ,EAAa;MACX,KAAKN,KAAL,CAAWc,GAAX,CAAeT,KAAf,EAAsBa,IAAI,CAACE,MAAL,CAAYT,CAAC,IAAIA,CAAC,CAACL,OAAF,KAAcA,OAA/B,CAAtB;;MACAa,MAAM,GAAGD,IAAI,CAACE,MAAL,CAAYT,CAAC,IAAIA,CAAC,CAACL,OAAF,KAAcA,OAA/B,CAAT;IACD,CAHD,MAGO;MACL,KAAKN,KAAL,CAAWc,GAAX,CAAeT,KAAf,EAAsB,EAAtB;;MACAc,MAAM,GAAGD,IAAT;IACD;;IAEDC,MAAM,CAACE,OAAP,CAAeV,CAAC,IAAIA,CAAC,CAACE,UAAF,CAAaS,KAAb,EAApB;EACD;;AA5CuB;;AA+C1BxB,mBAAmB,CAACK,QAApB,GAA+B,IAA/B;AAEAoB,MAAM,CAACC,OAAP,GAAiB1B,mBAAjB"},"metadata":{},"sourceType":"script"}