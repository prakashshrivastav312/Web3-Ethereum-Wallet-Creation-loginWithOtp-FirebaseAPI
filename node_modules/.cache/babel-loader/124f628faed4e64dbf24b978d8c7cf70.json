{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.StellarTomlResolver = exports.STELLAR_TOML_MAX_SIZE = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar axios_1 = tslib_1.__importDefault(require(\"axios\"));\n\nvar toml_1 = tslib_1.__importDefault(require(\"toml\"));\n\nvar config_1 = require(\"./config\");\n\nexports.STELLAR_TOML_MAX_SIZE = 100 * 1024;\nvar CancelToken = axios_1.default.CancelToken;\n\nvar StellarTomlResolver = function () {\n  function StellarTomlResolver() {}\n\n  StellarTomlResolver.resolve = function (domain, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var allowHttp, timeout, protocol;\n      return tslib_1.__generator(this, function (_a) {\n        allowHttp = typeof opts.allowHttp === \"undefined\" ? config_1.Config.isAllowHttp() : opts.allowHttp;\n        timeout = typeof opts.timeout === \"undefined\" ? config_1.Config.getTimeout() : opts.timeout;\n        protocol = allowHttp ? \"http\" : \"https\";\n        return [2, axios_1.default.get(protocol + \"://\" + domain + \"/.well-known/stellar.toml\", {\n          maxContentLength: exports.STELLAR_TOML_MAX_SIZE,\n          cancelToken: timeout ? new CancelToken(function (cancel) {\n            return setTimeout(function () {\n              return cancel(\"timeout of \" + timeout + \"ms exceeded\");\n            }, timeout);\n          }) : undefined,\n          timeout: timeout\n        }).then(function (response) {\n          try {\n            var tomlObject = toml_1.default.parse(response.data);\n            return Promise.resolve(tomlObject);\n          } catch (e) {\n            return Promise.reject(new Error(\"stellar.toml is invalid - Parsing error on line \" + e.line + \", column \" + e.column + \": \" + e.message));\n          }\n        }).catch(function (err) {\n          if (err.message.match(/^maxContentLength size/)) {\n            throw new Error(\"stellar.toml file exceeds allowed size of \" + exports.STELLAR_TOML_MAX_SIZE);\n          } else {\n            throw err;\n          }\n        })];\n      });\n    });\n  };\n\n  return StellarTomlResolver;\n}();\n\nexports.StellarTomlResolver = StellarTomlResolver;","map":{"version":3,"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAGaA,gCAAwB,MAAM,IAA9B;AAIb,IAAMC,WAAW,GAAGC,gBAAMD,WAA1B;;AAKA;EAAA,gCAoEC;;EAjDqBE,8BAApB,UACEC,MADF,EAEEC,IAFF,EAE0D;IAAxD;MAAAA;IAAwD;;;;;QAElDC,SAAS,GACb,OAAOD,IAAI,CAACC,SAAZ,KAA0B,WAA1B,GACIC,gBAAOC,WAAP,EADJ,GAEIH,IAAI,CAACC,SAHL;QAKAG,OAAO,GACX,OAAOJ,IAAI,CAACI,OAAZ,KAAwB,WAAxB,GAAsCF,gBAAOG,UAAP,EAAtC,GAA4DL,IAAI,CAACI,OAD7D;QAGAE,QAAQ,GAAGL,SAAS,GAAG,MAAH,GAAY,OAAhC;QAEN,WAAOJ,gBACJU,GADI,CACGD,QAAQ,QAAR,GAAcP,MAAd,GAAoB,2BADvB,EACoD;UACvDS,gBAAgB,EAAEb,6BADqC;UAEvDc,WAAW,EAAEL,OAAO,GAChB,IAAIR,WAAJ,CAAgB,UAACc,MAAD,EAAO;YACrB,iBAAU,CACR;cAAM,aAAM,CAAC,gBAAcN,OAAd,GAAqB,aAAtB,CAAN;YAA0C,CADxC,EAERA,OAFQ,CAAV;UAGC,CAJH,CADgB,GAOhBO,SATmD;UAUvDP,OAAO;QAVgD,CADpD,EAaJQ,IAbI,CAaC,UAACC,QAAD,EAAS;UACb,IAAI;YACF,IAAMC,UAAU,GAAGC,eAAKC,KAAL,CAAWH,QAAQ,CAACI,IAApB,CAAnB;YACA,OAAOC,OAAO,CAACC,OAAR,CAAgBL,UAAhB,CAAP;UACD,CAHD,CAGE,OAAOM,CAAP,EAAU;YACV,OAAOF,OAAO,CAACG,MAAR,CACL,IAAIC,KAAJ,CACE,qDAAmDF,CAAC,CAACG,IAArD,GAAyD,WAAzD,GAAqEH,CAAC,CAACI,MAAvE,GAA6E,IAA7E,GAAkFJ,CAAC,CAACK,OADtF,CADK,CAAP;UAKD;QACF,CAxBI,EAyBJC,KAzBI,CAyBE,UAACC,GAAD,EAAW;UAChB,IAAIA,GAAG,CAACF,OAAJ,CAAYG,KAAZ,CAAkB,wBAAlB,CAAJ,EAAiD;YAC/C,MAAM,IAAIN,KAAJ,CACJ,+CAA6C3B,6BADzC,CAAN;UAGD,CAJD,MAIO;YACL,MAAMgC,GAAN;UACD;QACF,CAjCI,CAAP;;;EAkCD,CAhDmB;;EAiDtB;AAAC,CApED;;AAAahC","names":["exports","CancelToken","axios_1","StellarTomlResolver","domain","opts","allowHttp","config_1","isAllowHttp","timeout","getTimeout","protocol","get","maxContentLength","cancelToken","cancel","undefined","then","response","tomlObject","toml_1","parse","data","Promise","resolve","e","reject","Error","line","column","message","catch","err","match"],"sourceRoot":"","sources":["../src/stellar_toml_resolver.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}