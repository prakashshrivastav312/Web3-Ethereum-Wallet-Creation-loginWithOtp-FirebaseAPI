{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AccountOnNetwork = exports.Account = void 0;\n\nconst address_1 = require(\"./address\");\n\nconst nonce_1 = require(\"./nonce\");\n\nconst balance_1 = require(\"./balance\");\n\nconst balanceBuilder_1 = require(\"./balanceBuilder\");\n/**\n * An abstraction representing an account (user or Smart Contract) on the Network.\n */\n\n\nclass Account {\n  /**\n   * Creates an account object from an address\n   */\n  constructor(address) {\n    /**\n     * The address of the account.\n     */\n    this.address = new address_1.Address();\n    /**\n     * The nonce of the account (the account sequence number).\n     */\n\n    this.nonce = new nonce_1.Nonce(0);\n    /**\n     * The balance of the account.\n     */\n\n    this.balance = balanceBuilder_1.Egld(\"0\");\n    this.asOnNetwork = new AccountOnNetwork();\n    this.address = address;\n  }\n  /**\n   * Queries the details of the account on the Network\n   * @param provider the Network provider\n   * @param cacheLocally whether to save the query response within the object, locally\n   */\n\n\n  getAsOnNetwork(provider) {\n    let cacheLocally = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    return __awaiter(this, void 0, void 0, function* () {\n      this.address.assertNotEmpty();\n      let response = yield provider.getAccount(this.address);\n\n      if (cacheLocally) {\n        this.asOnNetwork = response;\n      }\n\n      return response;\n    });\n  }\n  /**\n   * Gets a previously saved query response\n   */\n\n\n  getAsOnNetworkCached() {\n    return this.asOnNetwork;\n  }\n  /**\n   * Synchronizes account properties (such as nonce, balance) with the ones queried from the Network\n   * @param provider the Network provider\n   */\n\n\n  sync(provider) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.getAsOnNetwork(provider, true);\n      this.nonce = this.asOnNetwork.nonce;\n      this.balance = this.asOnNetwork.balance;\n    });\n  }\n  /**\n   * Increments (locally) the nonce (the account sequence number).\n   */\n\n\n  incrementNonce() {\n    this.nonce = this.nonce.increment();\n  }\n  /**\n   * Gets then increments (locally) the nonce (the account sequence number).\n   */\n\n\n  getNonceThenIncrement() {\n    let nonce = this.nonce;\n    this.nonce = this.nonce.increment();\n    return nonce;\n  }\n  /**\n   * Converts the account to a pretty, plain JavaScript object.\n   */\n\n\n  toJSON() {\n    return {\n      address: this.address.bech32(),\n      nonce: this.nonce.valueOf(),\n      balance: this.balance.toString()\n    };\n  }\n\n}\n\nexports.Account = Account;\n/**\n * A plain view of an account, as queried from the Network.\n */\n\nclass AccountOnNetwork {\n  constructor(init) {\n    this.address = new address_1.Address();\n    this.nonce = new nonce_1.Nonce(0);\n    this.balance = balanceBuilder_1.Egld(0);\n    this.code = \"\";\n    this.userName = \"\";\n    Object.assign(this, init);\n  }\n\n  static fromHttpResponse(payload) {\n    let result = new AccountOnNetwork();\n    result.address = new address_1.Address(payload[\"address\"] || 0);\n    result.nonce = new nonce_1.Nonce(payload[\"nonce\"] || 0);\n    result.balance = balance_1.Balance.fromString(payload[\"balance\"]);\n    result.code = payload[\"code\"];\n    result.userName = payload[\"username\"];\n    return result;\n  }\n\n}\n\nexports.AccountOnNetwork = AccountOnNetwork;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;AACA;;AACA;;AACA;AAEA;;;;;AAGA,MAAaA,OAAb,CAAoB;EAkBhB;;;EAGAC,YAAYC,OAAZ,EAA4B;IApB5B;;;IAGS,eAAmB,IAAIC,iBAAJ,EAAnB;IAET;;;;IAGA,aAAe,IAAIC,aAAJ,CAAU,CAAV,CAAf;IAEA;;;;IAGA,eAAmBC,sBAAK,GAAL,CAAnB;IAEQ,mBAAgC,IAAIC,gBAAJ,EAAhC;IAMJ,KAAKJ,OAAL,GAAeA,OAAf;EACH;EAED;;;;;;;EAKMK,cAAc,CAACC,QAAD,EAAkD;IAAA,IAA5BC,YAA4B,uEAAJ,IAAI;;MAClE,KAAKP,OAAL,CAAaQ,cAAb;MAEA,IAAIC,QAAQ,GAAG,MAAMH,QAAQ,CAACI,UAAT,CAAoB,KAAKV,OAAzB,CAArB;;MAEA,IAAIO,YAAJ,EAAkB;QACd,KAAKI,WAAL,GAAmBF,QAAnB;MACH;;MAED,OAAOA,QAAP;IACH;EAAA;EAED;;;;;EAGAG,oBAAoB;IAChB,OAAO,KAAKD,WAAZ;EACH;EAED;;;;;;EAIME,IAAI,CAACP,QAAD,EAAoB;;MAC1B,MAAM,KAAKD,cAAL,CAAoBC,QAApB,EAA8B,IAA9B,CAAN;MACA,KAAKQ,KAAL,GAAa,KAAKH,WAAL,CAAiBG,KAA9B;MACA,KAAKC,OAAL,GAAe,KAAKJ,WAAL,CAAiBI,OAAhC;IACH;EAAA;EAED;;;;;EAGAC,cAAc;IACV,KAAKF,KAAL,GAAa,KAAKA,KAAL,CAAWG,SAAX,EAAb;EACH;EAED;;;;;EAGAC,qBAAqB;IACjB,IAAIJ,KAAK,GAAG,KAAKA,KAAjB;IACA,KAAKA,KAAL,GAAa,KAAKA,KAAL,CAAWG,SAAX,EAAb;IACA,OAAOH,KAAP;EACH;EAED;;;;;EAGAK,MAAM;IACF,OAAO;MACHnB,OAAO,EAAE,KAAKA,OAAL,CAAaoB,MAAb,EADN;MAEHN,KAAK,EAAE,KAAKA,KAAL,CAAWO,OAAX,EAFJ;MAGHN,OAAO,EAAE,KAAKA,OAAL,CAAaO,QAAb;IAHN,CAAP;EAKH;;AApFe;;AAApBC;AAuFA;;;;AAGA,MAAanB,gBAAb,CAA6B;EAOzBL,YAAYyB,IAAZ,EAA4C;IAN5C,eAAmB,IAAIvB,iBAAJ,EAAnB;IACA,aAAe,IAAIC,aAAJ,CAAU,CAAV,CAAf;IACA,eAAmBC,sBAAK,CAAL,CAAnB;IACA,YAAe,EAAf;IACA,gBAAmB,EAAnB;IAGIsB,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoBF,IAApB;EACH;;EAEsB,OAAhBG,gBAAgB,CAACC,OAAD,EAAa;IAChC,IAAIC,MAAM,GAAG,IAAIzB,gBAAJ,EAAb;IAEAyB,MAAM,CAAC7B,OAAP,GAAiB,IAAIC,iBAAJ,CAAY2B,OAAO,CAAC,SAAD,CAAP,IAAsB,CAAlC,CAAjB;IACAC,MAAM,CAACf,KAAP,GAAe,IAAIZ,aAAJ,CAAU0B,OAAO,CAAC,OAAD,CAAP,IAAoB,CAA9B,CAAf;IACAC,MAAM,CAACd,OAAP,GAAiBe,kBAAQC,UAAR,CAAmBH,OAAO,CAAC,SAAD,CAA1B,CAAjB;IACAC,MAAM,CAACG,IAAP,GAAcJ,OAAO,CAAC,MAAD,CAArB;IACAC,MAAM,CAACI,QAAP,GAAkBL,OAAO,CAAC,UAAD,CAAzB;IAEA,OAAOC,MAAP;EACH;;AArBwB;;AAA7BN","names":["Account","constructor","address","address_1","nonce_1","balanceBuilder_1","AccountOnNetwork","getAsOnNetwork","provider","cacheLocally","assertNotEmpty","response","getAccount","asOnNetwork","getAsOnNetworkCached","sync","nonce","balance","incrementNonce","increment","getNonceThenIncrement","toJSON","bech32","valueOf","toString","exports","init","Object","assign","fromHttpResponse","payload","result","balance_1","fromString","code","userName"],"sourceRoot":"","sources":["../src/account.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}