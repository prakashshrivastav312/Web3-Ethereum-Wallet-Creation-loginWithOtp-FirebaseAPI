{"ast":null,"code":"import n from \"queue-microtask\";\n\nfunction t() {\n  return (t = Object.assign || function (n) {\n    for (var t = 1; t < arguments.length; t++) {\n      var e = arguments[t];\n\n      for (var r in e) Object.prototype.hasOwnProperty.call(e, r) && (n[r] = e[r]);\n    }\n\n    return n;\n  }).apply(this, arguments);\n}\n\nfunction e(n, t) {\n  (null == t || t > n.length) && (t = n.length);\n\n  for (var e = 0, r = new Array(t); e < t; e++) r[e] = n[e];\n\n  return r;\n}\n\nfunction r(n, t, e) {\n  if (!n.s) {\n    if (e instanceof o) {\n      if (!e.s) return void (e.o = r.bind(null, n, t));\n      1 & t && (t = e.s), e = e.v;\n    }\n\n    if (e && e.then) return void e.then(r.bind(null, n, t), r.bind(null, n, 2));\n    n.s = t, n.v = e;\n    var i = n.o;\n    i && i(n);\n  }\n}\n\nvar o = function () {\n  function n() {}\n\n  return n.prototype.then = function (t, e) {\n    var o = new n(),\n        i = this.s;\n\n    if (i) {\n      var u = 1 & i ? t : e;\n\n      if (u) {\n        try {\n          r(o, 1, u(this.v));\n        } catch (n) {\n          r(o, 2, n);\n        }\n\n        return o;\n      }\n\n      return this;\n    }\n\n    return this.o = function (n) {\n      try {\n        var i = n.v;\n        1 & n.s ? r(o, 1, t ? t(i) : i) : e ? r(o, 1, e(i)) : r(o, 2, i);\n      } catch (n) {\n        r(o, 2, n);\n      }\n    }, o;\n  }, n;\n}();\n\nfunction i(n) {\n  return n instanceof o && 1 & n.s;\n}\n\nfunction u(n, t, e) {\n  for (var u;;) {\n    var c = n();\n    if (i(c) && (c = c.v), !c) return f;\n\n    if (c.then) {\n      u = 0;\n      break;\n    }\n\n    var f = e();\n\n    if (f && f.then) {\n      if (!i(f)) {\n        u = 1;\n        break;\n      }\n\n      f = f.s;\n    }\n\n    if (t) {\n      var s = t();\n\n      if (s && s.then && !i(s)) {\n        u = 2;\n        break;\n      }\n    }\n  }\n\n  var a = new o(),\n      l = r.bind(null, a, 2);\n  return (0 === u ? c.then(h) : 1 === u ? f.then(v) : s.then(d)).then(void 0, l), a;\n\n  function v(o) {\n    f = o;\n\n    do {\n      if (t && (s = t()) && s.then && !i(s)) return void s.then(d).then(void 0, l);\n      if (!(c = n()) || i(c) && !c.v) return void r(a, 1, f);\n      if (c.then) return void c.then(h).then(void 0, l);\n      i(f = e()) && (f = f.v);\n    } while (!f || !f.then);\n\n    f.then(v).then(void 0, l);\n  }\n\n  function h(n) {\n    n ? (f = e()) && f.then ? f.then(v).then(void 0, l) : v(f) : r(a, 1, f);\n  }\n\n  function d() {\n    (c = n()) ? c.then ? c.then(h).then(void 0, l) : h(c) : r(a, 1, f);\n  }\n}\n\nvar c = \"INIT\",\n    f = \"SUBSCRIBE\",\n    s = \"UNSUBSCRIBE\",\n    a = \"UPDATED\",\n    l = \"SNAPSHOT\",\n    v = \"EXIT\",\n    h = \"TERMINATE\",\n    d = \"object\" == typeof self && self.self === self && self || \"object\" == typeof global && global.global === global && global || \"object\" == typeof window && window.window === window && window;\nd.FCL_REGISTRY = null == d.FCL_REGISTRY ? {} : d.FCL_REGISTRY;\n\nvar R = 0,\n    b = function (n, t, e, r) {\n  return void 0 === r && (r = {}), new Promise(function (o, i) {\n    var u = r.expectReply || !1,\n        c = null != r.timeout ? r.timeout : 5e3;\n    u && c && setTimeout(function () {\n      return i(new Error(\"Timeout: \" + c + \"ms passed without a response.\"));\n    }, c);\n    var f = {\n      to: n,\n      from: r.from,\n      tag: t,\n      data: e,\n      timeout: c,\n      reply: o,\n      reject: i\n    };\n\n    try {\n      d.FCL_REGISTRY[n].mailbox.deliver(f), u || o(!0);\n    } catch (n) {\n      console.error(\"FCL.Actor -- Could Not Deliver Message\", f, n);\n    }\n  });\n},\n    S = function (n) {\n  delete d.FCL_REGISTRY[n];\n},\n    m = function (r, o) {\n  if (void 0 === o && (o = null), null == o && (o = ++R), null != d.FCL_REGISTRY[o]) return o;\n  var i, c;\n  d.FCL_REGISTRY[o] = {\n    addr: o,\n    mailbox: (c = [], {\n      deliver: function (n) {\n        try {\n          return c.push(n), i && (i(c.shift()), i = void 0), Promise.resolve();\n        } catch (n) {\n          return Promise.reject(n);\n        }\n      },\n      receive: function () {\n        return new Promise(function (n) {\n          var t = c.shift();\n          if (t) return n(t);\n          i = n;\n        });\n      }\n    }),\n    subs: new Set(),\n    kvs: {}\n  };\n  var f,\n      s = {\n    self: function () {\n      return o;\n    },\n    receive: function () {\n      return d.FCL_REGISTRY[o].mailbox.receive();\n    },\n    send: function (n, t, e, r) {\n      return void 0 === r && (r = {}), r.from = o, b(n, t, e, r);\n    },\n    sendSelf: function (n, t, e) {\n      d.FCL_REGISTRY[o] && b(o, n, t, e);\n    },\n    broadcast: function (n, t, r) {\n      void 0 === r && (r = {}), r.from = o;\n\n      for (var i, u = function (n, t) {\n        var r;\n\n        if (\"undefined\" == typeof Symbol || null == n[Symbol.iterator]) {\n          if (Array.isArray(n) || (r = function (n, t) {\n            if (n) {\n              if (\"string\" == typeof n) return e(n, void 0);\n              var r = Object.prototype.toString.call(n).slice(8, -1);\n              return \"Object\" === r && n.constructor && (r = n.constructor.name), \"Map\" === r || \"Set\" === r ? Array.from(n) : \"Arguments\" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r) ? e(n, void 0) : void 0;\n            }\n          }(n))) {\n            r && (n = r);\n            var o = 0;\n            return function () {\n              return o >= n.length ? {\n                done: !0\n              } : {\n                done: !1,\n                value: n[o++]\n              };\n            };\n          }\n\n          throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n        }\n\n        return (r = n[Symbol.iterator]()).next.bind(r);\n      }(d.FCL_REGISTRY[o].subs); !(i = u()).done;) b(i.value, n, t, r);\n    },\n    subscribe: function (n) {\n      return null != n && d.FCL_REGISTRY[o].subs.add(n);\n    },\n    unsubscribe: function (n) {\n      return null != n && d.FCL_REGISTRY[o].subs.delete(n);\n    },\n    subscriberCount: function () {\n      return d.FCL_REGISTRY[o].subs.size;\n    },\n    hasSubs: function () {\n      return !!d.FCL_REGISTRY[o].subs.size;\n    },\n    put: function (n, t) {\n      null != n && (d.FCL_REGISTRY[o].kvs[n] = t);\n    },\n    get: function (n, t) {\n      var e = d.FCL_REGISTRY[o].kvs[n];\n      return null == e ? t : e;\n    },\n    delete: function (n) {\n      delete d.FCL_REGISTRY[o].kvs[n];\n    },\n    update: function (n, t) {\n      null != n && (d.FCL_REGISTRY[o].kvs[n] = t(d.FCL_REGISTRY[o].kvs[n]));\n    },\n    keys: function () {\n      return Object.keys(d.FCL_REGISTRY[o].kvs);\n    },\n    all: function () {\n      return d.FCL_REGISTRY[o].kvs;\n    },\n    where: function (n) {\n      return Object.keys(d.FCL_REGISTRY[o].kvs).reduce(function (e, r) {\n        var i;\n        return n.test(r) ? t({}, e, ((i = {})[r] = d.FCL_REGISTRY[o].kvs[r], i)) : e;\n      }, {});\n    },\n    merge: function (n) {\n      void 0 === n && (n = {}), Object.keys(n).forEach(function (t) {\n        return d.FCL_REGISTRY[o].kvs[t] = n[t];\n      });\n    }\n  };\n  return \"object\" == typeof r && (void 0 === (f = r) && (f = {}), r = function (n) {\n    try {\n      var t = function () {\n        var t = u(function () {\n          return 1;\n        }, void 0, function () {\n          return Promise.resolve(n.receive()).then(function (t) {\n            var e = function (e, r) {\n              try {\n                var o = function (e, r) {\n                  try {\n                    var o = function () {\n                      function e() {\n                        return Promise.resolve(f[t.tag](n, t, t.data || {})).then(function () {});\n                      }\n\n                      var r = function () {\n                        if (\"EXIT\" === t.tag) {\n                          var e = function () {\n                            if (\"function\" == typeof f.TERMINATE) return Promise.resolve(f.TERMINATE(n, t, t.data || {})).then(function () {});\n                          }();\n\n                          if (e && e.then) return e.then(function () {});\n                        }\n                      }();\n\n                      return r && r.then ? r.then(e) : e();\n                    }();\n                  } catch (n) {\n                    return r(n);\n                  }\n\n                  return o && o.then ? o.then(void 0, r) : o;\n                }(0, function (e) {\n                  console.error(n.self() + \" Error\", t, e);\n                });\n              } catch (n) {\n                return;\n              }\n\n              return o && o.then ? o.then(r.bind(null, !1), r.bind(null, !0)) : void 0;\n            }(0, function (n, t) {});\n\n            if (e && e.then) return e.then(function () {});\n          });\n        });\n        return t && t.then ? t.then(function () {}) : void 0;\n      },\n          e = function () {\n        if (\"function\" == typeof f.INIT) return Promise.resolve(f.INIT(n)).then(function () {});\n      }();\n\n      return Promise.resolve(e && e.then ? e.then(t) : t());\n    } catch (n) {\n      return Promise.reject(n);\n    }\n  }), n(function () {\n    try {\n      return Promise.resolve(r(s)).then(function () {\n        S(o);\n      });\n    } catch (n) {\n      return Promise.reject(n);\n    }\n  }), o;\n};\n\nfunction I(n, t, e) {\n  t(n);\n  var r = m(function (t) {\n    try {\n      var r;\n      return t.send(n, \"SUBSCRIBE\"), Promise.resolve(u(function () {\n        return !r && 1;\n      }, void 0, function () {\n        return Promise.resolve(t.receive()).then(function (o) {\n          if (\"@EXIT\" === o.tag) return t.send(n, \"UNSUBSCRIBE\"), void (r = 1);\n          e(o.data);\n        });\n      }));\n    } catch (n) {\n      return Promise.reject(n);\n    }\n  });\n  return function () {\n    return b(r, \"@EXIT\");\n  };\n}\n\nfunction E(n, t) {\n  return t(n), b(n, \"SNAPSHOT\", null, {\n    expectReply: !0,\n    timeout: 0\n  });\n}\n\nexport { v as EXIT, c as INIT, l as SNAPSHOT, f as SUBSCRIBE, h as TERMINATE, s as UNSUBSCRIBE, a as UPDATED, S as kill, b as send, E as snapshoter, m as spawn, I as subscriber };","map":{"version":3,"mappings":"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","names":["pact","state","value","s","o","_settle","bind","v","then","observer","_Pact","prototype","onFulfilled","onRejected","result","this","callback","e","_this","thenable","test","update","body","stage","shouldContinue","_isSettledPact","updateValue","reject","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","INIT","SUBSCRIBE","UNSUBSCRIBE","UPDATED","SNAPSHOT","EXIT","TERMINATE","root","self","global","window","FCL_REGISTRY","pid","send","addr","tag","data","opts","Promise","reply","expectReply","timeout","setTimeout","Error","payload","to","from","mailbox","deliver","error","console","kill","spawn","fn","next","queue","msg","push","shift","undefined","receive","resolve","subs","Set","kvs","handlers","ctx","sendSelf","broadcast","r","done","subscribe","sub","add","unsubscribe","subscriberCount","size","hasSubs","put","key","get","fallback","delete","keys","Object","all","where","reduce","acc","pattern","merge","forEach","letter","finalizer","recover","queueMicrotask","subscriber","address","spawnFn","_exit2","snapshoter"],"sources":["../src/index.js","../src/mailbox/index.js"],"sourcesContent":["import {mailbox as createMailbox} from \"./mailbox\"\nimport queueMicrotask from \"queue-microtask\"\n\nexport const INIT = \"INIT\"\nexport const SUBSCRIBE = \"SUBSCRIBE\"\nexport const UNSUBSCRIBE = \"UNSUBSCRIBE\"\nexport const UPDATED = \"UPDATED\"\nexport const SNAPSHOT = \"SNAPSHOT\"\nexport const EXIT = \"EXIT\"\nexport const TERMINATE = \"TERMINATE\"\n\nconst root =\n  (typeof self === \"object\" && self.self === self && self) ||\n  (typeof global === \"object\" && global.global === global && global) ||\n  (typeof window === \"object\" && window.window === window && window)\n\nroot.FCL_REGISTRY = root.FCL_REGISTRY == null ? {} : root.FCL_REGISTRY\nvar pid = 0b0\n\nconst DEFAULT_TIMEOUT = 5000\nconst DEFAULT_TAG = \"---\"\nexport const send = (addr, tag, data, opts = {}) =>\n  new Promise((reply, reject) => {\n    const expectReply = opts.expectReply || false\n    const timeout = opts.timeout != null ? opts.timeout : DEFAULT_TIMEOUT\n\n    if (expectReply && timeout) {\n      setTimeout(\n        () =>\n          reject(new Error(`Timeout: ${timeout}ms passed without a response.`)),\n        timeout\n      )\n    }\n\n    const payload = {\n      to: addr,\n      from: opts.from,\n      tag,\n      data,\n      timeout,\n      reply,\n      reject,\n    }\n\n    try {\n      root.FCL_REGISTRY[addr].mailbox.deliver(payload)\n      if (!expectReply) reply(true)\n    } catch (error) {\n      console.error(\"FCL.Actor -- Could Not Deliver Message\", payload, error)\n    }\n  })\n\nexport const kill = addr => {\n  delete root.FCL_REGISTRY[addr]\n}\n\nconst fromHandlers = (handlers = {}) => async ctx => {\n  if (typeof handlers[INIT] === \"function\") await handlers[INIT](ctx)\n  __loop: while (1) {\n    const letter = await ctx.receive()\n    try {\n      if (letter.tag === EXIT) {\n        if (typeof handlers[TERMINATE] === \"function\") {\n          await handlers[TERMINATE](ctx, letter, letter.data || {})\n        }\n        break __loop\n      }\n      await handlers[letter.tag](ctx, letter, letter.data || {})\n    } catch (error) {\n      console.error(`${ctx.self()} Error`, letter, error)\n    } finally {\n      continue __loop\n    }\n  }\n}\n\nexport const spawn = (fn, addr = null) => {\n  if (addr == null) addr = ++pid\n  if (root.FCL_REGISTRY[addr] != null) return addr\n\n  root.FCL_REGISTRY[addr] = {\n    addr,\n    mailbox: createMailbox(),\n    subs: new Set(),\n    kvs: {},\n  }\n\n  const ctx = {\n    self: () => addr,\n    receive: () => root.FCL_REGISTRY[addr].mailbox.receive(),\n    send: (to, tag, data, opts = {}) => {\n      opts.from = addr\n      return send(to, tag, data, opts)\n    },\n    sendSelf: (tag, data, opts) => {\n      if (root.FCL_REGISTRY[addr]) send(addr, tag, data, opts)\n    },\n    broadcast: (tag, data, opts = {}) => {\n      opts.from = addr\n      for (let to of root.FCL_REGISTRY[addr].subs) send(to, tag, data, opts)\n    },\n    subscribe: sub => sub != null && root.FCL_REGISTRY[addr].subs.add(sub),\n    unsubscribe: sub => sub != null && root.FCL_REGISTRY[addr].subs.delete(sub),\n    subscriberCount: () => root.FCL_REGISTRY[addr].subs.size,\n    hasSubs: () => !!root.FCL_REGISTRY[addr].subs.size,\n    put: (key, value) => {\n      if (key != null) root.FCL_REGISTRY[addr].kvs[key] = value\n    },\n    get: (key, fallback) => {\n      const value = root.FCL_REGISTRY[addr].kvs[key]\n      return value == null ? fallback : value\n    },\n    delete: key => {\n      delete root.FCL_REGISTRY[addr].kvs[key]\n    },\n    update: (key, fn) => {\n      if (key != null)\n        root.FCL_REGISTRY[addr].kvs[key] = fn(root.FCL_REGISTRY[addr].kvs[key])\n    },\n    keys: () => {\n      return Object.keys(root.FCL_REGISTRY[addr].kvs)\n    },\n    all: () => {\n      return root.FCL_REGISTRY[addr].kvs\n    },\n    where: pattern => {\n      return Object.keys(root.FCL_REGISTRY[addr].kvs).reduce((acc, key) => {\n        return pattern.test(key)\n          ? {...acc, [key]: root.FCL_REGISTRY[addr].kvs[key]}\n          : acc\n      }, {})\n    },\n    merge: (data = {}) => {\n      Object.keys(data).forEach(\n        key => (root.FCL_REGISTRY[addr].kvs[key] = data[key])\n      )\n    },\n  }\n\n  if (typeof fn === \"object\") fn = fromHandlers(fn)\n\n  queueMicrotask(async () => {\n    await fn(ctx)\n    kill(addr)\n  })\n\n  return addr\n}\n\n// Returns an unsubscribe function\n// A SUBSCRIBE handler will need to be created to handle the subscription event\n//\n//  [SUBSCRIBE]: (ctx, letter) => {\n//    ctx.subscribe(letter.from)\n//    ctx.send(letter.from, UPDATED, ctx.all())\n//  }\n//\nexport function subscriber(address, spawnFn, callback) {\n  spawnFn(address)\n  const EXIT = \"@EXIT\"\n  const self = spawn(async ctx => {\n    ctx.send(address, SUBSCRIBE)\n    while (1) {\n      const letter = await ctx.receive()\n      if (letter.tag === EXIT) {\n        ctx.send(address, UNSUBSCRIBE)\n        return\n      }\n      callback(letter.data)\n    }\n  })\n  return () => send(self, EXIT)\n}\n\n// Returns a promise that returns a result\n// A SNAPSHOT handler will need to be created to handle the snapshot event\n//\n//  [SNAPSHOT]: (ctx, letter) => {\n//    letter.reply(ctx.all())\n//  }\n//\nexport function snapshoter(address, spawnFn) {\n  spawnFn(address)\n  return send(address, SNAPSHOT, null, {expectReply: true, timeout: 0})\n}\n","export const mailbox = () => {\n  const queue = []\n  var next\n\n  return {\n    async deliver(msg) {\n      queue.push(msg)\n      if (next) {\n        next(queue.shift())\n        next = undefined\n      }\n    },\n\n    receive() {\n      return new Promise(function innerReceive(resolve) {\n        const msg = queue.shift()\n        if (msg) return resolve(msg)\n        next = resolve\n      })\n    },\n  }\n}\n"]},"metadata":{},"sourceType":"module"}