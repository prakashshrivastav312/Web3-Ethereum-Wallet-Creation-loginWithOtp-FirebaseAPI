{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getFee = exports.getServerInfo = void 0;\n\nconst utils_1 = require(\"./utils\");\n\nconst bignumber_js_1 = __importDefault(require(\"bignumber.js\"));\n\nfunction renameKeys(object, mapping) {\n  Object.entries(mapping).forEach(entry => {\n    const [from, to] = entry;\n    object[to] = object[from];\n    delete object[from];\n  });\n}\n\nfunction getServerInfo() {\n  return this.request('server_info').then(response => {\n    const info = utils_1.convertKeysFromSnakeCaseToCamelCase(response.info);\n    renameKeys(info, {\n      hostid: 'hostID'\n    });\n\n    if (info.validatedLedger) {\n      renameKeys(info.validatedLedger, {\n        baseFeeXrp: 'baseFeeXRP',\n        reserveBaseXrp: 'reserveBaseXRP',\n        reserveIncXrp: 'reserveIncrementXRP',\n        seq: 'ledgerVersion'\n      });\n      info.validatedLedger.baseFeeXRP = info.validatedLedger.baseFeeXRP.toString();\n      info.validatedLedger.reserveBaseXRP = info.validatedLedger.reserveBaseXRP.toString();\n      info.validatedLedger.reserveIncrementXRP = info.validatedLedger.reserveIncrementXRP.toString();\n    }\n\n    return info;\n  });\n}\n\nexports.getServerInfo = getServerInfo;\n\nfunction getFee(cushion) {\n  return __awaiter(this, void 0, void 0, function* () {\n    if (cushion == null) {\n      cushion = this._feeCushion;\n    }\n\n    if (cushion == null) {\n      cushion = 1.2;\n    }\n\n    const serverInfo = (yield this.request('server_info')).info;\n    const baseFeeXrp = new bignumber_js_1.default(serverInfo.validated_ledger.base_fee_xrp);\n\n    if (serverInfo.load_factor == null) {\n      serverInfo.load_factor = 1;\n    }\n\n    let fee = baseFeeXrp.times(serverInfo.load_factor).times(cushion);\n    fee = bignumber_js_1.default.min(fee, this._maxFeeXRP);\n    return new bignumber_js_1.default(fee.toFixed(6)).toString(10);\n  });\n}\n\nexports.getFee = getFee;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;AACA;;AAiCA,SAASA,UAAT,CAAoBC,MAApB,EAAiDC,OAAjD,EAA6E;EAC3EC,MAAM,CAACC,OAAP,CAAeF,OAAf,EAAwBG,OAAxB,CAAgCC,KAAK,IAAG;IACtC,MAAM,CAACC,IAAD,EAAOC,EAAP,IAAaF,KAAnB;IACAL,MAAM,CAACO,EAAD,CAAN,GAAaP,MAAM,CAACM,IAAD,CAAnB;IACA,OAAON,MAAM,CAACM,IAAD,CAAb;EACD,CAJD;AAKD;;AAED,SAASE,aAAT,GAAsB;EACpB,OAAO,KAAKC,OAAL,CAAa,aAAb,EAA4BC,IAA5B,CAAkCC,QAAD,IAAa;IACnD,MAAMC,IAAI,GAAGC,4CAAoCF,QAAQ,CAACC,IAA7C,CAAb;IACAb,UAAU,CAACa,IAAD,EAAO;MAACE,MAAM,EAAE;IAAT,CAAP,CAAV;;IACA,IAAIF,IAAI,CAACG,eAAT,EAA0B;MACxBhB,UAAU,CAACa,IAAI,CAACG,eAAN,EAAuB;QAC/BC,UAAU,EAAE,YADmB;QAE/BC,cAAc,EAAE,gBAFe;QAG/BC,aAAa,EAAE,qBAHgB;QAI/BC,GAAG,EAAE;MAJ0B,CAAvB,CAAV;MAMAP,IAAI,CAACG,eAAL,CAAqBK,UAArB,GAAkCR,IAAI,CAACG,eAAL,CAAqBK,UAArB,CAAgCC,QAAhC,EAAlC;MACAT,IAAI,CAACG,eAAL,CAAqBO,cAArB,GAAsCV,IAAI,CAACG,eAAL,CAAqBO,cAArB,CAAoCD,QAApC,EAAtC;MACAT,IAAI,CAACG,eAAL,CAAqBQ,mBAArB,GAA2CX,IAAI,CAACG,eAAL,CAAqBQ,mBAArB,CAAyCF,QAAzC,EAA3C;IACD;;IACD,OAAOT,IAAP;EACD,CAfM,CAAP;AAgBD;;AA0BOY;;AAtBR,SAAeC,MAAf,CAAuCC,OAAvC,EAAuD;;IACrD,IAAIA,OAAO,IAAI,IAAf,EAAqB;MACnBA,OAAO,GAAG,KAAKC,WAAf;IACD;;IACD,IAAID,OAAO,IAAI,IAAf,EAAqB;MACnBA,OAAO,GAAG,GAAV;IACD;;IAED,MAAME,UAAU,GAAG,CAAC,MAAM,KAAKnB,OAAL,CAAa,aAAb,CAAP,EAAoCG,IAAvD;IACA,MAAMI,UAAU,GAAG,IAAIa,sBAAJ,CAAcD,UAAU,CAACE,gBAAX,CAA4BC,YAA1C,CAAnB;;IACA,IAAIH,UAAU,CAACI,WAAX,IAA0B,IAA9B,EAAoC;MAElCJ,UAAU,CAACI,WAAX,GAAyB,CAAzB;IACD;;IACD,IAAIC,GAAG,GAAGjB,UAAU,CAACkB,KAAX,CAAiBN,UAAU,CAACI,WAA5B,EAAyCE,KAAzC,CAA+CR,OAA/C,CAAV;IAGAO,GAAG,GAAGJ,uBAAUM,GAAV,CAAcF,GAAd,EAAmB,KAAKG,UAAxB,CAAN;IAEA,OAAO,IAAIP,sBAAJ,CAAcI,GAAG,CAACI,OAAJ,CAAY,CAAZ,CAAd,EAA8BhB,QAA9B,CAAuC,EAAvC,CAAP;EACD;AAAA;;AAEsBG","names":["renameKeys","object","mapping","Object","entries","forEach","entry","from","to","getServerInfo","request","then","response","info","utils_1","hostid","validatedLedger","baseFeeXrp","reserveBaseXrp","reserveIncXrp","seq","baseFeeXRP","toString","reserveBaseXRP","reserveIncrementXRP","exports","getFee","cushion","_feeCushion","serverInfo","bignumber_js_1","validated_ledger","base_fee_xrp","load_factor","fee","times","min","_maxFeeXRP","toFixed"],"sourceRoot":"","sources":["../../../src/common/serverinfo.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}