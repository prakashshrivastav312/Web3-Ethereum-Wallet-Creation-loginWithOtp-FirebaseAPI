{"ast":null,"code":"'use strict';\n\nvar _ = require('lodash');\n\nvar BN = require('../crypto/bn');\n\nvar buffer = require('buffer');\n\nvar bufferUtil = require('../util/buffer');\n\nvar JSUtil = require('../util/js');\n\nvar BufferWriter = require('../encoding/bufferwriter');\n\nvar Script = require('../script');\n\nvar $ = require('../util/preconditions');\n\nvar errors = require('../errors');\n\nvar MAX_SAFE_INTEGER = 0x1fffffffffffff;\n\nfunction Output(args) {\n  if (!(this instanceof Output)) {\n    return new Output(args);\n  }\n\n  if (_.isObject(args)) {\n    this.satoshis = args.satoshis;\n\n    if (bufferUtil.isBuffer(args.script)) {\n      this._scriptBuffer = args.script;\n    } else {\n      var script;\n\n      if (_.isString(args.script) && JSUtil.isHexa(args.script)) {\n        script = Buffer.from(args.script, 'hex');\n      } else {\n        script = args.script;\n      }\n\n      this.setScript(script);\n    }\n  } else {\n    throw new TypeError('Unrecognized argument for Output');\n  }\n}\n\nObject.defineProperty(Output.prototype, 'script', {\n  configurable: false,\n  enumerable: true,\n  get: function () {\n    if (this._script) {\n      return this._script;\n    } else {\n      this.setScriptFromBuffer(this._scriptBuffer);\n      return this._script;\n    }\n  }\n});\nObject.defineProperty(Output.prototype, 'satoshis', {\n  configurable: false,\n  enumerable: true,\n  get: function () {\n    return this._satoshis;\n  },\n  set: function (num) {\n    if (num instanceof BN) {\n      this._satoshisBN = num;\n      this._satoshis = num.toNumber();\n    } else if (_.isString(num)) {\n      this._satoshis = parseInt(num);\n      this._satoshisBN = BN.fromNumber(this._satoshis);\n    } else {\n      $.checkArgument(JSUtil.isNaturalNumber(num), 'Output satoshis is not a natural number');\n      this._satoshisBN = BN.fromNumber(num);\n      this._satoshis = num;\n    }\n\n    $.checkState(JSUtil.isNaturalNumber(this._satoshis), 'Output satoshis is not a natural number');\n  }\n});\n\nOutput.prototype.invalidSatoshis = function () {\n  if (this._satoshis > MAX_SAFE_INTEGER) {\n    return 'transaction txout satoshis greater than max safe integer';\n  }\n\n  if (this._satoshis !== this._satoshisBN.toNumber()) {\n    return 'transaction txout satoshis has corrupted value';\n  }\n\n  if (this._satoshis < 0) {\n    return 'transaction txout negative';\n  }\n\n  return false;\n};\n\nOutput.prototype.toObject = Output.prototype.toJSON = function toObject() {\n  var obj = {\n    satoshis: this.satoshis\n  };\n  obj.script = this._scriptBuffer.toString('hex');\n  return obj;\n};\n\nOutput.fromObject = function (data) {\n  return new Output(data);\n};\n\nOutput.prototype.setScriptFromBuffer = function (buffer) {\n  this._scriptBuffer = buffer;\n\n  try {\n    this._script = Script.fromBuffer(this._scriptBuffer);\n    this._script._isOutput = true;\n  } catch (e) {\n    if (e instanceof errors.Script.InvalidBuffer) {\n      this._script = null;\n    } else {\n      throw e;\n    }\n  }\n};\n\nOutput.prototype.setScript = function (script) {\n  if (script instanceof Script) {\n    this._scriptBuffer = script.toBuffer();\n    this._script = script;\n    this._script._isOutput = true;\n  } else if (_.isString(script)) {\n    this._script = Script.fromString(script);\n    this._scriptBuffer = this._script.toBuffer();\n    this._script._isOutput = true;\n  } else if (bufferUtil.isBuffer(script)) {\n    this.setScriptFromBuffer(script);\n  } else {\n    throw new TypeError('Invalid argument type: script');\n  }\n\n  return this;\n};\n\nOutput.prototype.inspect = function () {\n  var scriptStr;\n\n  if (this.script) {\n    scriptStr = this.script.inspect();\n  } else {\n    scriptStr = this._scriptBuffer.toString('hex');\n  }\n\n  return '<Output (' + this.satoshis + ' sats) ' + scriptStr + '>';\n};\n\nOutput.fromBufferReader = function (br) {\n  var obj = {};\n  obj.satoshis = br.readUInt64LEBN();\n  var size = br.readVarintNum();\n\n  if (size !== 0) {\n    obj.script = br.read(size);\n  } else {\n    obj.script = Buffer.from([]);\n  }\n\n  return new Output(obj);\n};\n\nOutput.prototype.toBufferWriter = function (writer) {\n  if (!writer) {\n    writer = new BufferWriter();\n  }\n\n  writer.writeUInt64LEBN(this._satoshisBN);\n  var script = this._scriptBuffer;\n  writer.writeVarintNum(script.length);\n  writer.write(script);\n  return writer;\n};\n\nmodule.exports = Output;","map":{"version":3,"names":["_","require","BN","buffer","bufferUtil","JSUtil","BufferWriter","Script","$","errors","MAX_SAFE_INTEGER","Output","args","isObject","satoshis","isBuffer","script","_scriptBuffer","isString","isHexa","Buffer","from","setScript","TypeError","Object","defineProperty","prototype","configurable","enumerable","get","_script","setScriptFromBuffer","_satoshis","set","num","_satoshisBN","toNumber","parseInt","fromNumber","checkArgument","isNaturalNumber","checkState","invalidSatoshis","toObject","toJSON","obj","toString","fromObject","data","fromBuffer","_isOutput","e","InvalidBuffer","toBuffer","fromString","inspect","scriptStr","fromBufferReader","br","readUInt64LEBN","size","readVarintNum","read","toBufferWriter","writer","writeUInt64LEBN","writeVarintNum","length","write","module","exports"],"sources":["C:/Users/acer/node_modules/bitcore-lib/lib/transaction/output.js"],"sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar BN = require('../crypto/bn');\nvar buffer = require('buffer');\nvar bufferUtil = require('../util/buffer');\nvar JSUtil = require('../util/js');\nvar BufferWriter = require('../encoding/bufferwriter');\nvar Script = require('../script');\nvar $ = require('../util/preconditions');\nvar errors = require('../errors');\n\nvar MAX_SAFE_INTEGER = 0x1fffffffffffff;\n\nfunction Output(args) {\n  if (!(this instanceof Output)) {\n    return new Output(args);\n  }\n  if (_.isObject(args)) {\n    this.satoshis = args.satoshis;\n    if (bufferUtil.isBuffer(args.script)) {\n      this._scriptBuffer = args.script;\n    } else {\n      var script;\n      if (_.isString(args.script) && JSUtil.isHexa(args.script)) {\n        script = Buffer.from(args.script, 'hex');\n      } else {\n        script = args.script;\n      }\n      this.setScript(script);\n    }\n  } else {\n    throw new TypeError('Unrecognized argument for Output');\n  }\n}\n\nObject.defineProperty(Output.prototype, 'script', {\n  configurable: false,\n  enumerable: true,\n  get: function() {\n    if (this._script) {\n      return this._script;\n    } else {\n      this.setScriptFromBuffer(this._scriptBuffer);\n      return this._script;\n    }\n\n  }\n});\n\nObject.defineProperty(Output.prototype, 'satoshis', {\n  configurable: false,\n  enumerable: true,\n  get: function() {\n    return this._satoshis;\n  },\n  set: function(num) {\n    if (num instanceof BN) {\n      this._satoshisBN = num;\n      this._satoshis = num.toNumber();\n    } else if (_.isString(num)) {\n      this._satoshis = parseInt(num);\n      this._satoshisBN = BN.fromNumber(this._satoshis);\n    } else {\n      $.checkArgument(\n        JSUtil.isNaturalNumber(num),\n        'Output satoshis is not a natural number'\n      );\n      this._satoshisBN = BN.fromNumber(num);\n      this._satoshis = num;\n    }\n    $.checkState(\n      JSUtil.isNaturalNumber(this._satoshis),\n      'Output satoshis is not a natural number'\n    );\n  }\n});\n\nOutput.prototype.invalidSatoshis = function() {\n  if (this._satoshis > MAX_SAFE_INTEGER) {\n    return 'transaction txout satoshis greater than max safe integer';\n  }\n  if (this._satoshis !== this._satoshisBN.toNumber()) {\n    return 'transaction txout satoshis has corrupted value';\n  }\n  if (this._satoshis < 0) {\n    return 'transaction txout negative';\n  }\n  return false;\n};\n\nOutput.prototype.toObject = Output.prototype.toJSON = function toObject() {\n  var obj = {\n    satoshis: this.satoshis\n  };\n  obj.script = this._scriptBuffer.toString('hex');\n  return obj;\n};\n\nOutput.fromObject = function(data) {\n  return new Output(data);\n};\n\nOutput.prototype.setScriptFromBuffer = function(buffer) {\n  this._scriptBuffer = buffer;\n  try {\n    this._script = Script.fromBuffer(this._scriptBuffer);\n    this._script._isOutput = true;\n  } catch(e) {\n    if (e instanceof errors.Script.InvalidBuffer) {\n      this._script = null;\n    } else {\n      throw e;\n    }\n  }\n};\n\nOutput.prototype.setScript = function(script) {\n  if (script instanceof Script) {\n    this._scriptBuffer = script.toBuffer();\n    this._script = script;\n    this._script._isOutput = true;\n  } else if (_.isString(script)) {\n    this._script = Script.fromString(script);\n    this._scriptBuffer = this._script.toBuffer();\n    this._script._isOutput = true;\n  } else if (bufferUtil.isBuffer(script)) {\n    this.setScriptFromBuffer(script);\n  } else {\n    throw new TypeError('Invalid argument type: script');\n  }\n  return this;\n};\n\nOutput.prototype.inspect = function() {\n  var scriptStr;\n  if (this.script) {\n    scriptStr = this.script.inspect();\n  } else {\n    scriptStr = this._scriptBuffer.toString('hex');\n  }\n  return '<Output (' + this.satoshis + ' sats) ' + scriptStr + '>';\n};\n\nOutput.fromBufferReader = function(br) {\n  var obj = {};\n  obj.satoshis = br.readUInt64LEBN();\n  var size = br.readVarintNum();\n  if (size !== 0) {\n    obj.script = br.read(size);\n  } else {\n    obj.script = Buffer.from([]);\n  }\n  return new Output(obj);\n};\n\nOutput.prototype.toBufferWriter = function(writer) {\n  if (!writer) {\n    writer = new BufferWriter();\n  }\n  writer.writeUInt64LEBN(this._satoshisBN);\n  var script = this._scriptBuffer;\n  writer.writeVarintNum(script.length);\n  writer.write(script);\n  return writer;\n};\n\nmodule.exports = Output;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}